{"version":3,"sources":["hooks/useLazyRef.ts","feature/timeline/useMouse.ts","reducers/selectionSlice.ts","components/ui/Flex/FlexItem.tsx","components/ui/Flex/Flex.tsx","v2/selectors/actors.ts","components/ActorLabel.tsx","v2/selectors/detail/maxActors.ts","v2/reducers/detail/maxActorsSlice.ts","data/getEventErrors.ts","v2/selectors/localisations.ts","v2/selectors/events.ts","v2/selectors/detail/actors.ts","v2/reducers/mask/customFilterSlice.ts","v2/selectors/mask/customFilter.ts","selectors/mask.ts","v2/selectors/relations.ts","feature/relation/selectRelations.ts","feature/relation/utils/emphase.ts","feature/relation/selectionSlice.ts","v2/reducers/detail/actorSlice.ts","v2/thunks/actors.ts","feature/modal/ActorModal.tsx","hooks/useClick.tsx","feature/search/AutocompleteItem.tsx","feature/search/Autocomplete.tsx","hooks/useMount.ts","v2/components/theme.ts","v2/components/Loading.tsx","v2/selectors/global/summary.ts","v2/selectors/graph.ts","selectors/color.ts","selectors/switch.ts","v2/reducers/global/actorSummarySlice.ts","v2/reducers/global/highlightSlice.ts","v2/reducers/global/selectionSlice.ts","v2/selectors/global/utils.ts","v2/types/interaction.ts","v2/selectors/global/highlight.ts","v2/selectors/global/selection.ts","v2/selectors/mask/index.ts","v2/selectors/mask/globalMapBounds.ts","v2/selectors/mask/globalTime.ts","v2/global/graph/selectors.ts","v2/global/graph/GraphNode.tsx","components/scrollbar.tsx","components/ui/Flex/styled-components.ts","components/ui/IconSpacer.tsx","feature/info/event/Pause.tsx","feature/info/event/Grave.tsx","data/getEventIcon.tsx","i18n/event-kind.ts","feature/modal/Modal.tsx","hooks/useDimensions.ts","components/ui/Popper.tsx","v2/components/ProsoVisDateComponent.tsx","v2/global/graph/SummaryEvent.tsx","v2/global/graph/SummaryEvents.tsx","v2/global/graph/SummaryHeader.tsx","v2/global/graph/SummaryWindow.tsx","v2/global/graph/GlobalGraph.tsx","v2/global/graph/useEasyPZ.tsx","v2/components/leaflet/context.ts","v2/components/leaflet/Map.tsx","v2/components/leaflet/Control.tsx","v2/components/leaflet/TileLayer.tsx","v2/reducers/mask/globalMapBoundsSlice.ts","v2/libs/fsac/fsac.ts","v2/global/map/aggregation/Circle.tsx","v2/global/map/aggregation/CircleRbush.ts","v2/global/map/aggregation/createCluster.ts","v2/components/leaflet/FeatureGroup.tsx","v2/components/leaflet/Marker.tsx","v2/global/map/PieChart.tsx","v2/selectors/global/interactions.ts","v2/global/map/ClusterPiePart.tsx","v2/global/map/ClusterGroup.tsx","v2/global/map/GlobalMap.tsx","v2/global/timeline/options.ts","v2/global/timeline/selectors.ts","v2/d3-hooks/useSelect.ts","v2/components/Axis.tsx","v2/components/brush/styled.ts","v2/components/brush/brushHandles.ts","v2/components/brush/BrushX.tsx","v2/d3-hooks/useBrushX.ts","v2/components/brush/usePath.ts","v2/global/timeline/StackedChart.tsx","v2/reducers/mask/globalTimeSlice.ts","v2/global/timeline/StreamGraph.tsx","v2/global/timeline/useUpdateMask.tsx","v2/global/timeline/GlobalTimeline.tsx","v2/reducers/actorsDataSlice.ts","v2/reducers/eventsDataSlice.ts","v2/reducers/graphDataSlice.ts","v2/reducers/localisationsDataSlice.ts","v2/reducers/relationsDataSlice.ts","v2/views/GlobalView.tsx","v2/components/ui/Side1Main3.ts","v2/components/ui/GridAutoRest.ts","v2/components/ui/Flip.tsx","reducers/maskSlice.ts","selectors/selection.ts","selectors/superHighlights.ts","reducers/superHighlightSlice.ts","hooks/useHoverHighlight.ts","feature/map/HoverContext.tsx","feature/map/PiePath.tsx","feature/map/PieChart.tsx","feature/map/cluster/MarkerClusterGroup.tsx","feature/map/marker/Marker.tsx","feature/map/marker/SipMarker.tsx","feature/map/selectLocalisedEvents.tsx","feature/map/cluster/SipMarkerClusterGroup.tsx","polylineoffset/index.js","feature/map/ant-path/AntPath.tsx","feature/map/ant-path/ActorPath.tsx","feature/map/ant-path/path-maker.ts","feature/map/ant-path/SipAnthPaths.tsx","feature/map/SiprojurisMap.tsx","hooks/useD3.ts","feature/relation/highlightSlice.ts","feature/relation/node/PiePart.tsx","feature/relation/node/RelationNode.tsx","feature/relation/suggestion-ring/path.ts","feature/relation/suggestion-ring/selectors.ts","feature/relation/suggestion-ring/SuggestionNode.tsx","utils.ts","feature/relation/suggestion-ring/SuggestionActorLink.tsx","feature/relation/suggestion-ring/SuggestionLink.tsx","feature/relation/suggestion-ring/SuggestionRing.tsx","feature/relation/Relation.tsx","feature/relation/utils/simulation.tsx","feature/timeline/useReferences.tsx","v2/detail/information/useGroups.ts","feature/timeline/timelineGroupSlice.ts","feature/timeline/ContextOptions.tsx","feature/timeline/ContextViewBrush.tsx","feature/timeline/ContextStackedChart.tsx","feature/timeline/Context.tsx","feature/mask/StyledInput.tsx","components/ui/CheckBoxSwitch.tsx","feature/timeline/header/ActorPlaceSwitch.tsx","data/getEventLabel.ts","feature/timeline/ProsoVisTimeline.tsx","feature/timeline/useUpdateMask.tsx","v2/views/DetailView.tsx","components/ColorablePersonIcon.tsx","feature/info/fold/styled-components.tsx","components/ui/Note/index.tsx","components/ui/icon/AlertFillIcon.tsx","components/ui/icon/InfoFillIcon.tsx","components/event/EventErrorContextMenu.tsx","components/event/EventErrors.tsx","components/event/EventLine.tsx","components/event/LeftSpacer.tsx","components/event/EventGroup.tsx","feature/info/fold/InteractiveEnlarge.tsx","feature/info/fold/useGroupEvents.ts","feature/info/fold/ActorNote.tsx","feature/info/fold/DisabledNote.tsx","feature/info/fold/PlaceNote.tsx","v2/detail/information/Information.tsx","components/ScaledDownImg.tsx","components/Organisms.tsx","feature/help/QuestionButton.tsx","feature/help/InfoButton.tsx","feature/mask/styled-components.tsx","v2/thunks/customFilterThunk.ts","v2/shared/filters/CustomFilterElement.tsx","v2/shared/filters/CustomFiltersInput.tsx","v2/shared/filters/SingleFilterView.tsx","v2/shared/filters/DropDownCustomFilters.tsx","v2/shared/filters/CustomFilters.tsx","feature/mask/Actor.tsx","feature/mask/ActorList.tsx","reducers/switchSlice.ts","feature/mask/ColorSwitch.tsx","feature/mask/Mask.tsx","v2/shared/Header.tsx","app/App.tsx","serviceWorker.js","reducers/highlightSlice.ts","reducers/colorSlice.ts","reducers/index.ts","index.tsx"],"names":["useLazyRef","fn","ref","useRef","undefined","current","useMouse","click","dragging","x","y","draggingTreshold","mouse","event","Math","abs","pageX","pageY","selectionSlice","createSlice","name","initialState","reducers","setSelection","_state","payload","isArray","pipe","sortBy","sortedUniqBy","addSelection","state","concat","push","clearSelection","actions","flexItemClasses","self","order","auto","col","Flex","tag","className","children","column","items","justify","onClick","onMouseUp","onMouseEnter","onMouseLeave","wrap","rest","TagWrapper","classnames","FlexMemo","memo","selectActors","actorData","actors","getActorLabel","actor","short","shortLabel","label","ActorLabel","as","id","useSelector","Base","React","Fragment","display","selectMaxActors","maxActors","max","selectCurrent","createSelector","detailMaxActors","setMaxActors","action","setCurrent","resetCurrent","checkDatationLength","sizes","errorMsg","kind","message","value","String","datation","length","expected","level","Array","some","isEqual","inRange","start","end","checkMissingPlace","place","lat","lng","checkLocalisation","localisation","checkEventUnicity","events","subPart","filter","checkBeforeBirthDatation","keyEvents","firstEventCleanDate","first","firstBirthCleanDate","min","birth","flatMap","b","checkAfterDeathDatation","lastEventCleanDate","last","lastDeathCleanDate","death","d","prepareActorWide","computeEventErrors","actorEvents","chain","errors","acc","add","check","addIf","checks","find","c","accumulator","selectLocalisations","localisationData","localisations","selectEvents","eventData","selectRichEvents","map","e","localisationsIndex","localize","selectEventIndex","groupBy","selectDetailActorIds","detailActors","selectDetailActors","ids","flow","a","keyBy","selectDetailsRichEvents","actorWide","getFilterType","v","resolveCustomFilterTypes","customFilterSlice","selected","filters","setDefault","values","kinds","uniq","remove","toggle","key","isNil","setDefaultCustomFilter","addCustomFilter","removeCustomFilter","toggleCustomFilter","selectCustoms","customFilter","selectCustomFilters","customFilters","selectDefaultFilterPath","selectDefaultFilterResolver","path","get","selectDefaultCustomFilter","selectCustomFilterDefaultValues","keys","selectRestCustomFilters","pickBy","_v","selectUsedCustomFilters","selectCustomFiltersFun","kvsome","selectCustomFilterColor","domain","d3","range","selectMask","mask","selectIntervalMask","interval","selectActorMask","selectBoundsMask","bounds","selectIntervalFun","res","parsed","parseISO","isAfter","isBefore","datatStart","datatEnd","selectActorFun","actorMaskState","selectBoundsFun","loc","L","latLngBounds","contains","maskAllFun","bound","selectMaskedEvents","maskF","maskedEventsAsMap","masks","selectRelations","relationsData","g","relations","selectRelationsMap","reduce","forEach","has","set","Set","neighbours","actee","Map","addRelation","link","outer","actorRing","source","ghosts","locsLinks","target","locLinks","selectDetailRelations","createSelectorCreator","defaultMemoize","compareByKeySelector","uniqBy","props","join","links","indexActors","transform","l","selectRelationNodes","selectRelationActorRing","selectRelationLinks","selectRelationGhosts","emptymap","actorRingLinks","ringLinks","parseEmphase","selection","linksForPlace","l1","found","sort","l2","setRelationSelection","_","clearRelationSelection","selectRelationSelection","relationSelection","selectSelectedGhosts","detailActorSlice","reset","from","includes","addDetailActor","removeDetailActor","tryAddDetailActorThunk","dispatch","getState","existing","maxSize","size","AbsolDiv","styled","div","GreyPlane","Flexible","ModalDiv","color","ActorModal","useDispatch","useState","show","setShow","useEffect","setCheckboxs","mapValues","checked","checkboxs","switchCheckBox","useCallback","toString","handleClick","chk","handleCancel","checkedSize","useMemo","style","position","switcher","disabled","ActorLine","Icon","XIcon","PlusIcon","opacity","verticalAlign","aria-label","stopEventPropagation","stopPropagation","useFlatClick","callback","flatEvent","useClickSelect","interactive","highlight","r","f","s","fuzzysort","split","i","AutocompleteItem","clicky","match","selectActorLabels","n","prepare","normalize","replace","options","limit","threshold","AutocompleteItems","ul","Container","StyledInput","input","Item","Autocomplete","text","setText","results","setResults","activeActors","actorLabels","clear","go","onMouseUpCapture","type","onChange","placeholder","useMount","moongray","lightgray","darkgray","red","orange","blue","theme","animation","LoadingSplash","rotate","keyframes","Spinner","span","FullWidth","Loading","finished","hide","selectSummary","actorSummary","selectGraph","graphData","graph","selectColor","selectDomain","kindDomain","selectKindRange","kindRange","selectActorRange","actorRange","selectKindColor","actorColor","selectActorColor","oldDomain","oldRange","trimmedRange","slice","left","zipped","zip","keep","discard","unzip","rainbow","newDomain","newRange","copy","selectSwitchIsActor","switch","selectMainColor","main","selectSwitchColor","selectSwitchKindColor","selectSwitchMainColor","selectSwitchActorColor","selectDefaultGroupBy","selectRichEventColor","border","darker","actorSummarySlice","setActorSummary","resetActorSummary","globalHighlightSlice","resetGlobalHighlight","setGlobalHighlight","globalSelectionSlice","resetGlobalSelection","setGlobalSelection","createInteractionMap","isEventInteraction","partActors","selectGlobalHighlight","globalHighlight","selectGlobalSelection","globalSelection","selectEventsWithoutKinds","selectRichEventsWithoutMapBounds","maskGlobalMapBounds","lBounds","hasCoordinates","existTime","selectRichEventsFiltered","maskGlobalTime","isWithinInterval","selectRichEventsTimed","selectRichEventLocalised","selectSelectedNeighbours","isEmpty","friends","friend","selectHighlightNeighbours","selectActorsFiltered","GraphNode","width","height","highlighted","filtered","useColor","handleMouseEnter","buttons","handleMouseLeave","handleContextMenu","preventDefault","rect","fill","strokeWidth","stroke","transitionDuration","onContextMenu","StyledRect","StyledText","dx","dy","dominantBaseline","scrollbar","StyledFlex","EnlargeFlex","IconSpacer","spaceRight","spaceLeft","IconSpacerPointer","Pause","ariaLabel","viewBox","userSelect","fillRule","Grave","styleIcon","icon","iconColor","kindMap","Birth","Death","Education","BookIcon","ObtainQualification","MortarBoardIcon","PassageExamen","BookmarkIcon","Retirement","HomeIcon","SuspensionActivity","getEventIcon","QuestionIcon","fr","eventKind","modalRoot","document","getElementById","Modal","ReactDOM","createPortal","getDimensionObject","node","getBoundingClientRect","useDimensions","dims","setDims","useLayoutEffect","computePosition","child","content","orientation","top","right","bottom","useRefPopper","StyledPopper","BlackPopper","$ref","usePopper","jsxcontent","useDimsPopper","$content","childDims","contentDims","showPopper","hidePopper","Popper","StyledTime","time","ProsoVisDateLabel","showTooltip","dateTime","data-uri","uri","onFocus","onBlur","EventDateBase","WrapEventDate","SpacedDateLabel","ProsoVisDates","dates","console","error","SummaryEvent","StyledEventLine","StyledSpan","eventsByFirstDate","groupEventsByKind","curr","prev","minDate","minBy","maxDate","maxBy","addStartEndDateToEventGroup","compact","Base2","SummaryEvents","grouped","SummaryHeader","actorExists","ActorTitle","SummaryWindow","useSpring","rf","addEventListener","removeEventListener","eventsIndex","foreignObject","Graph","$svg","$g","baseScale","childrens","select","easypz","EasyPZ","translateX","translateY","scale","minScale","removeHostListeners","useEasyPZ","maxX","maxY","useGraphBounds","summary","GlobalGraph","LeafletContext","createContext","useLeaflet","useContext","LeafletProvider","Provider","defaultBounds","onMoveEnd","onZoomEnd","mappy","$div","setValue","m","fitBounds","useLeafletMap","on","off","LeafletControl","useControl","Control","$control","control","layers","addTo","LeafletAddControl","useAddControl","ControlOverlay","Object","assign","layer","addOverlay","ControlBaseLayer","addBaseLayer","TileLayer","url","addToControl","bs","tileLayer","maskGlobalMapBoundsSlice","setMaskGlobalMapBounds","circleBbox","circle","minX","minY","circleMerge","xs","ys","data","obj","sqrt","Cluster","circleOverlap","RefCircleRbush","item","Rbush","pad","padding","RBush","uid","depth","createClusters","stopper","stop","instance","clusters","merge","overlap","bbox","brk","reverse","refs","alives","collision","load","refCl","updated","clustered","cluster","candidates","search","indexes","Uint32Array","overlaps","Float64Array","iterated","refCandidate","delete","insert","fsac","latLngToLayerPoint","hierarchy","leaves","FeatureGroup","addControl","$group","featureGroup","Marker","latlng","radius","createElement","fontSize","marker","setIcon","divIcon","html","iconSize","removeFrom","setLatLng","PieChart","counts","donut","arcs","arc","innerRadius","outerRadius","pointerEvents","selectInteractionMap","hover","selec","ClusterPiePart","interactors","handleHover","handleHoverOut","defaultD","scaleSqrt","arcify","PartialPiePart","interaction","startAngle","endAngle","subradius","sumBy","ClusterGroup","locs","setClusters","result","parts","groups","layerPointToLatLng","LoadedGlobalMap","getBounds","sw","getSouthWest","ne","getNorthEast","maxZoom","BaseLayers","attribution","subdomains","GlobalMap","margin","defaultInterval","utcYear","Date","selectBackgroundDiscrete","fillEmpty","selectDiscrete","floor","utcYears","utcDay","offset","discretize","flatten","countBy","useSelect","noop","d3selection","dom","call","Axis","axisDirection","axis","transition","StyledG","brushHandles","handles","selectAll","enter","group","append","attr","_d","BrushX","onBrush","sync","brush","refFn","context","usePath","extent","move","this","sourceEvent","invert","StackedChart","stack","curve","curveMonotoneX","defaultColor","chart","d3Area","area","y0","y1","colorize","update","maskGlobalTimeSlice","setMaskGlobalTime","StreamGraph","reference","colorReference","grayscale","lchColor","lch","formatRgb","handleBrush","throttle","useUpdateMaskGlobalTime","scaleTime","nice","clamp","scaleLinear","axisBottom","axisLeft","GlobalTimeline","dimensions","backgroundEvents","stBackground","stackOrderAscending","k","st","newStack","row","index","fetchActors","createAsyncThunk","signal","Axios","CancelToken","cancel","cancelToken","token","response","actorDataSlice","loading","setUrl","extraReducers","builder","addCase","pending","fulfilled","rejected","fetchEvents","eventDataSlice","fetchGraph","fetchLocalisations","fetchRelations","StyledGlobalView","GraphArea","MapArea","TimelineArea","GlobalView","Side1Main3","GridAutoRest","W200","Grid","DrawerIcon","DrawerHandle","title","Flip","Children","count","Error","drawer","setDrawer","maskSlice","setIntervalMask","toggleActorMask","setActorMask","setBoundsMask","clearMask","selectSelection","selectionAsMap","sel","selectSuperHighlight","superHighlight","superHighlightAsMap","selectSuperSelection","superH","superSelectionAsMap","superHighlightSlice","setSuperHighlights","clearSuperHighlights","useHoverHighlight","HoverContext","PiePath","$hover","SelectedPiePath","animatedD","getChildClusters","aggregator","_svg","_childClusters","iconCreateFunction","markers","getAllChildMarkers","point","MarkerClusterGroup","$l","markerClusterGroup","p","addLayer","removeLayer","markerGroupBy","portals","setPortals","_topClusterLevel","DataMarker","CircleMarker","extend","$map","onMouseOut","onMouseOver","fire","fillColor","setStyle","fillOpacity","useFillOpacity","useHover","onMouseClick","useClick","SipMarker","weight","selectLocalisedEvents","SipMarkerClusterGroup","$layer","getMarkers","animate","maxClusterRadius","zoomToBoundsOnClick","showCoverageOnHover","removeOutsideVisibleBounds","spiderfyOnMaxZoom","forEachPair","list","lineEquation","pt1","pt2","intersection","l1a","l1b","l2a","l2b","line1","line2","hasOwnProperty","translatePoint","pt","dist","heading","cos","sin","offsetPoints","pts","segments","joinedPoints","s1","s2","distance","offsetAngle","signedAngle","getSignedAngle","points","center","original","rightOffset","PI","step","alpha","circularArc","joinSegments","joinLineSegments","offsetSegments","atan2","offsetPointLine","segmentAsVector","PolylineOffset","Polyline","_projectLatlngs","latlngs","projectedBounds","ring","flat","LatLng","len","_map","xy","setOffset","redraw","AntPath","twoWay","dashArray","delay","$antpath","antpath","antPath","pulseColor","lineCap","use","setLatLngs","latLng","ActorPath","total","colorFn","debounceMouseOut","debounce","handlers","mouseover","mouseout","segment","diff","grp","groupId","pathMaker","solve","previous","prevLast","getLastDate","getFirstDate","eventFirst","lastEvent","flatify","simplify","flatPath","segmentify","simplePath","markerReducer","_value","SipAnthPaths","defaultMarkerSet","layerGroup","useReducer","getZoom","zoom","setZoom","handleZoom","handleMarkerAdd","handleMarkerRemove","zoomend","chens","__parent","_zoom","_leaflet_id","getLatLng","getMarkerLatLng","flatChens","fromPairs","SiprojurisMap","handleRef","leafletElement","fitWorld","$markerLayer","handleMarkerLayerRef","$antPathLayer","handleAntPathLayerRef","invalidateSize","LayersControl","BaseLayer","Overlay","useDatum","datum","$dom","d3G","highlightSlice","setRelationHighlight","clearRelationHighligh","selectRelationHighlights","relationHighlight","selectHighlightedGhosts","selectRelationEmphasis","rel","high","PiePart","parent","emph","RelationNode","cursor","line","curveBundle","beta","selectIntersection","selectDisplayedRing","selectDisplayedActorRingLinks","selectDisplayedGhosts","selectSortedGhosts","selectGroups","sorted","identity","SuggestionNodes","SuggestionNode","active","showModal","parentNode","querySelector","AbsoluteDiv","StyledDiv","SuggestionPopup","backgroundColor","marginLeft","ROUND_PRECISION","toCartesian","vector","precision","round","theta","number","multiplier","pow","selectClusteredSuggestionActorLinks","quarter","targets","byActor","ordered","fpmap","pop","ceil","chunk","SuggestionActorLinks","coordinates","toCart","coordinate","re","meanBy","suggestion","SuggestionActorLink","kvDatum","$path","mixBlendMode","SuggestionLinks","SuggestionLink","$line","x1","x2","y2","selectActiveActorColor","xBand","scaleBand","bandwidth","SuggestionRing","$links","updateLinkPosition","getId","simulation","force","strength","PlaceText","RelationLink","Relation","$nodeGroup","$linkGroup","$ringLinksGroup","handleResize","window","nodes","updateRef","ringLink","pair","nodeMap","childNodes","$nodes","$ringLinks","restart","handleAwayClick","multiselect","selectable","showTooltips","horizontal","vertical","dataAttributes","verticalScroll","horizontalScroll","unknownLocalisation","selectInformationEvents","masked","selectInformationGroups","actorGroups","localisationGroups","orderBy","timelineGroupSlice","setGroup","selectTimelineGroup","timelineGroup","selectTimelineEventGroups","grouping","groupByActor","groupByPlace","selectTimelineGroupBy","ContextOptions","view","ContextViewBrush","brushSelection","pointer","cx","x0","X0","X1","ContextStackedChart","selectStack","filled","flattened","Context","onMaskUpdate","onViewUpdate","StyledLabel","StyledSlider","StyledKnob","slide","sliderColor","CheckBoxSwitch","handleCheck","PaddedStyledText","AdaptedSlider","ActorPlaceSwitch","setChecked","handleGroupSwitch","getEventLabel","noteKind","computed","actorNote","actorNoteAndGrouped","placeNote","placeNoteAndGrouped","getKindString","newLineLongString","str","maxLenght","padEnd","half","OPACITY_CLASS","selectTimelineEvents","eventColor","richEvent","unescape","popover","resolveDatation","kebabCase","VisHeader","ProsoVisTimeline","setWidth","timelineEvents","timeline","setTimeline","$events","timelineRef","$","selector","trigger","placement","getAttribute","getElementsByClassName","visTimeline","vis","addCustomTime","useReferences","updateMask","toISOString","useUpdateMask","maskSync","setMaskSync","handleUpdateMask","setCustomTime","viewSync","setViewSync","handleUpdateView","setWindow","viewSyncThrottle","maskSyncThrottle","getCustomTime","byUser","_e","changed","mouseOver","mouseOut","destroy","change","boundingRect","$event","isDimmed","classList","inSelection","dataset","what","groupEvents","ctrlKey","metaKey","highlights","groupingKind","firstEvent","setFirstEvent","setItems","fit","getWindow","setGroups","Main","StyledMap","StyledRelation","StyledTimeline","DetailView","ColorablePersonIcon","PersonIcon","highlightable","maskable","Note","defaultToggleState","handleToggle","NoteTitle","NoteContent","AlertFillIcon","InfoFillIcon","errorLevelTranslation","Warning","Info","createErrorTitleString","capitalize","ErrorTitle","TabButton","GroupableTabButton","TitleBase","TitleCloseIcon","CountDisplay","ContentBase","ContentTitle","DetailsMenuContent","translateInterpolator","DetailsMenu","AnimatedDetailsMenu","animated","DraggableIcon","EventErrorContextMenu","$parentRef","close","setActive","bindDraggable","useDrag","down","$contentRef","sortedErrors","currentErrorIndex","currentError","setCurrentError","next","interpolate","SipErrorIcon","XCircleFillIcon","SipWarningIcon","SipInfoIcon","SipGrayedErrorIcon","SipGrayedWarningIcon","SipGrayedInfoIcon","plural","singular","getErrorLabel","getErrorInfo","gray","groupedErrors","PilledIconSpacer","ColoredPilledIconSpacer","SimpleEventErrors","hint","showHint","hideHint","data-count","EventErrors","showContextMenu","setContextMenuState","EventLineIcon","EventLine","origin","dispatchable","handleHighlightHover","handleSelectClick","showIcon","showErrors","LeftSpacer","borderColor","LeftBottomSpacer","EventGroup","handleHighLightHover","isHighlighted","isMasked","every","isSelected","eventErrors","InteractableEnlarge","InteractiveEnlarge","useGroupEvents","least","greatest","ActorNote","handleDeleteClick","groupedEvents","Masked","DisabledActorNote","DisabledPlaceNote","PlaceNote","Information","no","yes","ScaledDownImg","img","FixedHeightFlex","Organisms","src","alt","QuestionButton","forwardRef","_props","Head","SquishedParagraph","PaddedStyledFlex","SmallFont","addCustomFilterThunk","CustomFilterElement","hideNumber","CustomFiltersInput","setInput","handleInput","currentTarget","handleSubmit","onSubmit","onInput","trim","CustomFilterContent","StyledCode","code","SingleFilterView","handleSetDefault","MoreFiltersButton","button","OffsetBottomLeft","ChevronDownIcon","DropDownCustomFilters","setToggle","flatClick","usedFilters","Gridy","ScrollableFlex","CustomFilters","alignSelf","Actor","actorMask","WrapFlex","ActorList","switchSlice","toggleSwitch","switchToActor","switchToKind","switchTo","switchIsActor","ColorSwitch","switchState","StyledSection","section","SwitchArea","ActorsArea","KindsArea","Mask","StyledHeader","StyledInfoBubble","href","Header","BorderedGridAutoRest","App","bind","onMouseDown","onMouseMove","Boolean","location","hostname","setHighlights","clearHighlights","colorSlice","rootReducer","combineReducers","SwitchReducer","store","configureStore","reducer","middleware","getDefaultMiddleware","immutableCheck","serializableCheck","render","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.fa91b4c9.chunk.js","sourcesContent":["import React, { useRef } from 'react';\n\nexport default function useLazyRef<T>(fn: () => T) {\n  const ref = useRef<T>();\n\n  if (ref.current === undefined) {\n    ref.current = fn();\n  }\n  return ref as React.MutableRefObject<T>;\n}\n","import useLazyRef from '../../hooks/useLazyRef';\nexport function useMouse() {\n  return useLazyRef(() => ({\n    click: false,\n    dragging: false,\n    x: 0,\n    y: 0,\n    draggingTreshold: (\n      mouse: {\n        x: number;\n        y: number;\n      },\n      event: {\n        pageX: number;\n        pageY: number;\n      }\n    ) => Math.abs(mouse.x - event.pageX) + Math.abs(mouse.y - event.pageY) > 6\n  }));\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { isArray, pipe, sortBy, sortedUniqBy } from 'lodash/fp';\n\nexport type SelectionEvent = { id: string; kind: string; type?: string };\n\nconst selectionSlice = createSlice({\n  name: 'selection',\n  initialState: null as SelectionEvent[] | null,\n  reducers: {\n    setSelection(\n      _state,\n      { payload }: PayloadAction<SelectionEvent | SelectionEvent[]>\n    ) {\n      if (isArray(payload))\n        return pipe(sortBy<SelectionEvent>('id'), sortedUniqBy('id'))(payload);\n      else return [payload];\n    },\n    addSelection(\n      state,\n      { payload }: PayloadAction<SelectionEvent | SelectionEvent[]>\n    ) {\n      // if state exists , add to state\n      if (isArray(payload)) {\n        return state ? state.concat(payload) : payload;\n      } else {\n        if (state) state.push(payload);\n        else return [payload];\n      }\n    },\n    clearSelection() {\n      return null;\n    },\n  },\n});\n\nexport const { setSelection, addSelection, clearSelection } =\n  selectionSlice.actions;\n\nexport default selectionSlice.reducer;\n","import React, { memo } from 'react';\nimport classnames from 'classnames';\nimport './style.css';\n\n/** @deprecated */\nexport type FlexItemProps = {\n  auto?: boolean;\n  className?: string;\n  col?: boolean;\n  order?: 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 'last';\n  self?: 'start' | 'end' | 'center' | 'baseline' | 'stretch';\n  tag?: keyof JSX.IntrinsicElements;\n};\n\n/** @deprecated */\nexport const FlexItem: React.FC<React.PropsWithChildren<FlexItemProps>> =\n  function (\n    { children, className, tag = 'div', ...flexItemProps } // items\n  ) {\n    const TagWrapper = tag;\n\n    return (\n      <TagWrapper\n        className={classnames(className, flexItemClasses(flexItemProps))}\n      >\n        {children}\n      </TagWrapper>\n    );\n  };\n\n/** @deprecated */\nexport const FlexItemMemo = memo(FlexItem);\n\n/** @deprecated */\nexport default FlexItemMemo;\n\n/** @deprecated */\nexport function flexItemClasses({ self, order, auto, col }: FlexItemProps) {\n  return {\n    [`self-${self}`]: self,\n    [`order-${order}`]: order,\n    'flex-auto': auto,\n    'flex-col': col,\n  };\n}\n","import React, { memo } from 'react';\nimport classnames from 'classnames';\nimport { FlexItemProps, flexItemClasses } from './FlexItem';\n\ntype FlexProps = {\n  tag?: keyof JSX.IntrinsicElements;\n  className?: string;\n  justify?: 'start' | 'end' | 'center' | 'between' | 'around';\n  items?: 'start' | 'end' | 'center' | 'baseline' | 'stretch';\n  wrap?: boolean;\n  column?: boolean;\n  onClick?: React.MouseEventHandler;\n  onMouseUp?: React.MouseEventHandler;\n  onMouseEnter?: React.MouseEventHandler;\n  onMouseLeave?: React.MouseEventHandler;\n};\n\n/**\n * @deprecated\n * @param param0\n */\nexport const Flex: React.FC<\n  React.PropsWithChildren<FlexProps & FlexItemProps>\n> = function (\n  {\n    tag = 'div',\n    className,\n    children,\n    column,\n    items,\n    justify,\n    onClick,\n    onMouseUp,\n    onMouseEnter,\n    onMouseLeave,\n    wrap,\n    ...rest\n  } // props\n) {\n  const TagWrapper = tag;\n  return (\n    <TagWrapper\n      className={classnames(\n        'flex',\n        className,\n        {\n          [`justify-${justify}`]: justify,\n          'flex-wrap': wrap === true,\n          'flex-nowrap': wrap === false,\n          [`items-${items}`]: items,\n          'flex-column': column,\n        },\n        flexItemClasses(rest)\n      )}\n      onClick={onClick}\n      onMouseUp={onMouseUp}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n    >\n      {children}\n    </TagWrapper>\n  );\n};\n\n/**\n * @deprecated\n */\nexport const FlexMemo = memo(Flex);\n\n/** @deprecated */\nexport default FlexMemo;\n","import { RootState } from '../../reducers';\n\nexport const selectActors = (state: RootState) => state.actorData.actors;\n","import React from 'react';\nimport { useSelector } from 'react-redux';\nimport { selectActors } from '../v2/selectors/actors';\nimport { ProsoVisActor } from '../v2/types/actors';\n\nexport function getActorLabel(\n  actor: Pick<ProsoVisActor, 'label' | 'shortLabel'>,\n  short: boolean = false\n) {\n  return short ? actor.shortLabel ?? actor.label : actor.label;\n}\n\nconst ActorLabel: React.FC<{\n  as?: keyof JSX.IntrinsicElements | React.ComponentType<any>;\n  id: ProsoVisActor | string;\n  short?: boolean;\n}> = function ({ as, id: actor, short }) {\n  const actors = useSelector(selectActors);\n  let Base = as ? as : React.Fragment;\n\n  if (typeof actor === 'string') {\n    if (!actors) return <Base>Actor reference not found</Base>;\n    actor = actors[actor];\n  }\n  let display = actor;\n\n  return <Base>{getActorLabel(display, short)}</Base>;\n};\n\nexport default ActorLabel;\n","import { createSelector } from 'reselect';\nimport { RootState } from '../../../reducers';\nimport { selectActors } from '../actors';\n\nexport const selectMaxActors = (state: RootState) => state.maxActors.max;\n\nconst selectCurr = (state: RootState) => state.maxActors.current;\nexport const selectCurrent = createSelector(\n  selectCurr,\n  selectActors,\n  (current, actors) => (actors && current ? actors[current] : null)\n);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nexport const detailMaxActors = createSlice({\n  initialState: { max: 5, current: null } as {\n    max: number;\n    current: null | string;\n  },\n  name: 'detail/max-actors',\n  reducers: {\n    setMaxActors(state, action: PayloadAction<number>) {\n      state.max = action.payload; // immerjs\n    },\n    setCurrent(state, action: PayloadAction<string>) {\n      state.current = action.payload;\n    },\n\n    resetCurrent(state) {\n      state.current = null;\n    },\n  },\n});\n\nexport default detailMaxActors.reducer;\nexport const { setMaxActors, setCurrent, resetCurrent } =\n  detailMaxActors.actions;\n","import { first, last, find, isEqual, inRange } from 'lodash/fp';\nimport { ProsoVisEvent, RichEvent } from '../v2/types/events';\nimport { ProsoVisError } from '../v2/types/errors';\nimport { max, min } from 'd3';\n\nfunction checkDatationLength(\n  event: ProsoVisEvent,\n  sizes: number | { start: number; end: number } | number[] = 2\n): ProsoVisError | undefined {\n  const errorMsg: ProsoVisError = {\n    kind: 'DatationLength',\n    message: `Le nombre de dates est incorrect`,\n    value: String(event.datation?.length),\n    expected: sizes,\n    level: 'Warning',\n  };\n\n  if (Array.isArray(sizes)) {\n    if (!sizes.some(isEqual(event.datation?.length))) return errorMsg;\n  } else if (typeof sizes === 'object') {\n    if (!inRange(sizes.start, sizes.end, event.datation?.length ?? 0))\n      return errorMsg;\n  } else if (event.datation?.length !== sizes) {\n    return errorMsg;\n  }\n}\n\n// function checkDatationType(\n//   event: ProsoVisEvent,\n//   expected: ProsoVisDate['kind'][]\n// ): ProsoVisError | undefined {\n//   // all event.datation is one of the allowed type\n//   const eventKinds = (event.datation ?? []).map((e) => e.kind);\n//   if (!subset(eventKinds, expected))\n//     return {\n//       kind: 'DatationType',\n//       message: 'Le type de(s) date(s) est incorrect',\n//       value: (event.datation ?? []).map((d) => d.kind),\n//       expected,\n//       level: 'Warning',\n//     };\n// }\n\nexport function checkMissingPlace(event: RichEvent): ProsoVisError | undefined {\n  if (!event.place) {\n    return {\n      kind: 'MissingPlace',\n      message: \"L'evenement n'as pas de lieu défini\",\n      value: 'null',\n      expected: 'Place',\n      level: 'Warning',\n    };\n  }\n\n  if (!event.place?.lat || !event.place?.lng) {\n    return {\n      kind: 'MissingPlaceCoordinates',\n      message: \"Les coordonnées GPS de l'evenement ne sont pas définis\",\n      value: 'null',\n      expected: 'Coordonnées GPS',\n      level: 'Warning',\n    };\n  }\n}\n\nexport function checkLocalisation(event: RichEvent): ProsoVisError | undefined {\n  if (!event.localisation) {\n    return {\n      kind: 'MissingLocalisation',\n      message: \"La localisation n'est pas défini\",\n      level: 'Warning',\n      value: 'null',\n      expected: 'Localisation',\n    };\n  }\n}\n\nfunction checkEventUnicity(\n  event: ProsoVisEvent,\n  events: RichEvent[]\n): ProsoVisError | undefined {\n  const subPart = events.filter(({ event: { kind } }) => kind === event.kind);\n  if (subPart.length > 1) {\n    return {\n      kind: 'EventDuplication',\n      level: 'Error',\n      message: `Les evenements de ${event.kind} doivent être uniques`,\n      value: subPart.length,\n      expected: 1,\n    };\n  }\n}\n/**\n * @param event\n * @param keyEvents\n */\nfunction checkBeforeBirthDatation(\n  event: ProsoVisEvent,\n  keyEvents: {\n    birth: RichEvent[];\n    death: RichEvent[];\n    events: RichEvent[];\n  }\n): ProsoVisError | undefined {\n  if (event.kind !== 'Birth') {\n    const firstEventCleanDate = first(event.datation)?.value;\n    const firstBirthCleanDate = min(\n      keyEvents.birth.flatMap((b) => b.event.datation ?? []),\n      (b) => b.value\n    );\n    if (\n      firstEventCleanDate &&\n      firstBirthCleanDate &&\n      firstEventCleanDate <= firstBirthCleanDate\n    )\n      return {\n        kind: 'DatationBeforeBirth',\n        level: 'Error',\n        message: \"L'evenement s'est produit avant la naissance\",\n        value: firstEventCleanDate,\n        expected: `<= ${firstBirthCleanDate}`,\n      };\n  }\n}\n/**\n * @param event\n * @param keyEvents\n */\nfunction checkAfterDeathDatation(\n  event: ProsoVisEvent,\n  keyEvents: {\n    birth: RichEvent[];\n    death: RichEvent[];\n    events: RichEvent[];\n  }\n): ProsoVisError | undefined {\n  if (event.kind !== 'Death') {\n    const lastEventCleanDate = last(event.datation)?.value;\n    const lastDeathCleanDate = max(\n      keyEvents.death.flatMap((d) => d.event.datation ?? []),\n      (d) => d.value\n    );\n\n    if (\n      lastEventCleanDate &&\n      lastDeathCleanDate &&\n      lastEventCleanDate > lastDeathCleanDate\n    ) {\n      return {\n        kind: 'DatationBeforeDeath',\n        level: 'Error',\n        message: \"L'evenement s'est produit après la mort\",\n        value: lastEventCleanDate,\n        expected: `> ${lastDeathCleanDate}`,\n      };\n    }\n  }\n}\n\nexport function accumulator(errors: ProsoVisError[] = []) {\n  const acc = {\n    add: function (check?: ProsoVisError) {\n      if (check) errors.push(check);\n      return acc;\n    },\n    addIf: function (...checks: (ProsoVisError | undefined)[]) {\n      const value = find((c) => c !== undefined, checks);\n      if (value) errors.push(value);\n      return acc;\n    },\n    get errors() {\n      if (errors.length > 0) {\n        return errors;\n      }\n      return undefined;\n    },\n  };\n  return acc;\n}\n\nexport function prepareActorWide(events: RichEvent[]) {\n  const birth = events.filter(({ event }) => event.kind === 'Birth');\n  const death = events.filter(({ event }) => event.kind === 'Death');\n  return { birth, death };\n}\n\nexport function computeActorWideErrors(events: RichEvent[]) {\n  const actorEvents = { ...prepareActorWide(events), events };\n\n  return events.map((event) => computeEventErrors(event, actorEvents));\n}\n\nexport function computeEventErrors(\n  event: RichEvent,\n  actorEvents: {\n    birth: RichEvent[];\n    death: RichEvent[];\n    events: RichEvent[];\n  }\n) {\n  const chain = accumulator([]);\n\n  switch (event.event.kind) {\n    case 'Birth': {\n      chain\n        .add(checkEventUnicity(event.event, actorEvents.events))\n        .add(checkDatationLength(event.event, 1))\n        // .add(\n        //   checkDatationType(event.event, [\n        //     'Date unique',\n        //     \"Date unique (jusqu'à, inclus)\",\n        //   ])\n        // )\n        .add(checkMissingPlace(event));\n      break;\n    }\n\n    case 'Death': {\n      chain\n        .add(checkEventUnicity(event.event, actorEvents.events))\n        .add(checkDatationLength(event.event, 1))\n        // .add(\n        //   checkDatationType(event.event, [\n        //     'Date unique',\n        //     \"Date unique (jusqu'à, inclus)\",\n        //   ])\n        // )\n        .add(checkMissingPlace(event));\n\n      break;\n    }\n\n    case 'Education': {\n      chain\n        .add(checkDatationLength(event.event, 2))\n        // .add(checkDatationType(event.event, ['Date de début', 'Date de fin']))\n        .add(checkLocalisation(event))\n        .add(checkMissingPlace(event))\n        .add(checkBeforeBirthDatation(event.event, actorEvents))\n        .add(checkAfterDeathDatation(event.event, actorEvents));\n\n      break;\n    }\n\n    case 'ObtainQualification': {\n      chain\n        .add(checkDatationLength(event.event, 1))\n        // .add(\n        //   checkDatationType(event.event, [\n        //     'Date unique',\n        //     \"Date unique (jusqu'à, inclus)\",\n        //   ])\n        // )\n        .add(checkLocalisation(event))\n        .add(checkMissingPlace(event))\n        .add(checkBeforeBirthDatation(event.event, actorEvents))\n        .add(checkAfterDeathDatation(event.event, actorEvents));\n\n      break;\n    }\n\n    case 'PassageExamen': {\n      chain\n        .add(checkDatationLength(event.event, 1))\n        // .add(\n        //   checkDatationType(event.event, [\n        //     'Date unique',\n        //     \"Date unique (jusqu'à, inclus)\",\n        //   ])\n        // )\n        .add(checkBeforeBirthDatation(event.event, actorEvents))\n        .add(checkAfterDeathDatation(event.event, actorEvents))\n        .add(checkLocalisation(event))\n        .add(checkMissingPlace(event));\n\n      break;\n    }\n\n    case 'Retirement': {\n      chain\n        .add(checkDatationLength(event.event, 1))\n        // .add(\n        //   checkDatationType(event.event, [\n        //     'Date unique',\n        //     \"Date unique (jusqu'à, inclus)\",\n        //   ])\n        // )\n        .add(checkBeforeBirthDatation(event.event, actorEvents))\n        .add(checkAfterDeathDatation(event.event, actorEvents));\n\n      break;\n    }\n    case 'SuspensionActivity': {\n      chain\n        .add(checkDatationLength(event.event, 2))\n        // .add(checkDatationType(event.event, ['Date de début', 'Date de fin']))\n        .add(checkBeforeBirthDatation(event.event, actorEvents))\n        .add(checkAfterDeathDatation(event.event, actorEvents));\n\n      break;\n    }\n  }\n\n  return chain.errors;\n}\n","import { RootState } from '../../reducers';\n\nexport const selectLocalisations = (state: RootState) =>\n  state.localisationData.localisations;\n","import { createSelector } from '@reduxjs/toolkit';\nimport { groupBy, map } from 'lodash/fp';\nimport { RootState } from '../../reducers';\nimport { ProsoVisActor } from '../types/actors';\nimport { ProsoVisEvent, RichEvent } from '../types/events';\nimport { ProsoVisLocalisation, ProsoVisPlace } from '../types/localisations';\nimport { selectActors } from './actors';\nimport { selectLocalisations } from './localisations';\n\nexport const selectEvents = (state: RootState) => state.eventData.events;\n\nexport const selectRichEvents = createSelector(\n  selectEvents,\n  selectLocalisations,\n  selectActors,\n  (events, localisations, actors) =>\n    events &&\n    localisations &&\n    actors &&\n    map((e) => localize(localisations, e, actors[e.actor]), events)\n);\n\nexport const selectEventIndex = createSelector(\n  selectRichEvents,\n  (events) => events && groupBy('actor.id', events)\n);\n\n/**\n * f(x): localize\n */\n\nexport function localize(\n  localisationsIndex: _.Dictionary<ProsoVisLocalisation> | undefined,\n  event: ProsoVisEvent,\n  actor: ProsoVisActor\n): RichEvent {\n  if (localisationsIndex) {\n    const localisation =\n      event.localisation && localisationsIndex[event.localisation]\n        ? localisationsIndex[event.localisation]\n        : undefined;\n\n    if (localisation) {\n      let place;\n      if (localisation.kind === 'Localisation') {\n        if (localisation.localisation)\n          place = localisationsIndex[\n            localisation.localisation\n          ] as ProsoVisPlace;\n      } else {\n        place = localisation;\n      }\n\n      return { actor, event, localisation, place };\n    }\n  }\n\n  return { actor, event };\n}\n","import { flatMap, flow, keyBy, map } from 'lodash/fp';\nimport { createSelector } from 'reselect';\nimport {\n  computeEventErrors,\n  prepareActorWide,\n} from '../../../data/getEventErrors';\nimport { RootState } from '../../../reducers';\nimport { ProsoVisActor } from '../../types/actors';\nimport { ProsoVisDetailRichEvent } from '../../types/events';\nimport { selectActors } from '../actors';\nimport { selectEventIndex } from '../events';\n\nexport const selectDetailActorIds = (state: RootState) => state.detailActors;\nexport const selectDetailActors = createSelector(\n  selectActors,\n  selectDetailActorIds,\n  (actors, ids) =>\n    actors\n      ? flow(\n          map((a: string) => actors[a]),\n          keyBy<ProsoVisActor>((a) => a.id)\n        )(ids)\n      : {}\n);\n\nexport const selectDetailsRichEvents = createSelector(\n  selectDetailActors,\n  selectEventIndex,\n  (actors, events) =>\n    events\n      ? flatMap((actor) => {\n          const actorEvents = events[actor.id];\n\n          const actorWide = {\n            ...prepareActorWide(actorEvents),\n            events: actorEvents,\n          };\n\n          return actorEvents.map(\n            (e) =>\n              ({\n                ...e,\n                errors: computeEventErrors(e, actorWide),\n              } as ProsoVisDetailRichEvent)\n          );\n        }, actors)\n      : []\n);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { isNil, keyBy, map, pipe, uniq } from 'lodash/fp';\n\nexport type CustomFilterField = { value: string | null; count: number };\n\nexport function getFilterType(v: string | number | Object | undefined | null) {\n  if (v === null) return 'null';\n  switch (typeof v) {\n    case 'object':\n      if (Array.isArray(v)) return 'array';\n      return 'object';\n    default:\n      return typeof v;\n  }\n}\n\nexport function resolveCustomFilterTypes(\n  v: string | number | Object | undefined | null\n) {\n  if (v === null) return 'null';\n  switch (typeof v) {\n    case 'object':\n      if (Array.isArray(v)) return '' + v.length;\n      return 'is defined';\n    case 'undefined':\n      return 'undefined';\n    case 'number':\n    default:\n      return String(v);\n  }\n}\n\nexport type CustomFilterType = {\n  name: string;\n  kinds: string[];\n  values: _.Dictionary<CustomFilterField>;\n};\n\nconst initialState: {\n  selected: string | null;\n  filters: _.Dictionary<CustomFilterType>;\n} = { selected: null, filters: {} };\nexport const customFilterSlice = createSlice({\n  name: 'custom-filter',\n  initialState,\n  reducers: {\n    setDefault(state, { payload }: PayloadAction<string>) {\n      state.selected = payload;\n    },\n    add(\n      state,\n      {\n        payload: { selected, filter, values },\n      }: PayloadAction<{\n        selected: boolean;\n        filter: string;\n        values: { value: string; kind: string; count: number }[];\n      }>\n    ) {\n      state.filters[filter] = {\n        name: filter,\n        kinds: pipe(map('kind'), uniq)(values),\n        values: keyBy('value', values),\n      };\n      if (selected) state.selected = filter;\n    },\n    remove(state, { payload }: PayloadAction<string>) {\n      delete state.filters[payload];\n      if (state.selected === payload) state.selected = null;\n    },\n    toggle(state, { payload: [key, value] }: PayloadAction<[string, string]>) {\n      if (state.filters[key]) {\n        if (isNil(state.filters[key].values[value].value))\n          state.filters[key].values[value].value = value;\n        else state.filters[key].values[value].value = null;\n      }\n    },\n  },\n});\n\nexport default customFilterSlice.reducer;\nexport const {\n  setDefault: setDefaultCustomFilter,\n  add: addCustomFilter,\n  remove: removeCustomFilter,\n  toggle: toggleCustomFilter,\n} = customFilterSlice.actions;\n","import * as d3 from 'd3';\nimport { keys, some as kvsome } from 'lodash';\nimport { get, pickBy, some } from 'lodash/fp';\nimport { createSelector } from 'reselect';\nimport { RootState } from '../../../reducers';\nimport { resolveCustomFilterTypes } from '../../reducers/mask/customFilterSlice';\nimport { ProsoVisDetailRichEvent, RichEvent } from '../../types/events';\n\nconst selectCustoms = (state: RootState) => state.customFilter;\nexport const selectCustomFilters = createSelector(\n  selectCustoms,\n  (customFilters) => customFilters.filters\n);\n\nexport const selectDefaultFilterPath = createSelector(\n  selectCustoms,\n  (customFilters) => customFilters.selected\n);\n\nexport const selectDefaultFilterResolver = createSelector(\n  selectDefaultFilterPath,\n  (path) => (e: RichEvent) =>\n    resolveCustomFilterTypes(get(path ?? 'event.kind', e))\n);\n\nexport const selectDefaultCustomFilter = createSelector(\n  selectCustoms,\n  ({ filters, selected }) => (selected !== null ? filters[selected] : null)\n);\n\nexport const selectCustomFilterDefaultValues = createSelector(\n  selectDefaultCustomFilter,\n  (filter) => keys(filter?.values)\n);\n\nexport const selectRestCustomFilters = createSelector(\n  selectCustoms,\n  ({ filters, selected }) => pickBy((_v, key) => key !== selected, filters)\n);\n\nexport const selectUsedCustomFilters = createSelector(\n  selectRestCustomFilters,\n  some((filter) => some(({ value }) => value === null, filter.values))\n);\n\nexport const selectCustomFiltersFun = createSelector(\n  selectCustomFilters,\n  (filters) => (e: ProsoVisDetailRichEvent) =>\n    !kvsome(filters, (filter, path) => {\n      return (\n        filter.values[resolveCustomFilterTypes(get(path, e))].value === null\n      );\n    })\n);\n\nexport const selectCustomFilterColor = createSelector(\n  selectCustomFilterDefaultValues,\n  (domain) =>\n    d3.scaleOrdinal<string, string>().domain(domain).range(d3.schemeTableau10)\n);\n","import { createSelector } from '@reduxjs/toolkit';\nimport { isAfter, isBefore, parseISO } from 'date-fns';\nimport L from 'leaflet';\nimport { isNil, keyBy } from 'lodash/fp';\nimport { RootState } from '../reducers';\nimport { ActorMask } from '../reducers/maskSlice';\nimport { selectDetailsRichEvents } from '../v2/selectors/detail/actors';\nimport { selectCustomFiltersFun } from '../v2/selectors/mask/customFilter';\nimport { ProsoVisActor } from '../v2/types/actors';\nimport { ProsoVisDate, ProsoVisDetailRichEvent } from '../v2/types/events';\nexport const selectMask = (state: RootState) => state.mask;\nexport const selectIntervalMask = createSelector(\n  selectMask,\n  (mask) => mask.interval\n);\n\nexport const selectActorMask = createSelector(selectMask, (mask) => mask.actor);\nexport const selectBoundsMask = createSelector(\n  selectMask,\n  (mask) => mask.bounds\n);\n\n/** see filter:time in v2/selectors/masks */\nexport const selectIntervalFun = createSelector(selectIntervalMask, (res) =>\n  res\n    ? function ({ event: { datation } }: ProsoVisDetailRichEvent) {\n        if (isNil(datation) || datation.length === 0) return true; // unbound by interval filter\n\n        if (datation.length === 1) {\n          const parsed = parseISO(datation[0].value);\n\n          return (\n            isAfter(parsed, parseISO(res.start)) &&\n            isBefore(parsed, parseISO(res.end))\n          );\n        }\n        datation = datation as [ProsoVisDate, ProsoVisDate];\n        const datatStart = parseISO(datation[0].value);\n        const datatEnd = parseISO(datation[1].value);\n\n        return !(\n          isBefore(parseISO(res.end), datatStart) ||\n          isAfter(parseISO(res.start), datatEnd)\n        );\n      }\n    : undefined\n);\n\nexport const selectActorFun = createSelector(selectActorMask, (res) =>\n  res ? (e: ProsoVisDetailRichEvent) => actorMaskState(e.actor, res) : undefined\n);\n\nexport const selectBoundsFun = createSelector(selectBoundsMask, (res) =>\n  res\n    ? (e: ProsoVisDetailRichEvent) => {\n        const loc = e.place;\n        if (loc && !isNil(loc.lat) && !isNil(loc.lng)) {\n          return L.latLngBounds(res).contains([+loc.lat, +loc?.lng]);\n        } else {\n          return true;\n        }\n      }\n    : undefined\n);\n\nexport const maskAllFun = createSelector(\n  selectIntervalFun,\n  selectActorFun,\n  selectBoundsFun,\n  selectCustomFiltersFun,\n  function (interval, actor, bound, customFilters) {\n    return (e: ProsoVisDetailRichEvent) => {\n      if (!customFilters(e)) return false;\n      if (actor && !actor(e)) return false;\n      if (interval && !interval(e)) return false;\n      if (bound && !bound(e)) return false;\n      return true;\n    };\n  }\n);\n\nexport const selectMaskedEvents = createSelector(\n  selectDetailsRichEvents,\n  maskAllFun,\n  (events, maskF) => events.filter(maskF)\n);\n\nexport const maskedEventsAsMap = createSelector(\n  selectMaskedEvents,\n  keyBy<ProsoVisDetailRichEvent>('event.id')\n);\n\nexport function actorMaskState(actor: ProsoVisActor, masks?: ActorMask) {\n  const state = masks && masks[actor.id];\n  return state !== undefined ? state : true;\n}\n","import { RootState } from '../../reducers';\nimport { createSelector } from 'reselect';\nimport { reduce } from 'lodash/fp';\n\nexport const selectRelationsData = (state: RootState) => state.relationsData;\n\nexport const selectRelations = createSelector(\n  selectRelationsData,\n  (g) => g.relations\n);\n\nexport const selectRelationsMap = createSelector(\n  selectRelations,\n  (state) =>\n    state &&\n    reduce(\n      (acc, v) => {\n        v.actors.forEach((actor) => {\n          if (!acc.has(actor)) acc.set(actor, new Set());\n          let neighbours = acc.get(actor)!;\n\n          v.actors.forEach((actee) => {\n            if (actee === actor) return;\n\n            neighbours.add(actee);\n          });\n        });\n        return acc;\n      },\n      new Map<string, Set<string>>(),\n      state\n    )\n);\n","import { createSelector } from '@reduxjs/toolkit';\nimport { createSelectorCreator, defaultMemoize } from 'reselect';\nimport { ActorRelationsMap } from './models';\nimport { selectMaskedEvents } from '../../selectors/mask';\nimport { ProsoVisSignedRelation } from '../../v2/types/relations';\nimport { ProsoVisActor } from '../../v2/types/actors';\nimport { selectActors } from '../../v2/selectors/actors';\nimport {\n  get,\n  isEqual,\n  keyBy,\n  keys,\n  map,\n  pipe,\n  transform,\n  uniqBy,\n} from 'lodash/fp';\nimport { selectRelations } from '../../v2/selectors/relations';\nimport { ProsoVisDetailRichEvent } from '../../v2/types/events';\n\nexport type RelationType = {\n  locLinks: Map<string, Map<string, ProsoVisSignedRelation>>;\n  links: Map<string, ProsoVisSignedRelation>; // link between actors\n\n  /**\n   * ```\n   * { actorId => {\n   *   ghosts: uniq_ghosts,\n   *   locsLinks: {\n   *     locId => { linkId => RelationLink }}}}\n   * ```\n   */\n  actorRing: Map<string, { ghosts: Set<string>; locsLinks: ActorRelationsMap }>;\n  ghosts: Map<string, ProsoVisActor>;\n  actors: Map<string, ProsoVisActor>; // all people information ( actors)\n};\n\nfunction addRelation(\n  relations: RelationType,\n  actors: _.Dictionary<ProsoVisActor>,\n  link: ProsoVisSignedRelation\n) {\n  let outer = relations.actorRing.get(link.source);\n  if (!outer) {\n    relations.actorRing.set(\n      link.source,\n      (outer = { ghosts: new Set(), locsLinks: new Map() })\n    );\n  }\n  outer.ghosts.add(link.target);\n\n  const locsLinks = outer.locsLinks;\n\n  let locLinks = locsLinks.get(link.loc);\n  if (!locLinks) locsLinks.set(link.loc, (locLinks = new Map()));\n  locLinks.set(link.id, link);\n\n  if (!relations.ghosts.has(link.target))\n    relations.ghosts.set(link.target, actors[link.target]);\n\n  if (!relations.actors.has(link.source))\n    relations.actors.set(link.source, { ...actors[link.source] });\n}\n\nconst compareByKeySelector = createSelectorCreator(\n  defaultMemoize,\n  function (a, b) {\n    return isEqual(keys(a), keys(b));\n  }\n);\n\nexport const selectActorsFromMaskedEvents = createSelector(\n  selectMaskedEvents,\n  (events) =>\n    pipe(\n      uniqBy<ProsoVisDetailRichEvent>('actor.id'),\n      map('actor'),\n      keyBy<ProsoVisActor>('id')\n    )(events)\n);\n\nexport const selectLinks = createSelector(selectRelations, (relations) => {\n  return map(\n    ({ actors, ...props }) => ({\n      ...props,\n      id: actors.join(':'),\n      source: actors[0],\n      target: actors[1],\n    }),\n    relations\n  );\n});\n\n/** @deprecated */\n// export const selectActorLinksMap = createSelector(selectLinks, (links) => {\n//   return transform(\n//     (relations, l) => {\n//       let srels = relations.get(l.source);\n//       if (srels === undefined) {\n//         srels = { events: new Set(), actors: new Map() };\n//         relations.set(l.source, srels);\n//       }\n//       srels.actors.set(l.target, l);\n//       l.events.forEach((e) => srels!.events.add(e));\n\n//       let trels = relations.get(l.target);\n//       if (trels === undefined) {\n//         trels = { events: new Set(), actors: new Map() };\n//         relations.set(l.target, trels);\n//       }\n//       trels.actors.set(l.source, l);\n//       l.events.forEach((e) => trels!.events.add(e));\n//     },\n//     new Map<\n//       string,\n//       { events: Set<string>; actors: Map<string, ProsoVisSignedRelation> }\n//     >(),\n//     links\n//   );\n// });\n\nexport const selectDetailRelations = compareByKeySelector(\n  selectActorsFromMaskedEvents,\n  selectLinks,\n  selectActors,\n  (actors, links, indexActors = {}) => {\n    return transform(\n      function (relations, link) {\n        const { source, target } = link;\n        if (actors[source] || actors[target]) {\n          link = { ...link };\n\n          if (actors[source] && actors[target]) {\n            // both are actors\n            if (!relations.actors.has(source))\n              relations.actors.set(source, { ...get(source, indexActors) });\n            if (!relations.actors.has(target))\n              relations.actors.set(target, { ...get(target, indexActors) });\n            relations.links.set(link.id, link);\n          } else if (actors[source]) {\n            addRelation(relations, indexActors, link);\n          } else if (actors[target]) {\n            link.source = target;\n            link.target = source;\n            addRelation(relations, indexActors, link);\n          }\n        }\n        let l = relations.locLinks.get(link.loc);\n        if (!l) {\n          relations.locLinks.set(link.loc, (l = new Map()));\n        }\n        l.set(link.id, link);\n      },\n      {\n        locLinks: new Map(),\n        actorRing: new Map(),\n        links: new Map(),\n        ghosts: new Map(),\n        actors: new Map(),\n      } as RelationType,\n      links\n    );\n  }\n);\n\nexport const selectRelationNodes = createSelector(\n  selectDetailRelations,\n  ({ actors }) => actors\n);\n\nexport const selectRelationActorRing = createSelector(\n  selectDetailRelations,\n  ({ actorRing }) => actorRing\n);\n\nexport const selectRelationLinks = createSelector(\n  selectDetailRelations,\n  ({ links }) => links\n);\n\nexport const selectRelationGhosts = createSelector(\n  selectDetailRelations,\n  ({ ghosts }) => ghosts\n);\n","import { RelationType } from '../selectRelations';\nimport { RelationMap, Emphase } from '../models';\n\nexport const emptymap: {\n  ghosts: RelationMap;\n  actorRingLinks: RelationMap;\n  ringLinks: RelationMap;\n} = {\n  ghosts: new Map(),\n  actorRingLinks: new Map(),\n  ringLinks: new Map(),\n};\n\nexport function parseEmphase(\n  { actorRing, locLinks, actors }: RelationType,\n  selection: Emphase | null\n): {\n  ghosts: RelationMap;\n  actorRingLinks: RelationMap;\n  ringLinks: RelationMap;\n} {\n  if (!selection) return emptymap;\n\n  const actor = actorRing.get(selection.actor);\n\n  if (!actor) return emptymap;\n\n  const actorRingLinks: RelationMap = new Map();\n  const ringLinks: RelationMap = new Map();\n\n  const ghosts =\n    actor.locsLinks.get(selection.loc) || (new Map() as RelationMap);\n  const linksForPlace = locLinks.get(selection.loc)!;\n  // foreach actor in links, check the connection they have(with ghosts or actors)\n  ghosts.forEach((l1) => {\n    actors.forEach((actor) => {\n      if (actor.id === selection.actor) return;\n      const found = linksForPlace.get([actor.id, l1.target].sort().join(':'));\n      if (found) actorRingLinks.set(found.id, found);\n    });\n\n    ghosts.forEach((l2) => {\n      if (l1.target === l2.target) return;\n      const found = linksForPlace.get([l1.target, l2.target].sort().join(':'));\n      if (found) ringLinks.set(found.id, found);\n    });\n  });\n  return { ghosts, actorRingLinks, ringLinks };\n}\n","import { createSlice, PayloadAction, createSelector } from '@reduxjs/toolkit';\nimport { RootState } from '../../reducers';\nimport { selectDetailRelations } from './selectRelations';\nimport { parseEmphase } from './utils/emphase';\nimport { Emphase } from './models';\n\nexport const selectionSlice = createSlice({\n  name: 'relation/selection',\n  initialState: null as Emphase | null,\n  reducers: {\n    setRelationSelection(_, action: PayloadAction<Emphase>) {\n      return action.payload;\n    },\n    clearRelationSelection() {\n      return null;\n    },\n  },\n});\n\nexport const selectRelationSelection = (state: RootState) =>\n  state.relationSelection;\n\nexport const selectSelectedGhosts = createSelector(\n  selectDetailRelations,\n  selectRelationSelection,\n  parseEmphase\n);\n\nexport const { setRelationSelection, clearRelationSelection } =\n  selectionSlice.actions;\n\nexport default selectionSlice.reducer;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { ProsoVisActor } from '../../types/actors';\n\ntype ActorId = ProsoVisActor['id'];\nexport const detailActorSlice = createSlice({\n  name: 'detail/actor',\n  initialState: [] as ActorId[],\n  reducers: {\n    reset() {\n      return [];\n    },\n    add(state, { payload }: PayloadAction<ActorId | ActorId[]>) {\n      if (Array.isArray(payload))\n        return Array.from(new Set(state.concat(payload)));\n      else return Array.from(new Set(state.concat([payload])));\n    },\n    remove(state, { payload }: PayloadAction<ActorId | ActorId[]>) {\n      if (Array.isArray(payload))\n        return state.filter((v) => payload.includes(v));\n      return state.filter((v) => v !== payload);\n    },\n  },\n});\n\nexport default detailActorSlice.reducer;\n\nexport const {\n  reset: resetDetailActor,\n  add: addDetailActor,\n  remove: removeDetailActor,\n} = detailActorSlice.actions;\n","import { Action, ThunkAction } from '@reduxjs/toolkit';\nimport { filter, find, flow, map, size } from 'lodash/fp';\nimport {\n  clearRelationSelection,\n  selectRelationSelection,\n} from '../../feature/relation/selectionSlice';\nimport { RootState } from '../../reducers';\nimport {\n  addDetailActor,\n  removeDetailActor,\n} from '../reducers/detail/actorSlice';\nimport { resetCurrent, setCurrent } from '../reducers/detail/maxActorsSlice';\nimport { selectDetailActorIds } from '../selectors/detail/actors';\nimport { selectMaxActors } from '../selectors/detail/maxActors';\nimport { ProsoVisActor } from '../types/actors';\n\nexport const tryAddDetailActorThunk = function (\n  payload: string\n): ThunkAction<void, RootState, unknown, Action<string>> {\n  return (dispatch, getState) => {\n    const state = getState();\n\n    const existing = selectDetailActorIds(state);\n    const maxSize = selectMaxActors(state);\n    if (size(existing) >= maxSize) dispatch(setCurrent(payload));\n    else dispatch(addDetailActor(payload));\n  };\n};\n\ntype CheckType = { actor: ProsoVisActor; checked: boolean };\n\nexport const validateDetailActorsThunk = function (payload: {\n  current: ProsoVisActor;\n  checkboxs: _.Dictionary<CheckType>;\n}): ThunkAction<void, RootState, unknown, Action<string>> {\n  return (dispatch, getState) => {\n    const relationSelection = selectRelationSelection(getState());\n    flow(\n      filter((v: CheckType) => v.checked),\n      map((v: CheckType) => v.actor.id),\n      removeDetailActor,\n      dispatch\n    )(payload.checkboxs);\n    dispatch(addDetailActor(payload.current.id));\n    if (\n      relationSelection &&\n      !find(\n        (chk) => chk.actor.id === relationSelection.actor,\n        payload.checkboxs\n      )?.checked\n    )\n      dispatch(clearRelationSelection());\n    dispatch(resetCurrent());\n  };\n};\n","import React, { useCallback, useState, useEffect, useMemo } from 'react';\nimport styled from 'styled-components/macro';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { XIcon, PlusIcon } from '@primer/octicons-react';\nimport { Flex } from '../../components/ui/Flex';\nimport ActorLabel from '../../components/ActorLabel';\nimport {\n  selectCurrent,\n  selectMaxActors,\n} from '../../v2/selectors/detail/maxActors';\nimport { resetCurrent } from '../../v2/reducers/detail/maxActorsSlice';\nimport { validateDetailActorsThunk } from '../../v2/thunks/actors';\nimport { selectDetailActors } from '../../v2/selectors/detail/actors';\nimport { filter, size } from 'lodash/fp';\nimport { mapValues, map } from 'lodash';\nimport { ProsoVisActor } from '../../v2/types/actors';\n\nexport const AbsolDiv = styled.div`\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  z-index: 9999;\n`;\nexport const GreyPlane = styled(AbsolDiv)`\n  background-color: black;\n  opacity: 0.2;\n  z-index: initial;\n`;\nexport const Flexible = styled.div`\n  display: flex;\n  height: 100%;\n  align-items: center;\n  justify-content: center;\n`;\nexport const ModalDiv = styled.div`\n  background-color: white;\n  position: relative;\n  max-width: 30em;\n  padding: 1em;\n  border-radius: 3px;\n  width: auto;\n  filter: drop-shadow(0 0 0.5em ${(props) => props.color || 'red'});\n`;\n\nexport const ActorModal: React.FC = function () {\n  const dispatch = useDispatch();\n  const actors = useSelector(selectDetailActors);\n  const maxActors = useSelector(selectMaxActors);\n  const current = useSelector(selectCurrent);\n  const [show, setShow] = useState(false);\n\n  useEffect(() => {\n    if (size(actors) >= maxActors && current != null) {\n      setShow(true);\n      setCheckboxs(mapValues(actors, (actor) => ({ actor, checked: true })));\n    }\n  }, [actors, maxActors, current]);\n\n  const [checkboxs, setCheckboxs] = useState(\n    {} as _.Dictionary<{ actor: ProsoVisActor; checked: boolean }>\n  );\n\n  useEffect(() => {\n    setCheckboxs(mapValues(actors, (actor) => ({ actor, checked: true })));\n  }, [actors]);\n\n  const switchCheckBox = useCallback((key: string) => {\n    setCheckboxs((state) =>\n      mapValues(state, (v, id) =>\n        id.toString() === key.toString()\n          ? { actor: v.actor, checked: !v.checked }\n          : v\n      )\n    );\n  }, []);\n\n  const handleClick = useCallback(() => {\n    if (current !== null)\n      dispatch(validateDetailActorsThunk({ current, checkboxs }));\n    setShow(false);\n  }, [dispatch, current, checkboxs]);\n\n  const handleCancel = useCallback(() => {\n    dispatch(resetCurrent());\n    setShow(false);\n  }, [dispatch]);\n\n  const checkedSize = useMemo(\n    () => filter((c) => c.checked, checkboxs).length,\n    [checkboxs]\n  );\n\n  const color = checkedSize < maxActors ? 'green' : undefined;\n  if (show)\n    return (\n      <AbsolDiv style={{ position: 'absolute' }}>\n        <GreyPlane></GreyPlane>\n        <Flexible>\n          <ModalDiv color={color}>\n            <h3>\n              Impossible d'avoir plus de 5 acteurs : veuillez en supprimer au\n              moins un.\n            </h3>\n            <hr />\n            {current && (\n              <div>\n                Nouvel acteur : <ActorLabel id={current} />\n              </div>\n            )}\n            <hr />\n            <ul>\n              {map(checkboxs, ({ actor, checked }, key) => (\n                <ActorLine\n                  key={key}\n                  actor={actor}\n                  switcher={switchCheckBox}\n                  checked={checked}\n                ></ActorLine>\n              ))}\n            </ul>\n            <hr />\n\n            <Flex justify=\"around\">\n              <button onClick={handleCancel}>Annuler</button>\n              <button onClick={handleClick} disabled={checkedSize >= maxActors}>\n                Terminer\n                {/* {checkedSize >= maxActors &&\n                  \" sans supprimer d'acteurs\" */}\n              </button>\n            </Flex>\n          </ModalDiv>\n        </Flexible>\n      </AbsolDiv>\n    );\n  else return null;\n};\n\nexport const ActorLine: React.FC<any> = function ({\n  actor,\n  checked,\n  switcher,\n}) {\n  const handleClick = useCallback(() => {\n    switcher(actor.id);\n  }, [switcher, actor.id]);\n\n  const Icon = checked ? XIcon : PlusIcon;\n  return (\n    <div\n      style={{\n        opacity: checked ? undefined : 0.3,\n      }}\n    >\n      <span className=\"pointer\" onClick={handleClick}>\n        <Icon\n          className=\"ma1 flex-shrink-0 red\"\n          verticalAlign=\"text-bottom\"\n          aria-label={'Supprimer'}\n        />\n      </span>\n      <ActorLabel id={actor} />\n    </div>\n  );\n};\n","import React from 'react';\nimport { SelectionEvent, setSelection } from '../reducers/selectionSlice';\nimport { useDispatch } from 'react-redux';\n\nexport function stopEventPropagation<E extends { stopPropagation: () => void }>(\n  event: E\n) {\n  event.stopPropagation();\n  return event;\n}\nexport function useFlatClick(callback: React.MouseEventHandler) {\n  return {\n    //eslint-disable-next-line\n    onClick: React.useCallback(flatEvent(callback), [callback]),\n    onMouseUp: stopEventPropagation,\n  };\n}\n\nexport function useClickSelect(interactive: SelectionEvent | SelectionEvent[]) {\n  const dispatch = useDispatch();\n  return useFlatClick(() => dispatch(setSelection(interactive)));\n}\n\nexport function flatEvent<T extends React.MouseEventHandler>(callback: T) {\n  return (event: React.MouseEvent) => callback(stopEventPropagation(event));\n}\n","import React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useFlatClick } from '../../hooks/useClick';\nimport fuzzysort from 'fuzzysort';\nimport { tryAddDetailActorThunk } from '../../v2/thunks/actors';\n\nconst highlight = (r: any, f: any, s = '\\xA9') =>\n  fuzzysort\n    .highlight(r, s, s)!\n    .split(s)\n    .map((s, i) => (i % 2 ? f(s, i) : s));\nexport const AutocompleteItem: React.FC<any> = function ({\n  r,\n  className,\n  onClick,\n}) {\n  const dispatch = useDispatch();\n  const clicky = useFlatClick(() => {\n    dispatch(tryAddDetailActorThunk(r.id));\n    onClick();\n  });\n  return (\n    <li className={className} id={'res-' + r.id} {...clicky}>\n      {highlight(r, (match: any, i: number) => (\n        <b key={`${match}_${i}`}>{match}</b>\n      ))}\n    </li>\n  );\n};\n\nexport default AutocompleteItem;\n","import React, { useState, useEffect } from 'react';\n\nimport fuzzysort from 'fuzzysort';\nimport { useSelector } from 'react-redux';\nimport styled from 'styled-components/macro';\nimport { AutocompleteItem } from './AutocompleteItem';\nimport { stopEventPropagation } from '../../hooks/useClick';\nimport { createSelector } from 'reselect';\nimport { selectDetailActors } from '../../v2/selectors/detail/actors';\nimport { selectActors } from '../../v2/selectors/actors';\nimport { filter, map } from 'lodash/fp';\n\nconst selectActorLabels = createSelector(selectActors, (actors) =>\n  map(\n    (n) => ({\n      id: n.id,\n      ...fuzzysort.prepare(\n        n.label.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n      )!,\n    }),\n    actors\n  )\n);\n\nconst options = { limit: 20, threshold: -10000 };\n\nconst AutocompleteItems = styled.ul`\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  background-color: #fff;\n  border: 1px solid black;\n  list-style-type: none;\n  padding: 0.25em;\n  border-radius: 3px;\n  margin: 0;\n  z-index: 1;\n`;\n\nconst Container = styled.div`\n  position: relative;\n`;\n\nconst StyledInput = styled.input`\n  border: 1px solid transparent;\n  background-color: #f1f1f1;\n  padding: 10px;\n  font-size: 16px;\n  background-color: #f1f1f1;\n  width: 100%;\n  line-height: 1.5;\n`;\n\nconst Item = styled(AutocompleteItem)`\n  border-bottom: 1px solid lightgray;\n  cursor: pointer;\n  padding: 0.25em 1em;\n  &:last-child {\n    border-bottom: none;\n  }\n\n  &:hover {\n    background-color: lightgray;\n  }\n`;\n\nconst Autocomplete: React.FC = function () {\n  const [text, setText] = useState('');\n  const [results, setResults] = useState<Fuzzysort.Result[]>([]);\n  const activeActors = useSelector(selectDetailActors);\n  const actorLabels = useSelector(selectActorLabels);\n\n  function handleChange(e: React.ChangeEvent<HTMLInputElement>) {\n    setText(e.target.value);\n  }\n\n  function clear() {\n    setText('');\n  }\n\n  useEffect(() => {\n    setResults(\n      filter(\n        (r) => activeActors[(r as any).id] === undefined,\n        fuzzysort.go(text, actorLabels, options)\n      )\n    );\n  }, [text, activeActors, actorLabels]);\n\n  return (\n    <Container onMouseUpCapture={stopEventPropagation}>\n      <StyledInput\n        type=\"text\"\n        value={text}\n        onChange={handleChange}\n        placeholder=\"Actor search\"\n      />\n      {results.length > 0 && (\n        <AutocompleteItems>\n          {results.map((r) => (\n            <Item key={(r as any).id} r={r} onClick={clear} />\n          ))}\n        </AutocompleteItems>\n      )}\n    </Container>\n  );\n};\n\nexport default Autocomplete;\n","import { useEffect } from 'react';\nfunction useMount(fn: () => (() => void) | void) {\n  // eslint-disable-next-line\n  useEffect(fn, []);\n}\n\nexport default useMount;\n","export const moongray = '#eee';\nexport const disabled = '#ccc';\nexport const lightgray = 'lightgray';\nexport const darkgray = '#6c757d';\nexport const red = '#d73a49';\nexport const orange = '#f66a0a';\nexport const blue = '#2188ff';\n\nexport const animation = '200ms';\n\nconst theme = {\n  moongray,\n  lightgray,\n  darkgray,\n  red,\n  orange,\n  blue,\n  animation,\n};\nexport default theme;\n","import React from 'react';\nimport { isNil } from 'lodash/fp';\nimport styled, { keyframes } from 'styled-components/macro';\n\nconst LoadingSplash = styled.div`\n  position: absolute;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  background-color: rgba(0, 0, 0, 0.1);\n  backdrop-filter: blur(2px);\n  z-index: 500; /* higher than leaflet */\n`;\n\nconst rotate = keyframes`{\n    to { transform: rotate(360deg); }\n  }`;\n\nconst Spinner = styled.span<{ size?: number }>`\n  width: ${({ size = 3 }) => size}em;\n  height: ${({ size = 3 }) => size}em;\n  vertical-align: text-bottom;\n  border: 0.25em solid white;\n  border-right-color: transparent;\n  border-radius: 50%;\n  animation: ${rotate} 0.75s linear infinite;\n`;\n\nconst FullWidth = styled.div`\n  width: 100%;\n  height: 100%;\n  position: relative;\n  overflow: hidden;\n`;\n\nconst Loading: React.FC<{\n  finished: any;\n  size?: number;\n  hide?: boolean;\n  className?: string;\n}> = function ({ className, finished, size = 3, children, hide = false }) {\n  const loading = isNil(finished);\n  return loading ? (\n    <FullWidth className={className}>\n      {!hide && children}\n      <LoadingSplash>\n        <Spinner size={size} />\n      </LoadingSplash>\n    </FullWidth>\n  ) : (\n    <>{children}</>\n  );\n};\n\nexport default Loading;\n","import { RootState } from '../../../reducers';\n\nexport const selectSummary = (state: RootState) => state.actorSummary;\n","import { RootState } from '../../reducers';\nimport { createSelector } from 'reselect';\n\nexport const selectGraphData = (state: RootState) => state.graphData;\n\nexport const selectGraph = createSelector(selectGraphData, (g) => g.graph);\n","import { RootState } from '../reducers';\nimport { createSelector } from '@reduxjs/toolkit';\nimport * as d3 from 'd3';\nimport { selectDetailActors } from '../v2/selectors/detail/actors';\nimport { map, slice, zip, filter, find, unzip, concat } from 'lodash';\n\nexport const selectColor = (state: RootState) => state.color;\nexport const selectDomain = createSelector(selectColor, (c) => c.kindDomain);\nexport const selectKindRange = createSelector(selectColor, (c) => c.kindRange);\nexport const selectActorRange = createSelector(\n  selectColor,\n  (c) => c.actorRange\n);\n\nexport const selectKindColor = createSelector(\n  selectDomain,\n  selectKindRange,\n  (domain, range) =>\n    d3.scaleOrdinal<string, string>().domain(domain).range(range)\n);\n\nconst actorColor = d3.scaleOrdinal<string, string>();\nexport const selectActorColor = createSelector(\n  selectActorRange,\n  selectDetailActors,\n  (range, actors) => {\n    let oldDomain = actorColor.domain();\n    if (oldDomain.length === 0) {\n      oldDomain = map(actors, 'id');\n    }\n\n    let oldRange = actorColor.range();\n    if (oldRange.length === 0) oldRange = range;\n\n    const trimmedRange = slice(oldRange, 0, oldDomain.length);\n    const left = slice(oldRange, oldDomain.length);\n\n    const zipped = zip(oldDomain, trimmedRange) as [string, string][];\n    // what's in zipped and actor\n    const keep = filter(\n      zipped,\n      ([id]) => find(actors, (a) => a.id === id) !== undefined\n    );\n    // what's in zipped but not actor\n    const discard = filter(\n      zipped,\n      ([id]) => find(actors, (a) => a.id === id) === undefined\n    );\n    // what's in actor but not in zipped\n    const add = filter(\n      actors,\n      (a) => find(zipped, ([id]) => a.id === id) === undefined\n    );\n    if (discard.length >= add.length) {\n      const [, rainbow] = unzip(discard) as [string[], string[]];\n      keep.push(\n        ...(zip(map(add, 'id'), slice(rainbow, 0, add.length)) as [\n          string,\n          string\n        ][])\n      );\n\n      const [newDomain, newRange] = unzip(keep) as [string[], string[]];\n\n      if (!newDomain && !newRange) {\n        return actorColor.range([]).domain([]).copy();\n      }\n\n      actorColor\n        .range(concat(newRange, slice(rainbow, add.length), left))\n        .domain(newDomain);\n      return actorColor.copy();\n    } else {\n      const [newDomain, newRange] = unzip(keep) as [string[], string[]];\n      actorColor\n        .range(concat(newRange, left))\n        .domain(concat(newDomain, map(add, 'id')));\n      return actorColor.copy();\n    }\n  }\n);\n","import { createSelector } from '@reduxjs/toolkit';\nimport * as d3 from 'd3';\nimport { RootState } from '../reducers';\nimport {\n  selectCustomFilterColor,\n  selectDefaultCustomFilter,\n  selectDefaultFilterResolver,\n} from '../v2/selectors/mask/customFilter';\nimport { RichEvent } from '../v2/types/events';\nimport { selectActorColor, selectKindColor } from './color';\n\nexport const selectSwitch = (state: RootState) => state.switch;\n\nexport const selectSwitchIsActor = createSelector(\n  selectSwitch,\n  (switcher) => switcher === 'Actor'\n);\n\nexport const selectMainColor = createSelector(\n  selectKindColor,\n  selectCustomFilterColor,\n  selectDefaultCustomFilter,\n  (kind, main, selected) => (selected?.name === 'event.kind' ? kind : main)\n);\n\nexport const selectSwitchColor = createSelector(\n  selectSwitchIsActor,\n  selectMainColor,\n  selectActorColor,\n  (switcher, main, actor) => (switcher ? actor : main)\n);\n\nexport const selectSwitchKindColor = createSelector(\n  selectSwitchIsActor,\n  selectKindColor,\n  selectDefaultCustomFilter,\n  (switcher, kind, selected) =>\n    !switcher && selected?.name === 'event.kind' ? kind : null\n);\n\nexport const selectSwitchMainColor = createSelector(\n  selectSwitchIsActor,\n  selectMainColor,\n  (switcher, main) => (!switcher ? main : undefined)\n);\n\nexport const selectSwitchActorColor = createSelector(\n  selectSwitchIsActor,\n  selectActorColor,\n  (switcher, actor) => (switcher ? actor : null)\n);\n\nexport const selectDefaultGroupBy = createSelector(\n  selectSwitchIsActor,\n  selectDefaultFilterResolver,\n  (switcher, path): ((d: RichEvent) => string) =>\n    switcher ? ({ actor }) => actor.id : path\n);\n\nexport const selectRichEventColor = createSelector(\n  selectSwitchIsActor,\n  selectActorColor,\n  selectMainColor,\n  selectDefaultFilterResolver,\n  function (switcher, actor, main, path) {\n    if (switcher) {\n      const border = d3\n        .scaleOrdinal<string, string>(\n          actor.range().map((d) => d3.color(d)!.darker(2).toString())\n        )\n        .domain(actor.domain());\n      return {\n        main: (e: RichEvent) => actor(e.actor.id),\n        border: (e: RichEvent) => border(e.actor.id),\n      };\n    } else {\n      const border = d3\n        .scaleOrdinal<string, string>(\n          main.range().map((d) => d3.color(d)!.darker(2).toString())\n        )\n        .domain(main.domain());\n      return {\n        main: (e: RichEvent) => main(path(e)),\n        border: (e: RichEvent) => border(path(e)),\n      };\n    }\n  }\n);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nconst actorSummarySlice = createSlice({\n  name: 'actor-summary',\n  initialState: null as { x: number; y: number; actor: string } | null,\n  reducers: {\n    set(\n      _state,\n      { payload }: PayloadAction<{ x: number; y: number; actor: string }>\n    ) {\n      return payload;\n    },\n    reset() {\n      return null;\n    },\n  },\n});\n\nexport default actorSummarySlice.reducer;\n\nexport const {\n  set: setActorSummary,\n  reset: resetActorSummary,\n} = actorSummarySlice.actions;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { InteractionPayload } from '../../types/interaction';\n\nexport const globalHighlightSlice = createSlice({\n  name: 'global/highlight',\n  initialState: [] as InteractionPayload[],\n  reducers: {\n    reset() {\n      return [];\n    },\n    set(\n      state,\n      { payload }: PayloadAction<InteractionPayload | InteractionPayload[]>\n    ) {\n      if (Array.isArray(payload)) return payload;\n      return [payload];\n    },\n  },\n});\n\nexport default globalHighlightSlice.reducer;\n\nexport const {\n  reset: resetGlobalHighlight,\n  set: setGlobalHighlight,\n} = globalHighlightSlice.actions;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { InteractionPayload } from '../../types/interaction';\n\nexport const globalSelectionSlice = createSlice({\n  name: 'global/selection',\n  initialState: [] as InteractionPayload[],\n  reducers: {\n    reset() {\n      return [];\n    },\n    set(\n      state,\n      { payload }: PayloadAction<InteractionPayload | InteractionPayload[]>\n    ) {\n      if (Array.isArray(payload)) return payload;\n      return [payload];\n    },\n  },\n});\n\nexport default globalSelectionSlice.reducer;\n\nexport const {\n  reset: resetGlobalSelection,\n  set: setGlobalSelection,\n} = globalSelectionSlice.actions;\n","import { reduce } from 'lodash/fp';\nimport {\n  InteractionPayload,\n  isEventInteraction,\n} from '../../types/interaction';\n\nexport function createInteractionMap(state: InteractionPayload[]) {\n  return reduce(\n    (acc, v) => {\n      if (isEventInteraction(v)) {\n        acc.events[v.event] = true;\n        acc.partActors[v.actor] = true;\n      } else {\n        acc.actors[v.actor] = true;\n      }\n      return acc;\n    },\n    { events: {}, partActors: {}, actors: {} } as {\n      events: _.Dictionary<boolean>;\n      partActors: _.Dictionary<boolean>;\n      actors: _.Dictionary<boolean>;\n    },\n    state\n  );\n}\n","type InteractionActor = { actor: string };\ntype InteractionEvent = { event: string; actor: string };\nexport type InteractionPayload = InteractionActor | InteractionEvent;\n\nexport function isEventInteraction(\n  v: InteractionPayload\n): v is InteractionEvent {\n  return (v as any).event !== undefined;\n}\n","import { createSelector } from 'reselect';\nimport { RootState } from '../../../reducers';\nimport { createInteractionMap } from './utils';\n\nexport const selectGlobalHighlight = (state: RootState) =>\n  state.globalHighlight;\n\nexport const selectGlobalHighlightMap = createSelector(\n  selectGlobalHighlight,\n  createInteractionMap\n);\n","import { RootState } from '../../../reducers';\n\nexport const selectGlobalSelection = (state: RootState) =>\n  state.globalSelection;\n\n// export const selectGlobalSelectionMap = createSelector(\n//   selectGlobalSelection,\n//   createInteractionMap\n// );\n","import { isAfter, isBefore, isWithinInterval, parseISO } from 'date-fns';\nimport { latLngBounds } from 'leaflet';\nimport { filter, isNil } from 'lodash/fp';\nimport { createSelector } from 'reselect';\nimport { RichEvent } from '../../types/events';\nimport { ProsoVisPlace } from '../../types/localisations';\nimport { selectRichEvents } from '../events';\nimport { selectCustomFiltersFun } from './customFilter';\nimport { selectMaskGlobalMapBounds } from './globalMapBounds';\nimport { selectMaskGlobalTime } from './globalTime';\n\n/**\n * filter: kinds\n */\nexport const selectEventsWithoutKinds = createSelector(\n  selectRichEvents,\n  selectCustomFiltersFun,\n  (events, filters) => events && filter<RichEvent>(filters, events)\n);\n\n/**\n * filter: map\n */\nexport const selectRichEventsWithoutMapBounds = createSelector(\n  selectEventsWithoutKinds,\n  selectMaskGlobalMapBounds,\n  function (events, bounds) {\n    if (!events) return;\n    const lBounds = bounds ? latLngBounds(bounds) : null;\n\n    return filter(({ place }) => {\n      return lBounds && hasCoordinates(place) // event has localisations\n        ? // has bounds\n          lBounds.contains([+place.lat!, +place.lng!])\n        : true; // if is uncoordinated or bounds are not defined, then, do not filter out\n    }, events);\n  }\n);\n\n/* utilities for determining position and coordinates :) */\n\nexport function hasCoordinates(\n  place?: ProsoVisPlace\n): place is Required<ProsoVisPlace> {\n  return !isNil(place?.lat) && !isNil(place?.lng);\n}\n\nexport const selectRichEventsBackgroundTimed = createSelector(\n  selectRichEventsWithoutMapBounds,\n  existTime\n);\n\n/**\n * filter: time\n */\nexport const selectRichEventsFiltered = createSelector(\n  selectRichEventsWithoutMapBounds,\n  selectMaskGlobalTime,\n  function (events, bounds) {\n    if (!events) return;\n    return filter(({ event: { datation } }) => {\n      if (isNil(datation) || datation.length === 0 || isNil(bounds))\n        return true;\n\n      if (datation.length === 1) {\n        return isWithinInterval(parseISO(datation[0].value), bounds);\n      } else {\n        const [start, end] = datation;\n\n        return !(\n          isBefore(bounds.end, parseISO(start.value)) ||\n          isAfter(bounds.start, parseISO(end.value))\n        );\n      }\n    }, events);\n  }\n);\n\n/**\n * Exist:Time\n */\nexport const selectRichEventsTimed = createSelector(\n  selectRichEventsFiltered,\n  existTime\n);\n\nexport type RichEventLocalised = Omit<RichEvent, 'place'> & {\n  place: Omit<ProsoVisPlace, 'lng' | 'lat'> & {\n    lat: number;\n    lng: number;\n  };\n};\n\n/**\n * Exist: GPS\n */\nexport const selectRichEventLocalised = createSelector(\n  selectRichEventsFiltered,\n\n  (events) =>\n    events &&\n    (filter(\n      ({ place }) => hasCoordinates(place),\n      events\n    ) as RichEventLocalised[])\n);\n\n/** exist: Time */\nfunction existTime(events: RichEvent[] | undefined) {\n  return (\n    events &&\n    filter(\n      ({ event: { datation } }) => !isNil(datation) && datation.length > 0,\n      events\n    )\n  );\n}\n","import { RootState } from '../../../reducers';\n\nexport const selectMaskGlobalMapBounds = (state: RootState) =>\n  state.maskGlobalMapBounds;\n","import { RootState } from '../../../reducers';\n\nexport const selectMaskGlobalTime = (state: RootState) => state.maskGlobalTime;\n","import { reduce } from 'd3';\nimport { isEmpty } from 'lodash';\nimport { createSelector } from 'reselect';\nimport { selectGlobalHighlight } from '../../selectors/global/highlight';\nimport { selectGlobalSelection } from '../../selectors/global/selection';\nimport { selectRichEventsFiltered } from '../../selectors/mask';\nimport { selectRelationsMap } from '../../selectors/relations';\n\n/** fn: active */\nexport const selectSelectedNeighbours = createSelector(\n  selectRelationsMap,\n  selectGlobalSelection,\n  (relations, selection) =>\n    isEmpty(selection)\n      ? null\n      : selection.reduce(\n          (acc, { actor }) => {\n            acc.actors[actor] = true;\n            const friends = relations?.get(actor)?.values();\n            if (friends) {\n              reduce(\n                friends,\n                (acc, friend) => {\n                  acc[friend] = true;\n                  return acc;\n                },\n                acc.friends\n              );\n            }\n            return acc;\n          },\n          { actors: {}, friends: {} } as {\n            actors: _.Dictionary<boolean>;\n            friends: _.Dictionary<boolean>;\n          }\n        )\n);\n\nexport const selectHighlightNeighbours = createSelector(\n  selectRelationsMap,\n  selectGlobalHighlight,\n  (relations, selection) =>\n    isEmpty(selection)\n      ? null\n      : selection.reduce(\n          (acc, { actor }) => {\n            acc.actors[actor] = true;\n            const friends = relations?.get(actor)?.values();\n            if (friends) {\n              reduce(\n                friends,\n                (acc, friend) => {\n                  acc[friend] = true;\n                  return acc;\n                },\n                acc.friends\n              );\n            }\n            return acc;\n          },\n          { actors: {}, friends: {} } as {\n            actors: _.Dictionary<boolean>;\n            friends: _.Dictionary<boolean>;\n          }\n        )\n);\n\nexport const selectActorsFiltered = createSelector(\n  selectRichEventsFiltered,\n  (events) =>\n    events &&\n    reduce(\n      events,\n      (acc, e) => {\n        acc[e.event.actor] = true;\n        return acc;\n      },\n      {} as _.Dictionary<boolean>\n    )\n);\n","import React, { MouseEvent, useCallback, useMemo } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport styled from 'styled-components/macro';\nimport ActorLabel from '../../../components/ActorLabel';\nimport { useFlatClick } from '../../../hooks/useClick';\nimport { selectSwitchActorColor } from '../../../selectors/switch';\nimport { lightgray, moongray, darkgray } from '../../components/theme';\nimport { setActorSummary } from '../../reducers/global/actorSummarySlice';\nimport {\n  resetGlobalHighlight,\n  setGlobalHighlight,\n} from '../../reducers/global/highlightSlice';\nimport { setGlobalSelection } from '../../reducers/global/selectionSlice';\nimport { selectDetailActors } from '../../selectors/detail/actors';\nimport { ProsoVisNode } from '../../types/graph';\nimport {\n  selectActorsFiltered,\n  selectHighlightNeighbours,\n  selectSelectedNeighbours,\n} from './selectors';\n\nfunction useColor(id: string) {\n  const actors = useSelector(selectDetailActors);\n  const color = useSelector(selectSwitchActorColor);\n\n  return color && actors[id] ? color(id) : undefined;\n}\n\nexport const GraphNode: React.FC<ProsoVisNode> = function ({\n  id,\n  label,\n  x,\n  y,\n  width,\n  height,\n}) {\n  const dispatch = useDispatch();\n  const selected = useSelector(selectSelectedNeighbours);\n  const highlighted = useSelector(selectHighlightNeighbours);\n  const filtered = useSelector(selectActorsFiltered);\n  const color = useColor(id);\n\n  const { handleClick, handleMouseEnter, handleMouseLeave } = useMemo(\n    () => ({\n      handleClick() {\n        dispatch(setGlobalSelection({ actor: id }));\n      },\n      handleMouseEnter(e: MouseEvent<SVGGElement>) {\n        if (e.buttons === 0) {\n          dispatch(setGlobalHighlight({ actor: id }));\n        }\n      },\n      handleMouseLeave() {\n        dispatch(resetGlobalHighlight());\n      },\n    }),\n    [dispatch, id]\n  );\n\n  const handleContextMenu = useCallback(\n    (e: MouseEvent<SVGGElement>) => {\n      e.preventDefault();\n      dispatch(setActorSummary({ x: x + width, y: y, actor: id }));\n    },\n    [dispatch, id, x, width, y]\n  );\n\n  const g = {\n    opacity:\n      highlighted?.actors[id] ||\n      !filtered ||\n      (filtered[id] &&\n        (!selected || selected.friends[id] || selected.actors[id]))\n        ? 1\n        : 0.4,\n  };\n\n  const rect = {\n    fill: color ?? (selected?.actors[id] ? darkgray : undefined),\n    strokeWidth: highlighted?.actors[id]\n      ? 4\n      : selected?.actors[id]\n      ? 2\n      : undefined,\n    stroke:\n      selected?.actors[id] || highlighted?.actors[id]\n        ? 'black'\n        : highlighted?.friends[id]\n        ? 'darkgoldenrod'\n        : selected?.friends[id]\n        ? 'black'\n        : undefined,\n  };\n\n  const text = {\n    fill: color ? undefined : selected?.actors[id] ? moongray : undefined,\n  };\n  return (\n    <g\n      style={{\n        transform: `translate3d(${x}px, ${y}px, 0)`,\n        ...g,\n        transitionDuration: '250ms',\n      }}\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n      onContextMenu={handleContextMenu}\n      {...useFlatClick(handleClick)}\n    >\n      <ActorLabel as=\"title\" id={id} />\n      <StyledRect width={width} height={height} {...rect} />\n      <StyledText\n        dx={width / 2}\n        dy={height / 2 + 1}\n        dominantBaseline=\"middle\"\n        style={{ ...text }}\n      >\n        {label}\n      </StyledText>\n    </g>\n  );\n};\nconst StyledRect = styled.rect<{\n  fill?: string;\n  stroke?: string;\n  strokeWidth?: number;\n}>`\n  fill: ${({ fill }) => fill ?? lightgray};\n  stroke: ${({ stroke }) => stroke};\n  stroke-width: ${({ strokeWidth }) => strokeWidth};\n`;\n\nexport const StyledText = styled.text`\n  font-size: 12px;\n  text-anchor: middle;\n  user-select: none;\n`;\n","import { darkgray, lightgray } from '../v2/components/theme';\n\nexport const scrollbar = `\n&::-webkit-scrollbar-corner {\n  background-color: transparent;\n  border-color: transparent;\n}\n&::-webkit-scrollbar-thumb {\n  border-radius: 10px;\n  background-color: ${darkgray};\n}\n&::-webkit-scrollbar {\n  width: 10px;\n  height: 10px;\n  border-radius: 10px;\n  background-color: ${lightgray};\n}`;\n","import styled from 'styled-components/macro';\n\nexport const StyledFlex = styled.div`\n  display: flex;\n`;\n\nexport const GrowFlexItem = styled.div`\n  flex: 1;\n`;\n\nexport const EnlargeFlex = styled.div`\n  flex: 1;\n  display: flex;\n  align-items: center;\n`;\n","import styled from 'styled-components/macro';\n\nexport const IconSpacer = styled.div<{\n  spaceRight?: boolean;\n  spaceLeft?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  ${({ spaceRight }) => spaceRight && 'margin-right: 0.25em;'}\n  ${({ spaceLeft }) => spaceLeft && 'margin-left: 0.25em;'}\n`;\nexport const IconSpacerPointer = styled(IconSpacer)`\n  cursor: pointer;\n`;\n","import React from 'react';\nimport { Icon } from '@primer/octicons-react';\n\nconst Pause: Icon = function ({\n  className = 'octicon',\n  'aria-label': ariaLabel,\n  verticalAlign = 'text-bottom',\n}) {\n  return (\n    <svg\n      viewBox=\"0 0 16 16\"\n      width=\"16\"\n      height=\"16\"\n      fill=\"currentColor\"\n      style={{\n        display: 'inline-block',\n        userSelect: 'none',\n        verticalAlign: verticalAlign,\n      }}\n      aria-label={ariaLabel}\n      className={className}\n    >\n      <path\n        fillRule=\"evenodd\"\n        d=\"M4,2 L7,2 L7,14 L4,14 Z M9,2 L12,2 L12,14 L9,14 Z M9,2\"\n      />\n    </svg>\n  );\n};\nexport default Pause;\n","import React from 'react';\nimport { Icon } from '@primer/octicons-react';\n\nconst Grave: Icon = function ({\n  className = 'octicon',\n  'aria-label': ariaLabel,\n  verticalAlign = 'text-bottom',\n}) {\n  return (\n    <svg\n      viewBox=\"0 0 16 16\"\n      width=\"16\"\n      height=\"16\"\n      fill=\"currentColor\"\n      style={{\n        display: 'inline-block',\n        userSelect: 'none',\n        verticalAlign: verticalAlign,\n      }}\n      aria-label={ariaLabel}\n      className={className}\n    >\n      <path\n        fillRule=\"evenodd\"\n        d=\"M12.8,5.6c0-3.1-2.5-5.6-5.6-5.6S1.6,2.5,1.6,5.6v7.2c-0.9,0-1.6,0.7-1.6,1.6V16l0,0h14.4l0,0v-1.6c0-0.9-0.7-1.6-1.6-1.6\n\tV5.6z M10.4,9.6H4V8h6.4C10.4,8,10.4,9.6,10.4,9.6z M10.4,6.4H4V4.8h6.4C10.4,4.8,10.4,6.4,10.4,6.4z\"\n      />\n    </svg>\n  );\n};\n\nexport default Grave;\n","import {\n  PlusIcon,\n  MortarBoardIcon,\n  BookIcon,\n  BookmarkIcon,\n  HomeIcon,\n  Icon,\n  IconProps,\n  QuestionIcon,\n} from '@primer/octicons-react';\nimport Pause from '../feature/info/event/Pause';\nimport Grave from '../feature/info/event/Grave';\n\nimport styled, { StyledComponent } from 'styled-components/macro';\n\nexport const styleIcon = (icon: Icon) =>\n  styled(icon)<{\n    iconColor?: string;\n  }>(({ iconColor }) => (iconColor ? `color: ${iconColor};` : ''));\nexport const kindMap: _.Dictionary<\n  StyledComponent<\n    React.FC<IconProps>,\n    any,\n    {\n      iconColor?: string | undefined;\n    },\n    never\n  >\n> = {\n  Birth: styleIcon(PlusIcon),\n  Death: styleIcon(Grave),\n  Education: styleIcon(BookIcon),\n  ObtainQualification: styleIcon(MortarBoardIcon),\n  PassageExamen: styleIcon(BookmarkIcon),\n  Retirement: styleIcon(HomeIcon),\n  SuspensionActivity: styleIcon(Pause),\n};\n\nfunction getEventIcon(kind: string) {\n  return kindMap[kind] ?? styleIcon(QuestionIcon);\n}\n\nexport default getEventIcon;\n","const fr: _.Dictionary<string> = {\n  Birth: 'Naissance',\n  Death: 'Décès',\n  Education: 'Enseignement',\n  ObtainQualification: 'Obtention de qualité',\n  PassageExamen: \"Passage d'un examen\",\n  Retirement: 'Retraite',\n  SuspensionActivity: \"Suspension d'activité\",\n};\n\nfunction eventKind(kind: string) {\n  return fr[kind];\n}\nexport default eventKind;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nconst modalRoot = document.getElementById('modals')!;\n\nconst Modal: React.FC = function ({ children }) {\n  return ReactDOM.createPortal(children, modalRoot);\n};\n\nexport default Modal;\n","import React, { useState, useLayoutEffect } from 'react';\nfunction useDimensions<T extends HTMLElement | SVGElement>(\n  ref: React.MutableRefObject<T>\n) {\n  const [dims, setDims] = useState(() =>\n    ref.current ? getDimensionObject(ref.current) : null\n  );\n\n  useLayoutEffect(() => {\n    ref.current && setDims(getDimensionObject(ref.current));\n  }, [ref]);\n\n  return dims;\n}\n\nexport function getDimensionObject<T extends HTMLElement | SVGElement>(\n  node: T\n) {\n  const rect = node.getBoundingClientRect();\n\n  return rect;\n}\n\nexport default useDimensions;\n","import React, { useLayoutEffect, useRef, useState } from 'react';\nimport styled from 'styled-components/macro';\nimport Modal from '../../feature/modal/Modal';\nimport { getDimensionObject } from '../../hooks/useDimensions';\nimport { darkgray } from '../../v2/components/theme';\n\ntype PopperType<T extends HTMLElement | SVGElement> = {\n  as?: keyof JSX.IntrinsicElements | React.ComponentType<any>;\n  content: React.ReactNode;\n  offset?: {\n    x: number;\n    y: number;\n  };\n  position?: 'north' | 'north-west' | 'north-east' | 'south-west-right';\n  children: (\n    $ref: React.MutableRefObject<T>,\n    showPopper: () => void,\n    hidePopper: () => void\n  ) => React.ReactNode;\n};\n\nfunction computePosition(\n  child: DOMRect,\n  content: DOMRect,\n  orientation: NonNullable<PopperType<HTMLElement>['position']>\n) {\n  switch (orientation) {\n    case 'north':\n      return {\n        left: child.left + child.width / 2 - content.width / 2,\n        top: child.top - (content.height + 4),\n      };\n\n    case 'north-east':\n      return {\n        left: child.right + 8,\n        top: child.top - 4,\n      };\n\n    case 'north-west':\n      // console.log(content.width, child.left);\n      return {\n        left: child.left - (content.width + 8),\n        top: child.top + 4,\n      };\n    case 'south-west-right':\n      return {\n        left: child.right - content.width,\n        top: child.bottom + 4,\n      };\n  }\n}\n\nexport function useRefPopper<T extends HTMLElement | SVGElement>(\n  content: React.ReactNode,\n  position: PopperType<HTMLElement>['position'] = 'north',\n  StyledPopper:\n    | keyof JSX.IntrinsicElements\n    | React.ComponentType<any> = BlackPopper\n): [React.ReactNode, React.MutableRefObject<T>, () => void, () => void] {\n  const $ref = useRef<T>(null as any);\n\n  const [jsxcontent, show, hide] = usePopper(\n    $ref,\n    content,\n    position,\n    StyledPopper\n  );\n  return [jsxcontent, $ref, show, hide];\n}\n\nexport function useDimsPopper<\n  T extends HTMLElement | SVGElement,\n  C extends HTMLElement | SVGElement\n>(\n  $ref: React.MutableRefObject<T>,\n  $content: React.MutableRefObject<C>,\n  position: PopperType<HTMLElement>['position'] = 'north'\n): [\n  { left: number; top: number } | { display: 'none' } | undefined,\n  () => void,\n  () => void\n] {\n  const [show, setShow] = useState(false);\n  const [dims, setDims] = useState<{ left: number; top: number } | undefined>(\n    undefined\n  );\n\n  useLayoutEffect(() => {\n    if (show) {\n      const childDims = getDimensionObject($ref.current);\n      const contentDims = getDimensionObject($content.current);\n\n      setDims(computePosition(childDims, contentDims, position));\n    } else {\n      setDims(undefined);\n    }\n  }, [show, position, $ref, $content]);\n\n  return [show ? dims : { display: 'none' }, showPopper, hidePopper];\n\n  function showPopper() {\n    setShow(true);\n  }\n\n  function hidePopper() {\n    setShow(false);\n  }\n}\n\nexport function usePopper<T extends HTMLElement | SVGElement>(\n  $ref: React.MutableRefObject<T>,\n  content: React.ReactNode,\n  position: PopperType<HTMLElement>['position'] = 'north',\n  StyledPopper:\n    | keyof JSX.IntrinsicElements\n    | React.ComponentType<any> = BlackPopper\n): [React.ReactNode, () => void, () => void] {\n  const $content = useRef<HTMLDivElement>(null as any);\n\n  const [show, setShow] = useState(false);\n  const [dims, setDims] = useState<{ left: number; top: number } | undefined>(\n    undefined\n  );\n\n  useLayoutEffect(() => {\n    if (show) {\n      const childDims = getDimensionObject($ref.current);\n      const contentDims = getDimensionObject($content.current);\n\n      setDims(computePosition(childDims, contentDims, position));\n    } else {\n      setDims(undefined);\n    }\n  }, [show, position, $ref]);\n\n  return [\n    <Modal>\n      <StyledPopper ref={$content} style={show ? dims : { display: 'none' }}>\n        {content}\n      </StyledPopper>\n    </Modal>,\n    showPopper,\n    hidePopper,\n  ];\n\n  function showPopper() {\n    setShow(true);\n  }\n\n  function hidePopper() {\n    setShow(false);\n  }\n}\n\nexport const Popper = function <T extends HTMLElement | SVGElement>({\n  as = BlackPopper,\n  content,\n  children,\n  position = 'north',\n}: PopperType<T>) {\n  const [jsxcontent, $ref, show, hide] = useRefPopper<T>(content, position, as);\n\n  return (\n    <>\n      {children($ref, show, hide)}\n      {jsxcontent}\n    </>\n  );\n};\n\nconst BlackPopper = styled.div`\n  z-index: 9999;\n  top: 0;\n  position: absolute;\n  background-color: ${darkgray};\n  border-radius: 3px;\n  color: white;\n  padding: 0.5em;\n  font-size: 12px;\n  line-height: 1.2;\n`;\n","import React from 'react';\nimport styled from 'styled-components/macro';\nimport { ProsoVisDate, ProsoVisEvent } from '../types/events';\nimport { Popper } from '../../components/ui/Popper';\nimport { isNil } from 'lodash/fp';\n\nconst StyledTime = styled.time`\n  white-space: nowrap;\n  font-size: 12px;\n`;\n\nexport const ProsoVisDateLabel: React.FC<{\n  datation: ProsoVisDate;\n  showTooltip?: boolean;\n  className?: string;\n}> = function ({ datation: d, showTooltip = true, className }) {\n  if (showTooltip) {\n    return <Popper content={`${d.kind} - ${d.value}`} children={children} />;\n  }\n\n  return (\n    <StyledTime\n      aria-label={`${d.kind} - ${d.value}`}\n      dateTime={d.value}\n      data-uri={d.uri}\n      className={className}\n    >\n      {d.label}\n    </StyledTime>\n  );\n\n  function children(\n    $ref: React.MutableRefObject<HTMLSpanElement>,\n    show: () => void,\n    hide: () => void\n  ) {\n    return (\n      <StyledTime\n        aria-label={`${d.kind} - ${d.value}`}\n        dateTime={d.value}\n        data-uri={d.uri}\n        ref={$ref}\n        className={className}\n        onMouseEnter={show}\n        onFocus={show}\n        onMouseLeave={hide}\n        onBlur={hide}\n      >\n        {d.label}\n      </StyledTime>\n    );\n  }\n};\n\nconst EventDateBase = styled.div`\n  text-align: right;\n`;\n\nconst WrapEventDate = styled(EventDateBase)`\n  display: flex;\n  flex-wrap: wrap;\n  max-width: 7em;\n  justify-content: flex-end;\n`;\n\nconst SpacedDateLabel = styled(ProsoVisDateLabel)`\n  margin-left: 0.5em;\n`;\n\nexport const ProsoVisDates: React.FC<{\n  dates: ProsoVisEvent['datation'];\n  showTooltip?: boolean;\n}> = function ({ dates, showTooltip }) {\n  if (isNil(dates) || dates.length === 0) return null;\n\n  if (dates.length === 1) {\n    return (\n      <EventDateBase>\n        <ProsoVisDateLabel datation={dates[0]} showTooltip={showTooltip} />\n      </EventDateBase>\n    );\n  }\n  // dates = dates as [ProsoVisDate, ProsoVisDate, ...ProsoVisDate[]];\n\n  if (dates.length > 2) {\n    console.error('there is more than two dates', dates);\n  }\n\n  return (\n    <WrapEventDate>\n      <ProsoVisDateLabel datation={dates[0]!} showTooltip={showTooltip} />\n      <SpacedDateLabel datation={dates[1]!} showTooltip={showTooltip} />\n    </WrapEventDate>\n  );\n};\n","import React from 'react';\nimport { useSelector } from 'react-redux';\nimport styled from 'styled-components/macro';\nimport { StyledFlex } from '../../../components/ui/Flex/styled-components';\nimport { IconSpacer } from '../../../components/ui/IconSpacer';\nimport getEventIcon from '../../../data/getEventIcon';\nimport eventKind from '../../../i18n/event-kind';\nimport { selectSwitchKindColor } from '../../../selectors/switch';\nimport { ProsoVisDates } from '../../components/ProsoVisDateComponent';\nimport { ProsoVisDate } from '../../types/events';\n\nexport const SummaryEvent: React.FC<{\n  kind: string;\n  events: number;\n  datation: ProsoVisDate[];\n}> = function ({ kind, events, datation }) {\n  const color = useSelector(selectSwitchKindColor);\n  const Icon = getEventIcon(kind);\n  return (\n    <StyledEventLine>\n      <span>{events}x</span>\n      <IconSpacer spaceLeft spaceRight>\n        <Icon iconColor={color ? color(kind) : 'black'} aria-label={kind} />\n      </IconSpacer>\n      <StyledSpan>{eventKind(kind)}</StyledSpan>\n      {datation.length > 0 && <ProsoVisDates dates={datation} />}\n    </StyledEventLine>\n  );\n};\n\nconst StyledEventLine = styled(StyledFlex)`\n  align-items: center;\n`;\nconst StyledSpan = styled.span`\n  flex: 1;\n`;\n","import {\n  compact,\n  flatMap,\n  last,\n  map,\n  maxBy,\n  minBy,\n  pipe,\n  sortBy,\n  transform,\n} from 'lodash/fp';\nimport React, { useMemo } from 'react';\nimport styled from 'styled-components/macro';\nimport { scrollbar } from '../../../components/scrollbar';\nimport { ProsoVisDate, ProsoVisEvent } from '../../types/events';\nimport { SummaryEvent } from './SummaryEvent';\n\ntype EventsByKind = {\n  kind: string;\n  events: ProsoVisEvent[];\n};\ntype EventsByKindStartEndDate = EventsByKind & {\n  datation: ProsoVisDate[];\n};\n\nconst eventsByFirstDate = sortBy<ProsoVisEvent>('datation[0].value');\nconst groupEventsByKind = (acc: EventsByKind[], curr: ProsoVisEvent) => {\n  const prev = last(acc);\n  if (prev?.kind === curr.kind) {\n    prev.events.push(curr);\n  } else {\n    acc.push({ kind: curr.kind, events: [curr] });\n  }\n};\n\nconst minDate = minBy<ProsoVisDate>('value');\nconst maxDate = maxBy<ProsoVisDate>('value');\n\nconst addStartEndDateToEventGroup = (v: EventsByKind) => {\n  const datation = flatMap('datation', v.events);\n  const min = minDate(datation);\n  const max = maxDate(datation);\n\n  return {\n    ...v,\n    datation: compact(min === max ? [min] : [min, max]),\n  };\n};\n\nconst Base2 = styled.div`\n  height: 100%;\n  width: 100%;\n  padding-right: 0.25em;\n  padding-left: 0.25em;\n  overflow-y: auto;\n\n  ${scrollbar}\n`;\n\nexport const SummaryEvents: React.FC<{ events: ProsoVisEvent[] }> = function ({\n  events,\n}) {\n  const grouped = useMemo(() => {\n    return pipe<\n      [ProsoVisEvent[]],\n      ProsoVisEvent[],\n      EventsByKind[],\n      EventsByKindStartEndDate[],\n      JSX.Element[]\n    >(\n      eventsByFirstDate,\n      transform(groupEventsByKind, []),\n      map(addStartEndDateToEventGroup),\n      map(({ kind, events, datation }: EventsByKindStartEndDate) => (\n        <SummaryEvent\n          key={events[0].id}\n          kind={kind}\n          events={events.length}\n          datation={datation}\n        />\n      ))\n    )(events);\n  }, [events]);\n\n  return <Base2>{grouped}</Base2>;\n};\n","import { PlusIcon, XIcon } from '@primer/octicons-react';\nimport React, { useMemo } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport styled from 'styled-components/macro';\nimport ActorLabel from '../../../components/ActorLabel';\nimport { StyledFlex } from '../../../components/ui/Flex/styled-components';\nimport { IconSpacerPointer } from '../../../components/ui/IconSpacer';\nimport { useFlatClick } from '../../../hooks/useClick';\nimport { lightgray } from '../../components/theme';\nimport { removeDetailActor } from '../../reducers/detail/actorSlice';\nimport { resetActorSummary } from '../../reducers/global/actorSummarySlice';\nimport { selectDetailActors } from '../../selectors/detail/actors';\nimport { tryAddDetailActorThunk } from '../../thunks/actors';\n\nexport const SummaryHeader: React.FC<{ actor: string }> = function ({ actor }) {\n  const dispatch = useDispatch();\n  const actors = useSelector(selectDetailActors);\n  const actorExists = actors[actor] !== undefined;\n\n  const [handleClick, Icon] = useMemo(\n    () =>\n      actorExists\n        ? [\n            () => {\n              dispatch(removeDetailActor(actor));\n              dispatch(resetActorSummary());\n            },\n            <XIcon\n              className=\"ma1 flex-shrink-0 red\"\n              verticalAlign=\"text-bottom\"\n              aria-label={'supprimer'}\n            />,\n          ]\n        : [\n            () => {\n              dispatch(tryAddDetailActorThunk(actor));\n              dispatch(resetActorSummary());\n            },\n            <PlusIcon\n              className=\"ma1 flex-shrink-0 green\"\n              verticalAlign=\"text-bottom\"\n              aria-label={'ajouter'}\n            />,\n          ],\n    [dispatch, actorExists, actor]\n  );\n\n  return (\n    <ActorTitle>\n      <IconSpacerPointer spaceRight {...useFlatClick(handleClick)}>\n        {Icon}\n      </IconSpacerPointer>\n      <ActorLabel id={actor} />\n    </ActorTitle>\n  );\n};\nconst ActorTitle = styled(StyledFlex)`\n  border-bottom: 1px solid ${lightgray};\n`;\n","import { get } from 'lodash/fp';\nimport React, { useEffect, useLayoutEffect, useMemo, useRef } from 'react';\nimport { useSelector } from 'react-redux';\nimport { useSpring, animated } from 'react-spring';\nimport styled from 'styled-components/macro';\nimport { stopEventPropagation } from '../../../hooks/useClick';\nimport Loading from '../../components/Loading';\nimport { selectEventIndex } from '../../selectors/events';\nimport { SummaryEvents } from './SummaryEvents';\nimport { SummaryHeader } from './SummaryHeader';\n\nconst Base = styled.div`\n  display: grid;\n  grid-template-rows: auto 1fr;\n  width: 100%;\n  height: 100%;\n  background-color: white;\n  border: 1px solid gray;\n  border-radius: 3px;\n  box-shadow: 0 0 3px gray;\n`;\n\ntype Coordinates = { x: number; y: number };\nexport const SummaryWindow: React.FC<{\n  target: Coordinates & { actor: string };\n}> = function ({ target: { x, y, actor } }) {\n  const $ref = useRef<SVGForeignObjectElement>(null as any);\n\n  const [{ width, height }, set] = useSpring<{ width: number; height: number }>(\n    () => ({ width: 0, height: 0, reset: true })\n  );\n\n  useLayoutEffect(() => {\n    set({ from: { width: 0, height: 0 }, width: 250, height: 300 });\n  }, [actor, set]);\n\n  useEffect(() => {\n    /* react onWheel event is attached directly to top element event listener,\n    aka: document.addEventListener\n    as we don't want EasyPZ to react to wheel events in this case, we are\n    forced to use legacy eventlistener, hence the effect\n     */\n    const rf = $ref.current;\n    rf.addEventListener('wheel', stopEventPropagation);\n\n    return () => {\n      rf.removeEventListener('wheel', stopEventPropagation);\n    };\n  }, []);\n\n  const eventsIndex = useSelector(selectEventIndex);\n  const events = useMemo(\n    () => get(actor, eventsIndex)?.map((e) => e.event),\n    [actor, eventsIndex]\n  );\n\n  return (\n    <animated.foreignObject\n      ref={$ref}\n      style={{\n        transform: `translate3d(${x}px, ${y}px, 0)`,\n      }}\n      width={width}\n      height={height}\n      onMouseUp={stopEventPropagation}\n    >\n      <Base>\n        <SummaryHeader actor={actor} />\n        <Loading finished={events} hide>\n          <SummaryEvents events={events!} />\n        </Loading>\n      </Base>\n    </animated.foreignObject>\n  );\n};\n","import React, { useMemo } from 'react';\nimport { useSelector } from 'react-redux';\nimport { selectDetailRelations } from '../../../feature/relation/selectRelations';\nimport Loading from '../../components/Loading';\nimport { selectSummary } from '../../selectors/global/summary';\nimport { selectGraph } from '../../selectors/graph';\nimport { ProsoVisGraph } from '../../types/graph';\nimport { GraphNode } from './GraphNode';\nimport { SummaryWindow } from './SummaryWindow';\nimport { useEasyPZ } from './useEasyPZ';\n\nconst GlobalGraph: React.FC = function () {\n  const graph = useSelector(selectGraph);\n  const relations = useSelector(selectDetailRelations);\n\n  return (\n    <Loading finished={graph && relations}>\n      {graph && <Graph graph={graph} />}\n    </Loading>\n  );\n};\n\nconst useGraphBounds = function (graph: ProsoVisGraph) {\n  return useMemo(\n    () =>\n      graph.reduce<{\n        x: number;\n        y: number;\n      }>(\n        (acc, n) => {\n          const maxX = n.x + n.width / 2;\n          const maxY = n.y + n.height / 2;\n          if (acc.x === null || maxX > acc.x) acc.x = maxX;\n          if (acc.y === null || maxY > acc.y) acc.y = maxY;\n          return acc;\n        },\n        { x: null, y: null } as any\n      ),\n    [graph]\n  );\n};\n\nexport const Graph: React.FC<{ graph: ProsoVisGraph }> = function ({ graph }) {\n  const bounds = useGraphBounds(graph);\n  const { $svg, $g, baseScale, viewBox } = useEasyPZ(bounds);\n  const summary = useSelector(selectSummary);\n\n  return (\n    <svg ref={$svg} width=\"100%\" height=\"100%\" viewBox={viewBox}>\n      <g ref={$g} style={{ transform: `scale(${baseScale})` }}>\n        {graph.map(({ id, x, y, ...n }) => (\n          <GraphNode\n            key={id}\n            id={id}\n            x={x - n.width / 2}\n            y={y - n.height / 2}\n            {...n}\n          />\n        ))}\n        {summary && <SummaryWindow target={summary} />}\n      </g>\n    </svg>\n  );\n};\n\nexport default GlobalGraph;\n","import { useLayoutEffect, useMemo, useRef } from 'react';\nimport useDimensions from '../../../hooks/useDimensions';\nimport { select } from 'd3';\nimport { EasyPZ } from 'easypz';\n\nexport function useEasyPZ(bounds: { x: number; y: number }) {\n  const $svg = useRef<SVGSVGElement>(null as any);\n  const $g = useRef<SVGGElement>(null as any);\n\n  const dims = useDimensions($svg as any);\n\n  const baseScale = useMemo(\n    () => (dims ? (dims.width - dims.width / 10) / bounds.x : 1),\n    [dims, bounds.x]\n  );\n\n  useLayoutEffect(() => {\n    const childrens = select($g.current);\n\n    const easypz = new EasyPZ(\n      $svg.current,\n      function (transform) {\n        // handleClick.cancel();\n        childrens.style(\n          'transform',\n          `translate3d(${transform.translateX}px, ${\n            transform.translateY\n          }px, 0) scale(${transform.scale * baseScale})`\n        );\n      },\n      { minScale: 1 },\n      ['SIMPLE_PAN', 'WHEEL_ZOOM', 'PINCH_ZOOM']\n    );\n\n    return () => {\n      easypz.removeHostListeners();\n    };\n  }, [baseScale]);\n  return {\n    $svg,\n    $g,\n    baseScale,\n    viewBox: dims\n      ? [-dims.width / 20, 0, dims.width, baseScale * bounds.y].join(' ')\n      : undefined,\n  };\n}\n","import React, { useContext } from 'react';\nimport L from 'leaflet';\n\nexport type LeafletContextProps = {\n  top: L.Map;\n  current: L.Map | L.LayerGroup<any>;\n};\nconst LeafletContext = React.createContext<LeafletContextProps>({} as any);\n\nexport const useLeaflet = (): LeafletContextProps => useContext(LeafletContext);\n\nexport const LeafletProvider = LeafletContext.Provider;\n","import React, { useState, useRef, useEffect } from 'react';\nimport L from 'leaflet';\nimport { LeafletProvider, LeafletContextProps } from './context';\nimport useMount from '../../../hooks/useMount';\n\nfunction useLeafletMap(\n  $ref: React.MutableRefObject<HTMLDivElement>,\n  defaultBounds: L.LatLngBounds,\n  options?: L.MapOptions\n) {\n  const [value, setValue] = useState<LeafletContextProps>();\n\n  useMount(() => {\n    const m = new L.Map($ref.current, {\n      ...options,\n    });\n    m.fitBounds(defaultBounds);\n    setValue({ top: m, current: m });\n\n    return () => {\n      m.remove();\n    };\n  });\n\n  return value;\n}\n\nconst Map: React.FC<{\n  defaultBounds: L.LatLngBounds;\n  options?: L.MapOptions;\n  onMoveEnd?: L.LeafletEventHandlerFn;\n  onZoomEnd?: L.LeafletEventHandlerFn;\n  mappy?: (map: L.Map) => void;\n}> = function ({\n  defaultBounds,\n  options,\n  children,\n  onMoveEnd,\n  onZoomEnd,\n  mappy,\n}) {\n  const $div = useRef(null as any);\n\n  const value = useLeafletMap($div, defaultBounds, options);\n\n  useEffect(() => {\n    if (value && mappy) mappy(value.top);\n  }, [mappy, value]);\n  useEffect(() => {\n    if (value && onZoomEnd) {\n      const map = value.top;\n      map.on('zoomend', onZoomEnd);\n\n      return () => {\n        map.off('zoomend');\n      };\n    }\n  }, [onZoomEnd, value]);\n\n  useEffect(() => {\n    if (value && onMoveEnd) {\n      const map = value.top;\n      map.on('moveend', onMoveEnd);\n\n      return () => {\n        map.off('moveend');\n      };\n    }\n  }, [onMoveEnd, value]);\n\n  return (\n    <div ref={$div}>\n      {value && <LeafletProvider value={value}>{children}</LeafletProvider>}\n    </div>\n  );\n};\n\nexport default Map;\n","import React, { useRef, useContext } from 'react';\nimport L from 'leaflet';\nimport { useLeaflet } from './context';\nimport useMount from '../../../hooks/useMount';\n\nexport type LeafletControlProps = L.Control.Layers;\nconst LeafletControl = React.createContext<LeafletControlProps>(null as any);\n\nexport const useControl = () => useContext(LeafletControl);\n\nexport const Control: React.FC = function ({ children }) {\n  const l = useLeaflet();\n  const $control = useRef(L.control.layers());\n\n  useMount(() => {\n    const control = $control.current;\n    control.addTo(l.top);\n\n    return () => {\n      control.remove();\n    };\n  });\n\n  return (\n    <LeafletControl.Provider value={$control.current}>\n      {children}\n    </LeafletControl.Provider>\n  );\n};\n\nexport type LeafletAddControlProps = (layer: L.Layer) => L.Control.Layers;\nconst LeafletAddControl = React.createContext<LeafletAddControlProps | null>(\n  null\n);\n\nexport const useAddControl = () => useContext(LeafletAddControl);\n\nexport const ControlOverlay: React.FC<{\n  name: string;\n  checked?: boolean;\n}> = function ({ name, checked = true, children }) {\n  const l = useLeaflet();\n  const control = useControl();\n  return (\n    <LeafletAddControl.Provider\n      value={Object.assign(\n        (layer: L.Layer) => {\n          if (checked) layer.addTo(l.top);\n          return control.addOverlay(layer, name);\n        },\n        { control }\n      )}\n    >\n      {children}\n    </LeafletAddControl.Provider>\n  );\n};\n\nexport const ControlBaseLayer: React.FC<{\n  name: string;\n  checked?: boolean;\n}> = function ({ name, checked = false, children }) {\n  const l = useLeaflet();\n  const control = useControl();\n  return (\n    <LeafletAddControl.Provider\n      value={(layer) => {\n        if (checked) layer.addTo(l.top);\n        return control.addBaseLayer(layer, name);\n      }}\n    >\n      {children}\n    </LeafletAddControl.Provider>\n  );\n};\n","import React from 'react';\nimport L from 'leaflet';\nimport { useLeaflet } from './context';\nimport { useAddControl } from './Control';\nimport useMount from '../../../hooks/useMount';\n\nexport const TileLayer: React.FC<\n  {\n    url: string;\n  } & L.TileLayerOptions\n> = function ({ url, children, ...options }) {\n  const l = useLeaflet();\n  const addToControl = useAddControl();\n\n  useMount(() => {\n    const bs = L.tileLayer(url, options);\n\n    if (addToControl) {\n      addToControl(bs);\n    } else {\n      bs.addTo(l.current);\n    }\n\n    return () => {\n      bs.remove();\n    };\n  });\n\n  return null;\n};\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\ntype MapBoundsMask = [\n  { lat: number; lng: number },\n  { lat: number; lng: number }\n];\n\nconst maskGlobalMapBoundsSlice = createSlice({\n  name: 'mask-global-map-bounds',\n  initialState: null as MapBoundsMask | null,\n  reducers: {\n    set(_state, { payload }: PayloadAction<MapBoundsMask>) {\n      return payload;\n    },\n    clear() {\n      return null;\n    },\n  },\n});\n\nexport default maskGlobalMapBoundsSlice.reducer;\nexport const {\n  set: setMaskGlobalMapBounds,\n  clear: clearMaskGlobalMapBounds,\n} = maskGlobalMapBoundsSlice.actions;\n","import Rbush from 'rbush';\n\nexport type Circle<T = any> = {\n  x: number;\n  y: number;\n  r: number;\n  n: number;\n  children: any;\n  data?: T;\n};\n\nfunction circleBbox(circle: Circle) {\n  return {\n    minX: circle.x - circle.r,\n    minY: circle.y - circle.r,\n    maxX: circle.x + circle.r,\n    maxY: circle.y + circle.r,\n  };\n}\n\nexport function circleMerge(a: Circle, b: Circle) {\n  const xs = a.x * a.n + b.x * b.n,\n    ys = a.y * a.n + b.y * b.n,\n    n = a.n + b.n;\n\n  return Cluster(xs / n, ys / n, n, [a, b]);\n}\n\nexport function circleOverlap(a: Circle, b: Circle) {\n  return (a.r + b.r) ** 2 - ((a.x - b.x) ** 2 + (a.y - b.y) ** 2);\n}\n\nexport function Cluster(\n  x: number,\n  y: number,\n  n: number,\n  children?: any,\n  data?: any\n) {\n  const obj: Circle = { x, y, r: Math.sqrt(n), n, children };\n  if (data) obj.data = data;\n  return obj;\n}\n\nexport class RefCircleRbush<T extends Circle = Circle> extends Rbush<Ref<T>> {\n  toBBox(item: Ref<T>) {\n    return circleBbox(item.v);\n  }\n\n  compareMinX(a: Ref<T>, b: Ref<T>) {\n    return a.v.x - a.v.r - (b.v.x - b.v.r);\n  }\n\n  compareMinY(a: Ref<T>, b: Ref<T>) {\n    return a.v.y - a.v.r - (b.v.y - b.v.r);\n  }\n}\n\ntype Ref<T> = { v: T };\n\nconst ref = <T>(v: T): Ref<T> => ({ v });\n\nexport type FSACOptions<T> = {\n  merge: (a: T, b: T) => T;\n  overlap: (a: T, b: T) => number;\n  bbox: (item: T) => {\n    minX: number;\n    minY: number;\n    maxX: number;\n    maxY: number;\n  };\n  Rbush: { new (): Rbush<Ref<T>> };\n  brk?: boolean;\n  reverse?: boolean;\n  sort?: boolean;\n};\n\nexport default function fsac<T = any>(clusters: T[], opts: FSACOptions<T>): T[];\nexport default function fsac<T extends Circle = Circle>(\n  clusters: T[],\n  opts?: Partial<FSACOptions<T>>\n): T[];\nexport default function fsac(\n  clusters: Circle[],\n  {\n    merge = circleMerge,\n    overlap = circleOverlap,\n    bbox = circleBbox,\n    Rbush = RefCircleRbush,\n    brk = false,\n    reverse = false,\n    sort = true,\n  }: Partial<FSACOptions<Circle>> = {}\n) {\n  const refs = clusters.map(ref);\n  const alives = new Set(refs);\n  const collision = new Rbush();\n  collision.load(refs);\n\n  for (const refCl of alives) {\n    let updated = false;\n    let clustered = true;\n    let cluster = refCl.v;\n\n    while (clustered) {\n      clustered = false;\n      const candidates = collision.search(bbox(cluster));\n\n      const indexes = new Uint32Array(candidates.length);\n      {\n        // unloads overlaps as soon as it's not used\n        const overlaps = new Float64Array(candidates.length);\n        for (let i = 0; i < candidates.length; i++) {\n          indexes[i] = i;\n          overlaps[i] = overlap(cluster, candidates[i].v);\n        }\n        if (sort) indexes.sort((a, b) => overlaps[b] - overlaps[a]);\n      }\n\n      const iterated = reverse ? indexes.reverse() : indexes;\n\n      for (const i of iterated) {\n        const refCandidate = candidates[i];\n        if (refCl === refCandidate) continue;\n\n        if (overlap(cluster, refCandidate.v) > 0) {\n          if (!updated) updated = true;\n\n          cluster = merge(cluster, refCandidate.v);\n          alives.delete(refCandidate);\n          collision.remove(refCandidate);\n          if (!clustered) clustered = true;\n          if (brk) break;\n        }\n      }\n    }\n    if (updated) {\n      collision.remove(refCl);\n      refCl.v = cluster;\n      collision.insert(refCl);\n    }\n  }\n\n  return Array.from(alives, ({ v }) => v);\n}\n","import { RichEventLocalised } from '../../../selectors/mask';\n\nexport const padding = 1;\nconst pad = padding / 2;\nexport type Circle = {\n  id: string;\n  x: number;\n  y: number;\n  r: number;\n  n: number;\n  children: [Circle, Circle] | null;\n  data?: RichEventLocalised;\n};\n\nexport function circleBbox(circle: Circle) {\n  return {\n    minX: circle.x - circle.r - pad,\n    minY: circle.y - circle.r - pad,\n    maxX: circle.x + circle.r + pad,\n    maxY: circle.y + circle.r + pad,\n  };\n}\n\nexport function circleOverlap(a: Circle, b: Circle) {\n  return (a.r + b.r + padding) ** 2 - ((a.x - b.x) ** 2 + (a.y - b.y) ** 2);\n}\n","import RBush from 'rbush';\nimport { Circle, circleBbox } from './Circle';\n\nexport type Ref<T> = { v: T };\n\nexport class RefCircleRbush<T extends Circle = Circle> extends RBush<Ref<T>> {\n  toBBox(item: Ref<T>) {\n    return circleBbox(item.v);\n  }\n\n  compareMinX(a: Ref<T>, b: Ref<T>) {\n    return a.v.x - a.v.r - (b.v.x - b.v.r);\n  }\n\n  compareMinY(a: Ref<T>, b: Ref<T>) {\n    return a.v.y - a.v.r - (b.v.y - b.v.r);\n  }\n}\n","import { hierarchy } from 'd3';\nimport fsac from '../../../libs/fsac/fsac';\nimport { RichEventLocalised } from '../../../selectors/mask';\nimport { Circle, circleBbox, circleOverlap } from './Circle';\nimport { RefCircleRbush } from './CircleRbush';\n\nlet uid = 0;\n\ntype ClusterT = Circle & { depth: number };\n\nexport function Cluster(\n  x: number,\n  y: number,\n  n: number,\n  children: [ClusterT, ClusterT] | null,\n  data?: RichEventLocalised\n) {\n  const id =\n    ((children && children[0].id) || (data && data.event.id)) ?? '' + uid++;\n  const depth = children\n    ? Math.max(children[0].depth, children[1].depth) + 1\n    : 0;\n\n  const obj: ClusterT = {\n    id,\n    x,\n    y,\n    r: Math.sqrt(n) + 5,\n    n,\n    children,\n    depth,\n  };\n  if (data) obj.data = data;\n  return obj;\n}\n\nexport function circleMerge(a: ClusterT, b: ClusterT) {\n  const xs = a.x * a.n + b.x * b.n,\n    ys = a.y * a.n + b.y * b.n,\n    n = a.n + b.n;\n\n  return Cluster(xs / n, ys / n, n, [a, b]);\n}\n\nexport type RichEventCluster = Omit<Circle, 'children'> & {\n  children: RichEventLocalised[];\n};\n\nexport const createClusters = (() => {\n  const stopper = { stop: false, instance: 0 };\n\n  return Object.assign(\n    function (events: RichEventLocalised[], map: L.Map) {\n      if (events.length === 0) return [];\n      const instance = ++stopper.instance; // allows to detect multiple calls of zoomend\n      if (instance !== stopper.instance) return;\n      const results = fsac(\n        events.map((event) => {\n          const { x, y } = map.latLngToLayerPoint(event.place);\n          return Cluster(x, y, 1, null, event);\n        }),\n        {\n          merge: circleMerge,\n          overlap: circleOverlap,\n          bbox: circleBbox,\n          Rbush: RefCircleRbush,\n        }\n      );\n\n      if (instance !== stopper.instance) return;\n\n      return (\n        hierarchy({ children: results } as any as ClusterT).children?.map(\n          (v) => {\n            const {\n              data: { id, depth, ...d },\n            } = v;\n            return {\n              ...d,\n              id,\n              children: v.leaves().map((v) => v.data.data),\n            } as RichEventCluster;\n          }\n        ) || ([] as RichEventCluster[])\n      );\n    },\n    {\n      stop() {\n        stopper.stop = true;\n      },\n    }\n  );\n})();\n","import React from 'react';\nimport L from 'leaflet';\nimport { useLeaflet, LeafletProvider } from './context';\nimport useLazyRef from '../../../hooks/useLazyRef';\nimport { useAddControl } from './Control';\nimport useMount from '../../../hooks/useMount';\n\nexport const FeatureGroup: React.FC = function ({ children }) {\n  const l = useLeaflet();\n  const addControl = useAddControl();\n  const $group = useLazyRef(() => L.featureGroup([]));\n\n  useMount(() => {\n    const g = $group.current;\n\n    if (addControl) {\n      addControl(g);\n    } else {\n      g.addTo(l.current);\n    }\n\n    return () => {\n      g.remove();\n    };\n  });\n\n  return (\n    <LeafletProvider value={{ top: l.top, current: $group.current }}>\n      {children}\n    </LeafletProvider>\n  );\n};\n","import React, { useLayoutEffect } from 'react';\nimport { useLeaflet } from './context';\nimport useLazyRef from '../../../hooks/useLazyRef';\nimport L from 'leaflet';\nimport useMount from '../../../hooks/useMount';\nimport { createPortal } from 'react-dom';\n\nexport type MarkerProps = {\n  latlng: L.LatLngExpression;\n  radius: number;\n} & L.MarkerOptions;\nexport const Marker: React.FC<MarkerProps> = function ({\n  latlng,\n  children,\n  radius,\n  ...options\n}) {\n  const l = useLeaflet();\n  const $div = useLazyRef(function () {\n    const $div = document.createElement('div');\n    $div.style.fontSize = '0'; // fontsize hack\n    return $div;\n  });\n  const marker = useLazyRef(() => new L.Marker(latlng, options));\n\n  useMount(() => {\n    let m = marker.current.addTo(l.current);\n    m.setIcon(\n      L.divIcon({\n        html: $div.current,\n        className: '',\n        iconSize: [radius * 2, radius * 2],\n      })\n    );\n    return () => {\n      m.remove();\n      m.removeFrom(l.top);\n      m.removeFrom(l.current as any);\n    };\n  });\n\n  useLayoutEffect(() => {\n    marker.current.setLatLng(latlng);\n  }, [marker, latlng]);\n\n  useLayoutEffect(() => {\n    marker.current.setIcon(\n      L.divIcon({\n        html: $div.current,\n        className: '',\n        iconSize: [radius * 2, radius * 2],\n      })\n    );\n  }, [$div, marker, radius]);\n\n  return createPortal(children, $div.current);\n};\n","import React, { useMemo } from 'react';\nimport * as d3 from 'd3';\nimport { map } from 'lodash';\n\nexport const PieChart: React.FC<{\n  radius: number;\n  counts: [string, any[]][];\n  donut?: number;\n  children: (\n    a: d3.PieArcDatum<[string, any[]]>,\n    arc: d3.Arc<any, d3.PieArcDatum<[string, any[]]>>,\n    donut: number\n  ) => JSX.Element;\n}> = function ({ radius, counts, donut = 0, children }) {\n  const arcs = useMemo(\n    () =>\n      d3\n        .pie<[string, any[]]>()\n        .sort(null)\n        .value((d) => d[1].length)(counts),\n    [counts]\n  );\n  const arc = useMemo(\n    () =>\n      d3\n        .arc<d3.PieArcDatum<[string, any[]]>>()\n        .innerRadius(donut)\n        .outerRadius(donut + radius),\n    [radius, donut]\n  );\n\n  return (\n    <g stroke=\"white\" pointerEvents=\"initial\">\n      {map(arcs, (a) => children(a, arc, donut))}\n    </g>\n  );\n};\n\nexport default PieChart;\n","import { isEmpty } from 'lodash/fp';\nimport { createSelector } from 'reselect';\nimport { selectGlobalHighlight } from './highlight';\nimport { selectGlobalSelection } from './selection';\nimport { createInteractionMap } from './utils';\n\nexport const selectInteractionMap = createSelector(\n  selectGlobalHighlight,\n  selectGlobalSelection,\n  (hover, selec) => {\n    const inter = hover.length !== 0 ? hover : selec;\n\n    return createInteractionMap(inter);\n  }\n);\n\nexport const selectIsInteractionEmpty = createSelector(\n  selectInteractionMap,\n  (interactors) => isEmpty(interactors.events) && isEmpty(interactors.actors)\n);\n","import React, { useMemo } from 'react';\nimport { arc, scaleSqrt } from 'd3';\nimport { isEmpty } from 'lodash';\nimport { map, sumBy } from 'lodash/fp';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useFlatClick } from '../../../hooks/useClick';\nimport { selectSwitchMainColor } from '../../../selectors/switch';\nimport { darkgray } from '../../components/theme';\nimport {\n  resetGlobalHighlight,\n  setGlobalHighlight,\n} from '../../reducers/global/highlightSlice';\nimport { setGlobalSelection } from '../../reducers/global/selectionSlice';\nimport { selectInteractionMap } from '../../selectors/global/interactions';\nimport { RichEventLocalised } from '../../selectors/mask';\n\nexport const ClusterPiePart: React.FC<{\n  a: d3.PieArcDatum<[string, RichEventLocalised[]]>;\n  arc: d3.Arc<any, d3.PieArcDatum<[string, RichEventLocalised[]]>>;\n  radius: number;\n}> = function ({ a, arc, radius }) {\n  const dispatch = useDispatch();\n  const color = useSelector(selectSwitchMainColor);\n  const [id, values] = a.data;\n\n  const interactive = useMemo(\n    () => map(({ event: { id: event, actor } }) => ({ event, actor }), values),\n    [values]\n  );\n\n  const [handleClick, handleHover, handleHoverOut] = useMemo(\n    () => [\n      () => {\n        dispatch(setGlobalSelection(interactive)); // onclick\n      },\n      () => {\n        dispatch(setGlobalHighlight(interactive)); // onmouseover\n      },\n      () => {\n        dispatch(resetGlobalHighlight()); // onmouseout\n      },\n    ],\n    [dispatch, interactive]\n  );\n  const d = arc(a)!;\n\n  return (\n    <g\n      {...useFlatClick(handleClick)}\n      onMouseEnter={handleHover}\n      onMouseLeave={handleHoverOut}\n      fill={color ? color(id) : darkgray}\n    >\n      <path opacity={0.3} d={d}>\n        <title>{values.length}</title>\n      </path>\n      <PartialPiePart a={a} defaultD={d} radius={radius}>\n        <title>{values.length}</title>\n      </PartialPiePart>\n    </g>\n  );\n};\n\n// // TODO maybe better transition ?\n// const StyledPath = styled.path<{ full: boolean }>`\n//   opacity: ${({ full }) => (full ? 1 : 0.3)};\n//   transition: opacity 250ms;\n// `;\n\nconst scale = scaleSqrt();\nconst arcify = arc();\n\nconst PartialPiePart: React.FC<{\n  a: d3.PieArcDatum<[string, RichEventLocalised[]]>;\n  defaultD: string;\n  radius: number;\n}> = function ({ a, radius, children, defaultD }) {\n  const interaction = useSelector(selectInteractionMap);\n  const {\n    startAngle,\n    endAngle,\n    data: [, events],\n  } = a;\n\n  const d = useMemo(() => {\n    if (isEmpty(interaction.events) && isEmpty(interaction.actors)) {\n      return defaultD;\n    }\n\n    const subradius =\n      radius *\n      scale(\n        sumBy(\n          ({ event }) =>\n            interaction.events[event.id] || interaction.actors[event.actor]\n              ? 1\n              : 0,\n          events\n        ) / events.length\n      );\n\n    return arcify({\n      startAngle,\n      endAngle,\n      innerRadius: 0,\n      outerRadius: subradius < 5 && subradius !== 0 ? 5 : subradius,\n    })!;\n  }, [startAngle, endAngle, radius, events, interaction, defaultD]);\n\n  return <path d={d}>{children}</path>;\n};\n","import React, { useEffect, useMemo, useState } from 'react';\n\nimport { RichEventLocalised } from '../../selectors/mask';\nimport { createClusters, RichEventCluster } from './aggregation/createCluster';\n\nimport { FeatureGroup } from '../../components/leaflet/FeatureGroup';\nimport { useLeaflet } from '../../components/leaflet/context';\nimport { Marker } from '../../components/leaflet/Marker';\nimport PieChart from './PieChart';\nimport { ClusterPiePart } from './ClusterPiePart';\nimport { useSelector } from 'react-redux';\nimport { selectDefaultFilterResolver } from '../../selectors/mask/customFilter';\nimport { groups, sort } from 'd3';\n\nexport const ClusterGroup: React.FC<{ locs: RichEventLocalised[] }> =\n  function ({ locs }) {\n    const { top } = useLeaflet();\n\n    const [clusters, setClusters] = useState<RichEventCluster[]>();\n\n    useEffect(() => {\n      const result = createClusters(locs, top);\n      if (result) setClusters(result);\n\n      return () => {\n        createClusters.stop();\n      };\n    }, [locs, top]);\n\n    if (clusters) {\n      return (\n        <FeatureGroup>\n          {clusters.map((v) => (\n            <Cluster key={v.id} value={v} />\n          ))}\n        </FeatureGroup>\n      );\n    }\n    return null;\n  };\n\nexport const Cluster: React.FC<{ value: RichEventCluster }> = function ({\n  value,\n}) {\n  const { r, x, y } = value;\n  const { top } = useLeaflet();\n\n  const path = useSelector(selectDefaultFilterResolver);\n\n  const parts = useMemo(\n    () => sort(groups(value.children, path), (a) => a[0]),\n    [value.children, path]\n  );\n  return (\n    <Marker\n      latlng={useMemo(() => top.layerPointToLatLng([x, y]), [top, x, y])}\n      radius={r}\n    >\n      <svg viewBox={`${-r} ${-r} ${r * 2} ${r * 2}`}>\n        <PieChart radius={r} counts={parts}>\n          {(a, arc) => (\n            <ClusterPiePart key={a.data[0]} a={a} arc={arc} radius={r} />\n          )}\n        </PieChart>\n      </svg>\n    </Marker>\n  );\n};\n","import React, { useCallback, useState } from 'react';\nimport Map from '../../components/leaflet/Map';\nimport {\n  Control,\n  ControlBaseLayer as BaseLayer,\n  ControlOverlay as Overlay,\n} from '../../components/leaflet/Control';\n\nimport { TileLayer } from '../../components/leaflet/TileLayer';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { map } from 'lodash/fp';\nimport Loading from '../../components/Loading';\nimport {\n  RichEventLocalised,\n  selectRichEventLocalised,\n} from '../../selectors/mask';\nimport { latLngBounds } from 'leaflet';\nimport { setMaskGlobalMapBounds } from '../../reducers/mask/globalMapBoundsSlice';\nimport { ClusterGroup } from './ClusterGroup';\n\n//         fillColor: color.main(event),\n// color: color.border(event),\n// fillOpacity:\n//   _.isEmpty(selected) || selected[id] !== undefined ? 1 : 0.5,\n// weight: 1,\n// radius: 5,\n\nconst GlobalMap: React.FC = function () {\n  const locs = useSelector(selectRichEventLocalised);\n\n  return (\n    <Loading finished={locs} hide>\n      <LoadedGlobalMap locs={locs!} />\n    </Loading>\n  );\n};\n\nconst LoadedGlobalMap: React.FC<{\n  locs: RichEventLocalised[];\n}> = function ({ locs }) {\n  const dispatch = useDispatch();\n\n  const [bounds] = useState(() => latLngBounds(map((l) => l.place, locs)));\n\n  const onMoveEnd = useCallback(\n    function (e: L.LeafletEvent) {\n      const bounds = (e.target as L.Map).getBounds();\n      const sw = bounds.getSouthWest();\n      const ne = bounds.getNorthEast();\n\n      dispatch(\n        setMaskGlobalMapBounds([\n          { lat: sw.lat, lng: sw.lng },\n          { lat: ne.lat, lng: ne.lng },\n        ])\n      );\n    },\n    [dispatch]\n  );\n\n  return (\n    <Map\n      defaultBounds={bounds}\n      options={{\n        maxZoom: 15,\n      }}\n      onMoveEnd={onMoveEnd}\n    >\n      <Control>\n        <BaseLayers />\n        <Overlay name=\"markers\">\n          <ClusterGroup locs={locs}></ClusterGroup>\n        </Overlay>\n      </Control>\n    </Map>\n  );\n};\n\nconst BaseLayers: React.FC = function () {\n  return (\n    <>\n      <BaseLayer name=\"OpenStreetMap\">\n        <TileLayer\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n          attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n        />\n      </BaseLayer>\n      <BaseLayer name=\"Esri.WorldTopoMap\">\n        <TileLayer\n          url=\"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}\"\n          attribution=\"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community\"\n        />\n      </BaseLayer>\n      <BaseLayer name=\"CartoDB.Positron\">\n        <TileLayer\n          url=\"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png\"\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>'\n          subdomains=\"abcd\"\n          maxZoom={19}\n        />\n      </BaseLayer>\n      <BaseLayer name=\"CartoDB.Voyager\" checked>\n        <TileLayer\n          url=\"https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png\"\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>'\n          subdomains=\"abcd\"\n          maxZoom={19}\n        />\n      </BaseLayer>\n    </>\n  );\n};\nexport default GlobalMap;\n","export const margin = { top: 10, right: 20, bottom: 20, left: 30 };\nexport const height = 250;\n","import { utcDay, utcYear, utcYears } from 'd3';\nimport { parseISO } from 'date-fns';\nimport {\n  concat,\n  countBy,\n  first,\n  flatMap,\n  groupBy,\n  isNil,\n  map,\n  pipe,\n  sortBy,\n} from 'lodash/fp';\nimport { createSelector } from 'reselect';\nimport {\n  selectEventsWithoutKinds,\n  selectRichEventsTimed,\n} from '../../selectors/mask';\nimport { selectDefaultFilterResolver } from '../../selectors/mask/customFilter';\nimport { ProsoVisDate, RichEvent } from '../../types/events';\n\nexport type Tyvent<T> = {\n  value: T;\n  time: Date;\n};\n\nconst defaultInterval = utcYear\n  // TODO date :)\n  .range(new Date(1700, 0, 1), new Date(2000, 0, 1))\n  .map<Tyvent<''>>((d) => ({ time: d, value: '' }));\n\nexport const discretize: (\n  path: (e: RichEvent) => string\n) => (e: RichEvent) => Tyvent<string>[] = (path) => (event) => {\n  if (isNil(event.event.datation)) return [];\n\n  if (event.event.datation.length === 2) {\n    const [start, end] = map(\n      pipe((d: ProsoVisDate) => d.value, parseISO, utcYear.floor),\n      event.event.datation\n    );\n    return utcYears(start, utcDay.offset(end, 1)).map((time) => ({\n      value: path(event),\n      time,\n    }));\n  } else if (event.event.datation?.length === 1) {\n    return [\n      {\n        value: path(event),\n        time: pipe(parseISO, utcYear)(event.event.datation[0].value),\n      },\n    ];\n  }\n  return [];\n};\n\nexport const selectBackgroundDiscrete = createSelector(\n  selectEventsWithoutKinds,\n  selectDefaultFilterResolver,\n  fillEmpty\n);\n\nexport const selectDiscrete = createSelector(\n  selectRichEventsTimed,\n  selectDefaultFilterResolver,\n  fillEmpty\n);\n\nexport function fillEmpty(\n  events: RichEvent[] | undefined,\n  path: (e: RichEvent) => string\n): Tyvent<Tyvent<string>[]>[] | undefined {\n  if (isNil(events)) return;\n  return pipe(\n    flatMap(discretize(path)),\n    concat(defaultInterval),\n    groupBy(pipe((d) => +d.time)),\n    map<Tyvent<string>[], Tyvent<Tyvent<string>[]>>((v) => ({\n      time: first(v)?.time!,\n      value: v.filter((v) => v.value, v),\n    }))\n  )(events) as Tyvent<Tyvent<string>[]>[];\n}\n\nexport const flatten = pipe(\n  map<Tyvent<Tyvent<string>[]>, Tyvent<_.Dictionary<number>>>(\n    ({ time, value }) => ({\n      time,\n      value: countBy((d) => d.value, value),\n    })\n  ),\n  sortBy<Tyvent<_.Dictionary<number>>>((d) => d.time)\n);\n","import React, { useCallback, useRef } from 'react';\nimport * as d3 from 'd3';\nimport { noop } from 'lodash/fp';\nexport type D3Selection<T extends SVGElement = any> = d3.Selection<\n  T,\n  unknown,\n  any,\n  undefined\n>;\n\nexport function useSelect<T extends SVGElement>(\n  callback: (selection: D3Selection<T>, ...args: any[]) => void = noop\n): [React.MutableRefObject<D3Selection<T>>, (dom: T) => void] {\n  const d3selection = useRef<D3Selection<T>>(null as any);\n  const ref = useCallback(function (dom: T) {\n    if (!dom) return;\n    d3selection.current = d3.select(dom).call(callback);\n    // ignoring callback :)\n    //eslint-disable-next-line\n  }, []);\n\n  return [d3selection, ref];\n}\n","import React, { useEffect } from 'react';\nimport { useSelect } from '../d3-hooks/useSelect';\n\nexport const Axis: React.FC<{\n  scale: d3.AxisScale<any>;\n  position: [string, string];\n  axis: <Domain extends d3.AxisDomain>(\n    scale: d3.AxisScale<Domain>\n  ) => d3.Axis<Domain>;\n}> = function ({ scale, position: [x, y], axis: axisDirection }) {\n  const [selection, ref] = useSelect<SVGGElement>();\n\n  useEffect(() => {\n    selection.current.transition().call(axisDirection(scale));\n  }, [selection, scale, axisDirection]);\n\n  return (\n    <g\n      ref={ref}\n      className=\"axis\"\n      pointerEvents=\"none\"\n      style={{\n        transform: `translate3d(${x}, ${y}, 0)`,\n      }}\n    />\n  );\n};\n","import styled from 'styled-components/macro';\nexport const StyledG = styled.g`\n  .selection {\n    fill-opacity: 0;\n  }\n`;\n","import * as d3 from 'd3';\nimport { darkgray } from '../theme';\n\nexport const brushHandles = function (\n  g: d3.Selection<SVGGElement, unknown, null, undefined>,\n  selection: [number, number],\n  path: string,\n  height: number\n) {\n  const handles = g\n    .selectAll('.handle--custom')\n    .data<{ type: 'w' | 'e' }>([{ type: 'w' }, { type: 'e' }])\n    .join(function (enter) {\n      const group = enter\n        .append('g')\n        .attr('class', 'handle--custom')\n        .attr('shape-rendering', 'crispEdges');\n\n      group\n        .append('path')\n        .attr('fill', darkgray)\n        .attr('cursor', 'ew-resize')\n        .attr('d', path)\n        .style('transform', 'translate3d(0, 5px, 0)');\n\n      // triangle down\n      group\n        .append('path')\n        .attr('fill', darkgray)\n        .attr('cursor', 'ew-resize')\n        .attr('d', d3.symbol().type(d3.symbolTriangle))\n        .style('transform', `translate3d(1px, ${height - 5}px, 0)`);\n\n      // triangle up\n      group\n        .append('path')\n        .attr('fill', darkgray)\n        .attr('cursor', 'ew-resize')\n        .attr('d', d3.symbol().type(d3.symbolTriangle))\n        .style('transform', 'rotate(180deg) translate3d(-1px, -5px, 0)');\n      return group;\n    });\n\n  selection === null\n    ? handles.style('transform', null)\n    : handles.style(\n        'transform',\n        (_d: any, i: number) => `translate3d(${selection[i] - 1}px, 0, 0)`\n      );\n};\n","import React, { useEffect } from 'react';\nimport * as d3 from 'd3';\nimport { useSelect } from '../../d3-hooks/useSelect';\nimport { StyledG } from './styled';\nimport { brushHandles } from './brushHandles';\nimport { usePath } from './usePath';\nimport { useBrushX } from '../../d3-hooks/useBrushX';\n\n/**\n * Creates a brush with handles, spanning across margin.top > height - margin.bottom and margin.left > width - margin.right\n * @param props\n */\nexport const BrushX: React.FC<{\n  onBrush: (start: Date, end: Date) => void;\n  sync?: [Date, Date];\n  x: d3.ScaleTime<number, number>;\n  margin: { top: number; right: number; bottom: number; left: number };\n  width: number;\n  height: number;\n}> = function ({ onBrush, x, sync, margin, width, height }) {\n  const brush = useBrushX();\n  const [mask, refFn] = useSelect(brush);\n\n  const path = usePath(height);\n\n  useEffect(() => {\n    brush.extent([\n      [margin.left, margin.top],\n      [width - margin.right, height - margin.bottom],\n    ]);\n    mask.current\n      .call(brushHandles, [margin.left, width - margin.right], path, height)\n      .call(brush)\n      .call(brush.move, [margin.left, width - margin.right]);\n  }, [brush, path, mask, width, height, margin]);\n\n  useEffect(() => {\n    if (!sync) return;\n    mask.current.call(brush.move, sync.map(x));\n  }, [brush, mask, sync, x]);\n\n  useEffect(() => {\n    brush.on('start brush end', function (event: any) {\n      if (event.selection) {\n        d3.select(this).call(brushHandles, event.selection, path, height);\n\n        if (event.sourceEvent) {\n          const [start, end] = event.selection.map(x.invert);\n          onBrush(start, end);\n        }\n      }\n    });\n\n    return () => {\n      brush.on('start brush end', null);\n    };\n  }, [brush, path, onBrush, height, x]);\n\n  return <StyledG ref={refFn} />;\n};\n\nexport default BrushX;\n","import { useMemo } from 'react';\nimport * as d3 from 'd3';\n\n/**\n * memoized d3.brushX()\n */\nexport function useBrushX() {\n  return useMemo(() => d3.brushX(), []);\n}\n","import { useMemo } from 'react';\nimport * as d3 from 'd3';\n\n/**\n * create a vertical path using d3.line\n * @param height height of the line\n */\nexport function usePath(height: number) {\n  return useMemo(\n    () =>\n      d3.line().context(null)([\n        [0, 0],\n        [2, 0],\n        [2, height - 10],\n        [0, height - 10],\n        [0, 0],\n      ])!,\n    [height]\n  );\n}\n","import React, { useCallback, useEffect, useMemo, useRef } from 'react';\nimport { area, curveMonotoneX, select } from 'd3';\nimport type { Tyvent } from './selectors';\nimport theme from '../../components/theme';\ntype D3Selection = d3.Selection<SVGGElement, unknown, any, undefined>;\n\ntype EnterType = d3.Selection<\n  d3.EnterElement,\n  d3.Series<Tyvent<_.Dictionary<number>>, string>,\n  SVGGElement,\n  unknown\n>;\n\ntype UpdateType = d3.Selection<\n  SVGGElement,\n  d3.Series<Tyvent<_.Dictionary<number>>, string>,\n  SVGGElement,\n  unknown\n>;\n\nfunction useSelect(): [\n  React.MutableRefObject<D3Selection>,\n  (dom: SVGGElement) => void\n] {\n  const d3selection = useRef<D3Selection>(null as any);\n  const ref = useCallback(function (dom: SVGGElement) {\n    if (!dom) return;\n    d3selection.current = select(dom);\n  }, []);\n\n  return [d3selection, ref];\n}\n\nexport const StackedChart: React.FC<{\n  x: d3.ScaleTime<number, number>;\n  y: d3.ScaleLinear<number, number>;\n  stack: d3.Series<Tyvent<_.Dictionary<number>>, string>[];\n  color: d3.ScaleOrdinal<string, string> | null;\n  curve?: d3.CurveFactory;\n  defaultColor?: string;\n}> = function ({\n  x,\n  y,\n  stack,\n  color,\n  curve = curveMonotoneX,\n  defaultColor = theme.darkgray,\n}) {\n  const [chart, ref] = useSelect();\n\n  const d3Area = useMemo(\n    function () {\n      return area<d3.SeriesPoint<Tyvent<_.Dictionary<number>>>>()\n        .x((d: any) => x(d.data.time))\n        .y0((d) => y(d[0]))\n        .y1((d) => y(d[1]))\n        .curve(curve);\n    },\n    [x, y, curve]\n  );\n\n  const colorize = useCallback(\n    (d: any) => (color ? color(d.key) : defaultColor),\n    [color, defaultColor]\n  );\n\n  useEffect(() => {\n    chart.current\n      .selectAll<SVGGElement, d3.Series<Tyvent<_.Dictionary<number>>, string>>(\n        'path'\n      )\n      .data(stack, (d) => d.key)\n      .join(onEnter, onUpdate);\n\n    function onEnter(enter: EnterType) {\n      return (\n        enter\n          .append('path')\n          .attr('fill', colorize)\n          // .attr('stroke', colorize)\n          .attr('d', d3Area)\n          .call((g) => g.append('title').text((d) => d.key))\n      );\n    }\n\n    function onUpdate(update: UpdateType) {\n      return update.call((g) =>\n        g\n          .transition()\n          .attr('fill', colorize)\n          // .attr('stroke', colorize)\n          .attr('d', d3Area)\n          .select('title')\n          .text((d: d3.Series<any, string>) => d.key)\n      );\n    }\n  }, [chart, stack, colorize, d3Area]);\n\n  return <g ref={ref}></g>;\n};\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\ntype IntervalMask = {\n  start: number;\n  end: number;\n};\n\nconst maskGlobalTimeSlice = createSlice({\n  name: 'mask-global-time',\n  initialState: null as IntervalMask | null,\n  reducers: {\n    set(\n      _state,\n      { payload: { start, end } }: PayloadAction<{ start: Date; end: Date }>\n    ) {\n      return { start: +start, end: +end };\n    },\n    clear() {\n      return null;\n    },\n  },\n});\n\nexport default maskGlobalTimeSlice.reducer;\nexport const {\n  set: setMaskGlobalTime,\n  clear: clearMaskGlobalTime,\n} = maskGlobalTimeSlice.actions;\n","import React, { useMemo } from 'react';\nimport {\n  axisBottom,\n  axisLeft,\n  lch,\n  max,\n  min,\n  scaleLinear,\n  scaleTime,\n} from 'd3';\nimport { parseISO } from 'date-fns';\nimport { Dictionary } from 'lodash';\nimport { useSelector } from 'react-redux';\nimport { selectSwitchMainColor } from '../../../selectors/switch';\nimport { Axis } from '../../components/Axis';\nimport BrushX from '../../components/brush/BrushX';\nimport { height, margin } from './options';\nimport { Tyvent } from './selectors';\nimport { StackedChart } from './StackedChart';\nimport { useUpdateMaskGlobalTime } from './useUpdateMask';\nimport { lightgray } from '../../components/theme';\n\nexport const StreamGraph: React.FC<{\n  width: number;\n  stack: d3.Series<Tyvent<Dictionary<number>>, string>[];\n  reference: d3.Series<Tyvent<Dictionary<number>>, string>[];\n}> = function ({ width, stack, reference }) {\n  const color = useSelector(selectSwitchMainColor);\n\n  const colorReference = useMemo(() => {\n    const grayscale = color?.copy();\n\n    if (grayscale) {\n      grayscale.range(\n        grayscale.range().map((c) => {\n          const lchColor = lch(c);\n          lchColor.c = 0;\n          return lchColor.formatRgb();\n        })\n      );\n\n      return grayscale;\n    }\n    return null;\n  }, [color]);\n\n  const handleBrush = useUpdateMaskGlobalTime();\n  const x = useMemo(\n    function () {\n      return (\n        scaleTime()\n          // TODO date :)\n          .domain([parseISO('1700-01-01'), parseISO('2000-01-01')])\n          .range([margin.left, width - margin.right])\n          .nice()\n          .clamp(true)\n      );\n    },\n    [width]\n  );\n\n  const y = useMemo(\n    () =>\n      scaleLinear()\n        .domain([\n          min(reference, (d) => min(d, (d) => d[0])) as any,\n          max(reference, (d) => max(d, (d) => d[1])) as any,\n        ])\n        .range([height - margin.bottom, margin.top]),\n    [reference]\n  );\n\n  return (\n    <>\n      <StackedChart\n        stack={reference}\n        color={colorReference}\n        x={x}\n        y={y}\n        defaultColor={lightgray}\n      />\n      <StackedChart stack={stack} color={color ?? null} x={x} y={y} />\n      <Axis\n        scale={x}\n        position={['0', height - margin.bottom + 'px']}\n        axis={axisBottom}\n      />\n      <Axis scale={y} position={[margin.left + 'px', '0']} axis={axisLeft} />\n      <BrushX\n        width={width}\n        height={height}\n        margin={margin}\n        x={x}\n        onBrush={handleBrush}\n      />\n    </>\n  );\n};\n","import { throttle } from 'lodash/fp';\nimport { useMemo } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { setMaskGlobalTime } from '../../reducers/mask/globalTimeSlice';\n\nexport function useUpdateMaskGlobalTime() {\n  const dispatch = useDispatch();\n  return useMemo(\n    () =>\n      throttle(100, (start: Date, end: Date) => {\n        dispatch(setMaskGlobalTime({ start, end }));\n      }),\n    [dispatch]\n  );\n}\n","import React, { useMemo, useRef } from 'react';\nimport { reduce, stack, stackOrderAscending } from 'd3';\nimport { useSelector } from 'react-redux';\nimport useDimensions from '../../../hooks/useDimensions';\nimport Loading from '../../components/Loading';\nimport { selectCustomFilterDefaultValues } from '../../selectors/mask/customFilter';\nimport { height } from './options';\nimport {\n  flatten,\n  selectBackgroundDiscrete,\n  selectDiscrete,\n  Tyvent,\n} from './selectors';\nimport { StreamGraph } from './StreamGraph';\n\nconst GlobalTimeline: React.FC = function () {\n  const $svg = useRef<SVGSVGElement>(null as any);\n  const dimensions = useDimensions($svg);\n\n  const events = useSelector(selectDiscrete);\n  const backgroundEvents = useSelector(selectBackgroundDiscrete);\n  const kinds = useSelector(selectCustomFilterDefaultValues);\n\n  const stBackground = useMemo(\n    () =>\n      backgroundEvents &&\n      stack<any, Tyvent<_.Dictionary<number>>, string>()\n        .keys(kinds)\n        // .offset(stackOffsetSilhouette)\n        .order(stackOrderAscending)\n        .value((d, k) => d.value[k] || 0)(flatten(backgroundEvents)),\n    [backgroundEvents, kinds]\n  );\n\n  const st = useMemo(\n    () =>\n      events &&\n      stBackground &&\n      createActiveStack(stBackground, flatten(events)),\n    [events, stBackground]\n  );\n\n  return (\n    <Loading finished={st}>\n      <svg height={height} width=\"100%\" ref={$svg}>\n        {dimensions?.width && (\n          <>\n            {/* <StreamGraph width={dimensions.width} stack={stBackground ?? []} />, */}\n            <StreamGraph\n              width={dimensions.width}\n              stack={st ?? []}\n              reference={stBackground ?? []}\n            />\n            ,\n          </>\n        )}\n      </svg>\n    </Loading>\n  );\n};\n\nfunction createActiveStack(\n  reference: d3.Series<Tyvent<_.Dictionary<number>>, string>[],\n  filtered: Tyvent<_.Dictionary<number>>[]\n) {\n  return reduce(\n    filtered,\n    function (newStack, value: Tyvent<_.Dictionary<number>>, key) {\n      return reduce(\n        reference,\n        function (newStack, ref, row) {\n          if (!newStack[row]) {\n            newStack[row] = [];\n            newStack[row].key = ref.key;\n            newStack[row].index = ref.index;\n          }\n          const [offset] = ref[key];\n          const height = value.value[ref.key] ?? 0;\n          newStack[row][key] = [offset, height + offset];\n          newStack[row][key].data = value;\n\n          return newStack;\n        },\n        newStack\n      );\n    },\n    [] as { [k: string]: any }\n  ) as d3.Series<Tyvent<_.Dictionary<number>>, string>[];\n}\n\nexport default GlobalTimeline;\n","import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';\nimport { ProsoVisActor } from '../types/actors';\nimport Axios from 'axios';\n\nconst initialState: {\n  actors?: _.Dictionary<ProsoVisActor>;\n  loading: 'idle' | 'pending' | 'succeeded' | 'failed';\n  url: string;\n} = { loading: 'idle', url: './data/index-actors.json' };\n\nexport const fetchActors = createAsyncThunk(\n  'actors/fetch',\n  async (_, { signal }) => {\n    const source = Axios.CancelToken.source();\n    signal.addEventListener('abort', () => {\n      source.cancel();\n    });\n    const response = await Axios.get('./data/index-actors.json', {\n      cancelToken: source.token,\n    });\n    return response.data as _.Dictionary<ProsoVisActor>;\n  }\n);\n\nconst actorDataSlice = createSlice({\n  name: 'actors',\n  initialState,\n  reducers: {\n    setUrl(state, { payload }: PayloadAction<string>) {\n      state.url = payload;\n    },\n  },\n  extraReducers: (builder) => {\n    builder.addCase(fetchActors.pending, (state) => ({\n      ...state,\n      loading: 'pending',\n    }));\n    builder.addCase(fetchActors.fulfilled, (state, action) => ({\n      ...state,\n      loading: 'pending',\n      actors: action.payload,\n    }));\n    builder.addCase(fetchActors.rejected, (state) => ({\n      ...state,\n      loading: 'failed',\n    }));\n  },\n});\n\nexport default actorDataSlice.reducer;\n","import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';\nimport { ProsoVisEvent } from '../types/events';\nimport Axios from 'axios';\n\nexport type EventDataStore = {\n  events?: ProsoVisEvent[];\n  loading: 'idle' | 'pending' | 'succeeded' | 'failed';\n  url: string;\n};\n\nconst initialState: EventDataStore = {\n  loading: 'idle',\n  url: './data/index-events.json',\n};\n\nexport const fetchEvents = createAsyncThunk(\n  'events/fetch',\n  async (_, { signal }) => {\n    const source = Axios.CancelToken.source();\n    signal.addEventListener('abort', () => {\n      source.cancel();\n    });\n    const response = await Axios.get('./data/index-events.json', {\n      cancelToken: source.token,\n    });\n    return response.data as ProsoVisEvent[];\n  }\n);\n\nconst eventDataSlice = createSlice({\n  name: 'events',\n  initialState,\n  reducers: {\n    setUrl(state, { payload }: PayloadAction<string>) {\n      state.url = payload;\n    },\n  },\n  extraReducers: (builder) => {\n    builder.addCase(fetchEvents.pending, (state) => ({\n      ...state,\n      loading: 'pending',\n    }));\n    builder.addCase(fetchEvents.fulfilled, (state, action) => ({\n      ...state,\n      loading: 'idle',\n      events: action.payload,\n    }));\n    builder.addCase(fetchEvents.rejected, (state) => ({\n      ...state,\n      loading: 'failed',\n    }));\n  },\n});\n\nexport default eventDataSlice.reducer;\n","import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';\nimport Axios from 'axios';\nimport { ProsoVisGraph } from '../types/graph';\n\nconst initialState: {\n  graph: ProsoVisGraph | null;\n  loading: 'idle' | 'pending' | 'succeeded' | 'failed';\n  url: string;\n} = {\n  graph: null,\n  loading: 'idle',\n  url: './data/graph.json',\n};\n\nexport const fetchGraph = createAsyncThunk(\n  'graph/fetch',\n  async (_, { signal }) => {\n    const source = Axios.CancelToken.source();\n    signal.addEventListener('abort', () => {\n      source.cancel();\n    });\n    const response = await Axios.get('./data/graph.json', {\n      cancelToken: source.token,\n    });\n    return response.data as ProsoVisGraph;\n  }\n);\n\nconst actorDataSlice = createSlice({\n  name: 'graph',\n  initialState,\n  reducers: {\n    setUrl(state, { payload }: PayloadAction<string>) {\n      state.url = payload;\n    },\n  },\n  extraReducers: (builder) => {\n    builder.addCase(fetchGraph.pending, (state) => ({\n      ...state,\n      loading: 'pending',\n    }));\n    builder.addCase(fetchGraph.fulfilled, (state, action) => ({\n      ...state,\n      loading: 'idle',\n      graph: action.payload,\n    }));\n    builder.addCase(fetchGraph.rejected, (state) => ({\n      ...state,\n      loading: 'failed',\n    }));\n  },\n});\n\nexport default actorDataSlice.reducer;\n","import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';\nimport { ProsoVisLocalisation } from '../types/localisations';\nimport Axios from 'axios';\n\nconst initialState: {\n  localisations?: _.Dictionary<ProsoVisLocalisation>;\n  loading: 'idle' | 'pending' | 'succeeded' | 'failed';\n  url: string;\n} = {\n  loading: 'idle',\n  url: './data/index-localisations.json',\n};\n\nexport const fetchLocalisations = createAsyncThunk(\n  'localisations/fetch',\n  async (_, { signal }) => {\n    const source = Axios.CancelToken.source();\n    signal.addEventListener('abort', () => {\n      source.cancel();\n    });\n    const response = await Axios.get('./data/index-localisations.json', {\n      cancelToken: source.token,\n    });\n    return response.data as _.Dictionary<ProsoVisLocalisation>;\n  }\n);\n\nconst actorDataSlice = createSlice({\n  name: 'localisations',\n  initialState,\n  reducers: {\n    setUrl(state, { payload }: PayloadAction<string>) {\n      state.url = payload;\n    },\n  },\n  extraReducers: (builder) => {\n    builder.addCase(fetchLocalisations.pending, (state) => ({\n      ...state,\n      loading: 'pending',\n    }));\n    builder.addCase(fetchLocalisations.fulfilled, (state, action) => ({\n      ...state,\n      loading: 'idle',\n      localisations: action.payload,\n    }));\n    builder.addCase(fetchLocalisations.rejected, (state) => ({\n      ...state,\n      loading: 'failed',\n    }));\n  },\n});\n\nexport default actorDataSlice.reducer;\n","import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';\nimport Axios from 'axios';\nimport { ProsoVisRelations } from '../types/relations';\n\nconst initialState: {\n  relations: ProsoVisRelations | null;\n  loading: 'idle' | 'pending' | 'succeeded' | 'failed';\n  url: string;\n} = {\n  relations: null,\n  loading: 'idle',\n  url: './data/relations.json',\n};\n\nexport const fetchRelations = createAsyncThunk(\n  'relations/fetch',\n  async (_, { signal }) => {\n    const source = Axios.CancelToken.source();\n    signal.addEventListener('abort', () => {\n      source.cancel();\n    });\n    const response = await Axios.get('./data/relations.json', {\n      cancelToken: source.token,\n    });\n    return response.data as ProsoVisRelations;\n  }\n);\n\nconst actorDataSlice = createSlice({\n  name: 'relations',\n  initialState,\n  reducers: {\n    setUrl(state, { payload }: PayloadAction<string>) {\n      state.url = payload;\n    },\n  },\n  extraReducers: (builder) => {\n    builder.addCase(fetchRelations.pending, (state) => ({\n      ...state,\n      loading: 'pending',\n    }));\n    builder.addCase(fetchRelations.fulfilled, (state, action) => ({\n      ...state,\n      loading: 'idle',\n      relations: action.payload,\n    }));\n    builder.addCase(fetchRelations.rejected, (state) => ({\n      ...state,\n      loading: 'failed',\n    }));\n  },\n});\n\nexport default actorDataSlice.reducer;\n","import React from 'react';\nimport { useDispatch } from 'react-redux';\nimport styled from 'styled-components/macro';\nimport useMount from '../../hooks/useMount';\nimport { lightgray } from '../components/theme';\nimport GlobalGraph from '../global/graph/GlobalGraph';\nimport GlobalMap from '../global/map/GlobalMap';\nimport GlobalTimeline from '../global/timeline/GlobalTimeline';\nimport { fetchActors } from '../reducers/actorsDataSlice';\nimport { fetchEvents } from '../reducers/eventsDataSlice';\nimport { fetchGraph } from '../reducers/graphDataSlice';\nimport { fetchLocalisations } from '../reducers/localisationsDataSlice';\nimport { fetchRelations } from '../reducers/relationsDataSlice';\n\nexport const StyledGlobalView = styled.div`\n  display: grid;\n  position: relative;\n  width: 100%;\n  height: 100%;\n  grid-template-areas:\n    'rel  map'\n    'timeline timeline';\n  grid-template-columns: 1fr 1fr auto;\n  grid-template-rows: 1fr 250px;\n`;\n\nconst GraphArea = styled.div`\n  grid-area: rel;\n`;\n\nconst MapArea = styled.div`\n  grid-area: map;\n  border-left: 1px solid ${lightgray};\n`;\nconst TimelineArea = styled.div`\n  grid-area: timeline;\n  border-top: 1px solid ${lightgray};\n`;\n\nconst GlobalView: React.FC = function () {\n  const dispatch = useDispatch();\n  useMount(() => {\n    dispatch(fetchLocalisations());\n    dispatch(fetchActors());\n    dispatch(fetchEvents());\n    dispatch(fetchGraph());\n    dispatch(fetchRelations());\n  });\n  return (\n    <StyledGlobalView>\n      <GraphArea>\n        <GlobalGraph />\n      </GraphArea>\n      <MapArea>\n        <GlobalMap />\n      </MapArea>\n      <TimelineArea>\n        <GlobalTimeline />\n      </TimelineArea>\n    </StyledGlobalView>\n  );\n};\n\nexport default GlobalView;\n","import styled from 'styled-components/macro';\n\nconst Side1Main3 = styled.div`\n  display: grid;\n  width: 100%;\n  height: 100vh;\n  grid-template-columns: 25% 75%;\n`;\n\nexport default Side1Main3;\n","import styled from 'styled-components/macro';\n\nconst GridAutoRest = styled.div`\n  display: grid;\n  grid-template-rows: auto 1fr;\n  overflow-y: hidden;\n`;\n\nexport default GridAutoRest;\n","import { ChevronLeftIcon, ChevronRightIcon } from '@primer/octicons-react';\nimport React, { useState } from 'react';\nimport styled from 'styled-components/macro';\nimport { IconSpacerPointer } from '../../../components/ui/IconSpacer';\nimport { useFlatClick } from '../../../hooks/useClick';\nimport theme from '../theme';\n\nconst Base = styled.div`\n  overflow: hidden;\n  position: relative;\n`;\n\nconst W200 = styled.div`\n  transition: transform ${theme.animation};\n  width: 200%;\n  height: 100%;\n`;\n\nconst Grid = styled.div`\n  height: 100%;\n  display: grid;\n  grid-template-columns: repeat(2, 50%);\n`;\n\nconst Flip: React.FC = function ({ children }) {\n  if (React.Children.count(children) !== 2) {\n    throw new Error('Should have two childrens !');\n  }\n  const [drawer, setDrawer] = useState<boolean>(true);\n\n  const click = useFlatClick(() => {\n    setDrawer((s) => !s);\n  });\n\n  return (\n    <Base>\n      <W200\n        style={{\n          transform: `translate3d(${drawer ? 0 : '-50%'}, 0, 0)`,\n        }}\n      >\n        <Grid>{children}</Grid>\n        <DrawerHandle {...click} />\n      </W200>\n    </Base>\n  );\n};\n\nconst DrawerIcon = styled.div`\n  z-index: 999;\n  border: 1px lightgray solid;\n  background-color: white;\n  line-height: 0;\n  padding: 10px 0;\n  border-radius: 10px;\n  box-shadow: 1px 1px 3px lightgray;\n  position: absolute;\n  display: flex;\n  top: 50%;\n  left: calc(50% - 25px);\n`;\n\nconst DrawerHandle: React.FC<{\n  onClick: React.MouseEventHandler;\n  onMouseUp: React.MouseEventHandler;\n}> = function ({ ...props }) {\n  return (\n    <DrawerIcon {...props}>\n      <IconSpacerPointer\n        as=\"span\"\n        spaceLeft\n        spaceRight\n        title=\"Réduire la vue générale\"\n      >\n        <ChevronLeftIcon verticalAlign=\"middle\" size=\"small\" />\n      </IconSpacerPointer>\n      <IconSpacerPointer\n        as=\"span\"\n        spaceLeft\n        spaceRight\n        title=\"Afficher la vue générale\"\n      >\n        <ChevronRightIcon verticalAlign=\"middle\" size=\"small\" />\n      </IconSpacerPointer>\n    </DrawerIcon>\n  );\n};\nexport default Flip;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { ProsoVisActor } from '../v2/types/actors';\n\ntype IntervalMask = {\n  start: string;\n  end: string;\n};\n\nexport type ActorMask = {\n  [k in ProsoVisActor['id']]?: boolean;\n};\n\ntype BoundsMask = [{ lat: number; lng: number }, { lat: number; lng: number }];\n\nexport const maskSlice = createSlice({\n  name: 'filters',\n  initialState: {} as {\n    interval?: IntervalMask;\n    bounds?: BoundsMask;\n    actor?: ActorMask;\n  },\n  reducers: {\n    setIntervalMask: function (\n      state,\n      { payload }: PayloadAction<IntervalMask>\n    ) {\n      state.interval = payload;\n    },\n    toggleActorMask: function (\n      state,\n      { payload }: PayloadAction<ProsoVisActor['id']>\n    ) {\n      if (state.actor)\n        state.actor[payload] =\n          state.actor[payload] !== undefined ? !state.actor[payload] : false;\n      else state.actor = { [payload]: false };\n    },\n    setActorMask: function (state, { payload }: PayloadAction<ActorMask>) {\n      state.actor = payload;\n    },\n    setBoundsMask: function (state, { payload }: PayloadAction<BoundsMask>) {\n      state.bounds = payload;\n    },\n    clearMask: function () {\n      return {};\n    },\n  },\n});\n\nexport const {\n  setIntervalMask,\n  setActorMask,\n  toggleActorMask,\n  setBoundsMask,\n  clearMask,\n} = maskSlice.actions;\n\nexport default maskSlice.reducer;\n","import { RootState } from '../reducers';\nimport { createSelector } from '@reduxjs/toolkit';\nimport { keyBy } from 'lodash/fp';\n\nexport const selectSelection = (state: RootState) => state.selection;\n\nexport const selectionAsMap = createSelector(selectSelection, (sel) =>\n  keyBy('id', sel)\n);\n","import { RootState } from '../reducers';\nimport { createSelector } from '@reduxjs/toolkit';\nimport { selectSelection } from './selection';\nimport { keyBy } from 'lodash/fp';\nimport { SelectionEvent } from '../reducers/selectionSlice';\nimport { SuperHightlightEvent } from '../reducers/superHighlightSlice';\n\nexport const selectSuperHighlight = (state: RootState) => state.superHighlight;\n\nexport const superHighlightAsMap = createSelector(\n  selectSuperHighlight,\n  keyBy<SuperHightlightEvent>('id')\n);\n\nexport const selectSuperSelection = createSelector(\n  selectSelection,\n  selectSuperHighlight,\n  (sel, superH) => {\n    if (superH) return superH;\n    else return sel;\n  }\n);\n\nexport const superSelectionAsMap = createSelector(\n  selectSuperSelection,\n  keyBy<SelectionEvent>('id')\n);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { isArray } from 'lodash/fp';\n\nexport type SuperHightlightEvent = {\n  id: string;\n  kind: string;\n  type?: string;\n};\n\nexport const superHighlightSlice = createSlice({\n  name: 'super-highlight',\n  initialState: null as SuperHightlightEvent[] | null,\n  reducers: {\n    setSuperHighlights(\n      _state,\n      action: PayloadAction<SuperHightlightEvent | SuperHightlightEvent[]>\n    ) {\n      return isArray(action.payload) ? action.payload : [action.payload];\n    },\n    clearSuperHighlights() {\n      return null;\n    },\n  },\n});\n\nexport const { setSuperHighlights, clearSuperHighlights } =\n  superHighlightSlice.actions;\n\nexport default superHighlightSlice.reducer;\n","import { useDispatch } from 'react-redux';\n\nimport {\n  SuperHightlightEvent,\n  clearSuperHighlights,\n  setSuperHighlights,\n} from '../reducers/superHighlightSlice';\n\nexport default function useHoverHighlight(\n  interactive: SuperHightlightEvent | SuperHightlightEvent[]\n) {\n  const dispatch = useDispatch();\n  return {\n    onMouseEnter: function () {\n      return dispatch(setSuperHighlights(interactive));\n    },\n    onMouseLeave: function () {\n      return dispatch(clearSuperHighlights());\n    },\n  };\n}\n","import React from 'react';\ntype HoverContextProps = {\n  id: string | null;\n  cancel: any;\n};\n\nexport const HoverContext = React.createContext<\n  React.MutableRefObject<HoverContextProps>\n>({} as any);\n","import React, { useMemo, useContext, useCallback } from 'react';\nimport { selectSwitchColor } from '../../selectors/switch';\nimport { superSelectionAsMap } from '../../selectors/superHighlights';\nimport useHoverHighlight from '../../hooks/useHoverHighlight';\nimport { useSelector } from 'react-redux';\nimport { useClickSelect } from '../../hooks/useClick';\nimport { HoverContext } from './HoverContext';\nimport { scaleSqrt, arc } from 'd3';\nimport { isEmpty, sumBy, map } from 'lodash';\n\nexport const PiePath: React.FC<{\n  a: d3.PieArcDatum<[string, any[]]>;\n  arc: d3.Arc<any, d3.PieArcDatum<[string, any[]]>>;\n  donut: number;\n  radius: number;\n}> = function ({ a, arc, donut, radius }) {\n  const $hover = useContext(HoverContext);\n  const color = useSelector(selectSwitchColor);\n\n  const [id, values] = a.data;\n\n  const d = useMemo(() => arc(a)!, [arc, a]);\n  const fill = useMemo(() => color(id), [color, id]);\n\n  const interactive = useMemo(\n    () => map(values, ({ id }) => ({ id, kind: 'Event' })),\n    [values]\n  );\n\n  const { onMouseEnter, onMouseLeave } = useHoverHighlight(interactive);\n\n  const handleMouseEnter = useCallback(() => {\n    if ($hover.current.cancel) $hover.current.cancel();\n    onMouseEnter();\n  }, [onMouseEnter, $hover]);\n  const handleMouseLeave = useCallback(() => {\n    $hover.current.id = null;\n    onMouseLeave();\n  }, [onMouseLeave, $hover]);\n\n  return (\n    <g\n      fill={fill}\n      {...useClickSelect(interactive)}\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n    >\n      <path opacity={0.3} d={d}>\n        <title>{values.length}</title>\n      </path>\n      <SelectedPiePath a={a} d={d} donut={donut} radius={radius}>\n        <title>{values.length}</title>\n      </SelectedPiePath>\n    </g>\n  );\n};\n\nexport default PiePath;\n\nconst scale = scaleSqrt();\nconst arcify = arc();\n\nconst SelectedPiePath: React.FC<{\n  a: d3.PieArcDatum<[string, any[]]>;\n  d: string;\n  donut: number;\n  radius: number;\n}> = function ({ a, d, donut, radius, children }) {\n  const selected = useSelector(superSelectionAsMap);\n  const {\n    startAngle,\n    endAngle,\n    data: [, events],\n  } = a;\n\n  const animatedD = useMemo(() => {\n    if (isEmpty(selected)) {\n      return d;\n    }\n\n    return arcify({\n      startAngle,\n      endAngle,\n      innerRadius: donut,\n      outerRadius:\n        donut +\n        radius *\n          scale(\n            sumBy(events, ({ id }) => (selected[id] ? 1 : 0)) / events.length\n          ),\n    })!;\n  }, [startAngle, endAngle, events, d, donut, radius, selected]);\n\n  return <path d={animatedD}>{children}</path>;\n};\n","import React, { useMemo } from 'react';\nimport * as d3 from 'd3';\nimport { PiePath } from './PiePath';\nimport { map } from 'lodash';\n\nexport const PieChart: React.FC<{\n  radius: number;\n  counts: [string, any[]][];\n  donut?: number;\n}> = function ({ radius, counts, donut = 0 }) {\n  const arcs = useMemo(\n    () =>\n      d3\n        .pie<[string, any[]]>()\n        .sort(null)\n        .value((d) => d[1].length)(counts),\n    [counts]\n  );\n  const arc = useMemo(\n    () =>\n      d3\n        .arc<d3.PieArcDatum<[string, any[]]>>()\n        .innerRadius(donut)\n        .outerRadius(donut + radius),\n    [radius, donut]\n  );\n\n  return (\n    <g stroke=\"white\" pointerEvents=\"initial\">\n      {map(arcs, (a) => (\n        <PiePath\n          key={a.data[0]}\n          a={a}\n          arc={arc}\n          donut={donut || 0}\n          radius={radius}\n        />\n      ))}\n    </g>\n  );\n};\n\nexport default PieChart;\n","import React, { ReactPortal, useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport { groups, sort } from 'd3';\nimport L from 'leaflet';\nimport 'leaflet.markercluster';\nimport ReactDOM from 'react-dom';\nimport { useSelector } from 'react-redux';\nimport { DataMarkerType } from '../marker/Marker';\nimport PieChart from '../PieChart';\nimport { selectDefaultGroupBy } from '../../../selectors/switch';\n\ntype Cluster = L.MarkerCluster & {\n  _childClusters: Cluster[];\n  _iconNeedsUpdate: boolean;\n  _icon: HTMLElement;\n  _leaflet_id: string;\n  _svg_is_child: any;\n  _svg: HTMLElement;\n};\n\nfunction getChildren(parent: Cluster) {\n  return parent._childClusters;\n}\n\nfunction getChildClusters(current: Cluster, aggregator: Cluster[]) {\n  if (!current._svg) {\n    current._svg = d3.create('div').node()!;\n    // current._svg_is_child = false;\n  }\n  aggregator.push(current);\n  const childrens = getChildren(current);\n\n  if (childrens.length !== 0) {\n    if (childrens.length === 1 && !childrens[0]._svg) {\n      // childrens[0]._svg = current._svg;\n      // childrens[0]._svg_is_child = true;\n    }\n    childrens.forEach((c) => getChildClusters(c, aggregator));\n  }\n\n  return aggregator;\n}\n\nconst scale = d3.scaleSqrt().range([0, 5]);\n\nfunction iconCreateFunction(cluster: L.MarkerCluster) {\n  const markers = cluster.getAllChildMarkers();\n  const radius = scale(markers.length);\n  const size = radius * 2 + 10;\n\n  if (!(cluster as any)._svg) {\n    (cluster as any)._svg = d3.create('div').node();\n    // (cluster as any)._svg_is_child = (cluster as any)._svg_is_child;\n  }\n\n  return L.divIcon({\n    html: (cluster as any)._svg,\n    className: '',\n    iconSize: L.point(size, size),\n  });\n}\n\nexport const MarkerClusterGroup: React.FC<{\n  $l: React.MutableRefObject<any>;\n  markers: (ref: React.MutableRefObject<L.MarkerClusterGroup>) => JSX.Element[];\n  options?: L.MarkerClusterGroupOptions;\n}> = function ({ $l, markers, options }) {\n  const $group = useRef<L.MarkerClusterGroup>(undefined as any);\n  if ($group.current === undefined) {\n    $group.current = L.markerClusterGroup({\n      ...options,\n      iconCreateFunction,\n    });\n  }\n\n  useEffect(\n    function () {\n      const p = $l.current;\n      p.addLayer($group.current);\n      return function () {\n        // eslint-disable-next-line\n        p.removeLayer($group.current);\n      };\n    },\n    // eslint-disable-next-line\n    []\n  );\n\n  const markerGroupBy = useSelector(selectDefaultGroupBy);\n\n  const [portals, setPortals] = useState<(ReactPortal | null)[]>([]);\n  useEffect(() => {\n    const clusters = getChildClusters(\n      ($group.current as any)._topClusterLevel as Cluster,\n      []\n    );\n\n    setPortals(\n      clusters.map((c) => {\n        const markers: DataMarkerType[] = c.getAllChildMarkers() as any[];\n        const radius = scale(markers.length);\n        const size = radius * 2;\n\n        const counts = sort(\n          groups(\n            markers.map((s) => s.options),\n            markerGroupBy\n          ),\n          ([key]) => key\n        );\n\n        // const counts = pipe(\n        //   map((s: DataMarkerType) => s.options),\n        //   groupBy<DataMarkerOptions>(markerGroupBy),\n        //   toPairs,\n        //   sortBy<[string, L.MarkerOptions[]]>('0')\n        // )(markers);\n\n        // if (!c._svg_is_child) {\n        return ReactDOM.createPortal(\n          <svg\n            width={size + 10}\n            height={size + 10}\n            viewBox={`${-radius - 5} ${-radius - 5} ${size + 10} ${size + 10}`}\n          >\n            <PieChart radius={radius} counts={counts} donut={5} />\n          </svg>,\n          c._svg\n        );\n        // }\n\n        // return null;\n      })\n    );\n  }, [markers, markerGroupBy]);\n\n  // useEffect(\n  //   function() {\n  //     if (!onClusterClick) return;\n  //     const group = $group.current;\n  //     group.on('clusterclick' as any, onClusterClick);\n  //     return () => {\n  //       group.off('clusterclick' as any, onClusterClick);\n  //     };\n  //   },\n  //   [onClusterClick]\n  // );\n\n  return (\n    <>\n      {markers($group)}\n      {portals}\n    </>\n  );\n};\n","import React, { useEffect } from 'react';\nimport L from 'leaflet';\nimport useLazyRef from '../../../hooks/useLazyRef';\nimport { ProsoVisDetailRichEvent } from '../../../v2/types/events';\n\nexport type DataMarkerOptions = L.CircleMarkerOptions & {\n  id: string;\n} & ProsoVisDetailRichEvent;\n\nexport interface DataMarkerType extends L.CircleMarker {\n  new (latlng: L.LatLngExpression, options?: DataMarkerOptions): DataMarkerType;\n\n  options: DataMarkerOptions;\n}\n\nconst DataMarker = L.CircleMarker.extend({\n  options: { id: null, kind: null, actor: null },\n}) as any as DataMarkerType;\n\nexport const Marker: React.FC<{\n  $map: React.MutableRefObject<L.Map>;\n  $l: React.MutableRefObject<L.LayerGroup>;\n  latlng: L.LatLngExpression;\n  options: DataMarkerOptions;\n  onMouseOver?: L.LeafletEventHandlerFn;\n  onMouseOut?: L.LeafletEventHandlerFn;\n  onClick?: L.LeafletEventHandlerFn;\n  onMarkerAdd?: (marker: DataMarkerType) => void;\n  onMarkerRemove?: (marker: DataMarkerType) => void;\n}> = function ({\n  latlng,\n  options,\n  $l,\n  $map,\n  onMouseOut,\n  onMouseOver,\n  onClick,\n}) {\n  const marker = useLazyRef(() => new DataMarker(latlng, options));\n\n  useEffect(function () {\n    // const marker = L.circleMarker(latlng, {fillColor: color.main()});\n    $l.current.addLayer(marker.current);\n    $map.current.fire('sip-marker', { current: marker.current }, true);\n    return function () {\n      // eslint-disable-next-line\n      $l.current.removeLayer(marker.current);\n      // eslint-disable-next-line\n      $map.current.fire('sip-marker-off', { current: marker.current }, true);\n    };\n    // eslint-disable-next-line\n  }, []);\n\n  useColor(marker, options.color, options.fillColor);\n\n  useFillOpacity(marker, options.fillOpacity);\n\n  useHover(marker, onMouseOver, onMouseOut);\n\n  useClick(marker, onClick);\n\n  return null;\n};\nfunction useColor(\n  marker: React.MutableRefObject<DataMarkerType>,\n  color?: string,\n  fillColor?: string\n) {\n  useEffect(\n    function () {\n      marker.current.setStyle({ color, fillColor });\n    }, // safely ignoring marker\n    // eslint-disable-next-line\n    [color, fillColor]\n  );\n}\n\nfunction useFillOpacity(\n  marker: React.MutableRefObject<DataMarkerType>,\n  fillOpacity?: number\n) {\n  useEffect(\n    function () {\n      marker.current.setStyle({ fillOpacity });\n    }, // safely ignoring marker\n    // eslint-disable-next-line\n    [fillOpacity]\n  );\n}\n\nfunction useHover(\n  marker: React.MutableRefObject<DataMarkerType>,\n  onMouseOver?: L.LeafletEventHandlerFn,\n  onMouseOut?: L.LeafletEventHandlerFn\n) {\n  useEffect(\n    function () {\n      if (onMouseOver !== undefined) {\n        marker.current.on('mouseover', onMouseOver);\n        return function () {\n          // marker.current does not change\n          // eslint-disable-next-line\n          marker.current.off('mouseover');\n        };\n      }\n    }, // safely ignoring marker\n    // eslint-disable-next-line\n    [onMouseOver]\n  );\n\n  useEffect(\n    function () {\n      if (onMouseOut !== undefined) {\n        marker.current.on('mouseout', onMouseOut);\n        return function () {\n          // marker.current does not change\n          // eslint-disable-next-line\n          marker.current.off('mouseout');\n        };\n      }\n    }, // safely ignoring marker\n    // eslint-disable-next-line\n    [onMouseOut]\n  );\n}\n\nfunction useClick(\n  marker: React.MutableRefObject<DataMarkerType>,\n  onMouseClick?: L.LeafletEventHandlerFn\n) {\n  useEffect(\n    function () {\n      if (onMouseClick !== undefined) {\n        marker.current.on('click', onMouseClick);\n\n        return function () {\n          // marker.current does not change\n          // eslint-disable-next-line\n          marker.current.off('click');\n        };\n      }\n    }, // safely ignoring marker\n    // eslint-disable-next-line\n    [onMouseClick]\n  );\n}\n","import React, { useCallback, useMemo } from 'react';\nimport L from 'leaflet';\nimport { isEmpty } from 'lodash/fp';\nimport { useDispatch, useSelector } from 'react-redux';\nimport useHoverHighlight from '../../../hooks/useHoverHighlight';\nimport { setSelection } from '../../../reducers/selectionSlice';\nimport { superSelectionAsMap } from '../../../selectors/superHighlights';\nimport { selectRichEventColor } from '../../../selectors/switch';\nimport { ProsoVisDetailRichEvent } from '../../../v2/types/events';\nimport { Marker } from './Marker';\n\nconst SipMarker: React.FC<{\n  $l: React.MutableRefObject<L.LayerGroup>;\n  $map: React.MutableRefObject<L.Map>;\n  event: Required<ProsoVisDetailRichEvent>;\n}> = function ({ $l, $map, event }) {\n  const dispatch = useDispatch();\n  const { place } = event;\n  const { id } = event.event;\n  const color = useSelector(selectRichEventColor);\n  const selected = useSelector(superSelectionAsMap);\n  const interactive = useMemo(() => ({ id, kind: 'Event' }), [id]);\n  const { onMouseEnter, onMouseLeave } = useHoverHighlight(interactive);\n\n  return (\n    <Marker\n      $map={$map}\n      $l={$l}\n      onClick={useCallback(\n        () => dispatch(setSelection(interactive)),\n        // safely ignoring dispatch\n        // eslint-disable-next-line\n        [interactive]\n      )}\n      onMouseOver={onMouseEnter}\n      onMouseOut={onMouseLeave}\n      latlng={[+place.lat!, +place.lng!]}\n      options={{\n        id,\n        ...event,\n        fillColor: color.main(event),\n        color: color.border(event),\n        fillOpacity: isEmpty(selected) || selected[id] !== undefined ? 1 : 0.5,\n        weight: 1,\n        radius: 5,\n      }}\n    >\n      {/* <Popup>{label}</Popup> */}\n    </Marker>\n  );\n};\n\nexport default SipMarker;\n","import { createSelector } from '@reduxjs/toolkit';\nimport { transform } from 'lodash/fp';\nimport { selectMaskedEvents } from '../../selectors/mask';\n\nimport { ProsoVisDetailRichEvent } from '../../v2/types/events';\n\nexport const selectLocalisedEvents = createSelector(\n  selectMaskedEvents,\n  (events) =>\n    transform(\n      (acc, e) => {\n        const l = e.place;\n        if (l && l.lat && l.lng)\n          acc.push(e as Required<ProsoVisDetailRichEvent>);\n      },\n      [] as Required<ProsoVisDetailRichEvent>[],\n      events\n    )\n);\n","import React, { useCallback } from 'react';\nimport { MarkerClusterGroup } from './MarkerClusterGroup';\n\nimport L from 'leaflet';\nimport 'leaflet.markercluster';\n\nimport { useSelector } from 'react-redux';\nimport SipMarker from '../marker/SipMarker';\nimport { selectLocalisedEvents } from '../selectLocalisedEvents';\n\nexport const SipMarkerClusterGroup: React.FC<{\n  $map: React.MutableRefObject<L.Map>;\n  $layer: React.MutableRefObject<any>;\n}> = function ({ $map, $layer }) {\n  const events = useSelector(selectLocalisedEvents);\n\n  // const onClusterClick = useCallback(\n  //   (e: L.LeafletMouseEvent) => {\n  //     const cluster = e.layer;\n  //     let bottomCluster = cluster;\n  //     let zoomLevel = cluster._zoom;\n  //     while (bottomCluster._childClusters.length === 1) {\n  //       bottomCluster = bottomCluster._childClusters[0];\n  //       if (\n  //         zoomLevel === cluster._zoom &&\n  //         cluster._childCount !== bottomCluster._childCount\n  //       ) {\n  //         zoomLevel = bottomCluster._zoom;\n  //       }\n  //     }\n  //     if (bottomCluster._childClusters.length > 1) {\n  //       zoomLevel = bottomCluster._childClusters[0]._zoom;\n  //     }\n  //     if (\n  //       bottomCluster._zoom === e.target._maxZoom &&\n  //       bottomCluster._childCount === cluster._childCount\n  //     ) {\n  //       // All child markers are contained in a single cluster from this._maxZoom to this cluster.\n  //       cluster.spiderfy();\n  //     } else {\n  //       $map.current.flyTo(cluster._cLatLng, zoomLevel);\n  //     }\n  //   },\n  //   [$map]\n  // );\n\n  const getMarkers = useCallback(\n    (ref: React.MutableRefObject<L.MarkerClusterGroup>) => {\n      return events.map((event) => (\n        <SipMarker $map={$map} $l={ref} key={event.event.id} event={event} />\n      ));\n    },\n    // safely disabling $map ref\n    // eslint-disable-next-line\n    [events]\n  );\n\n  return (\n    <MarkerClusterGroup\n      $l={$layer}\n      markers={getMarkers}\n      options={{\n        animate: false,\n        maxClusterRadius: 50,\n        zoomToBoundsOnClick: false,\n        showCoverageOnHover: false,\n        removeOutsideVisibleBounds: true,\n        spiderfyOnMaxZoom: false,\n      }}\n    />\n  );\n};\n\nexport default SipMarkerClusterGroup;\n","import L from 'leaflet';\n\nfunction forEachPair(list, callback) {\n  if (!list || list.length < 1) {\n    return;\n  }\n  for (var i = 1, l = list.length; i < l; i++) {\n    callback(list[i - 1], list[i]);\n  }\n}\n\n/**\nFind the coefficients (a,b) of a line of equation y = a.x + b,\nor the constant x for vertical lines\nReturn null if there's no equation possible\n*/\nfunction lineEquation(pt1, pt2) {\n  if (pt1.x === pt2.x) {\n    return pt1.y === pt2.y ? null : { x: pt1.x };\n  }\n\n  var a = (pt2.y - pt1.y) / (pt2.x - pt1.x);\n  return {\n    a: a,\n    b: pt1.y - a * pt1.x\n  };\n}\n\n/**\nReturn the intersection point of two lines defined by two points each\nReturn null when there's no unique intersection\n*/\nfunction intersection(l1a, l1b, l2a, l2b) {\n  var line1 = lineEquation(l1a, l1b);\n  var line2 = lineEquation(l2a, l2b);\n\n  if (line1 === null || line2 === null) {\n    return null;\n  }\n\n  if (line1.hasOwnProperty('x')) {\n    return line2.hasOwnProperty('x')\n      ? null\n      : {\n          x: line1.x,\n          y: line2.a * line1.x + line2.b\n        };\n  }\n  if (line2.hasOwnProperty('x')) {\n    return {\n      x: line2.x,\n      y: line1.a * line2.x + line1.b\n    };\n  }\n\n  if (line1.a === line2.a) {\n    return null;\n  }\n\n  var x = (line2.b - line1.b) / (line1.a - line2.a);\n  return {\n    x: x,\n    y: line1.a * x + line1.b\n  };\n}\n\nfunction translatePoint(pt, dist, heading) {\n  return {\n    x: pt.x + dist * Math.cos(heading),\n    y: pt.y + dist * Math.sin(heading)\n  };\n}\n\nfunction offsetPointLine(points, distance) {\n  var offsetSegments = [];\n\n  forEachPair(points, (a, b) => {\n    if (a.x === b.x && a.y === b.y) {\n      return;\n    }\n\n    // angles in (-PI, PI]\n    var segmentAngle = Math.atan2(a.y - b.y, a.x - b.x);\n    var offsetAngle = segmentAngle - Math.PI / 2;\n\n    offsetSegments.push({\n      offsetAngle: offsetAngle,\n      original: [a, b],\n      offset: [\n        translatePoint(a, distance, offsetAngle),\n        translatePoint(b, distance, offsetAngle)\n      ]\n    });\n  });\n\n  return offsetSegments;\n}\n\nfunction offsetPoints(pts, offset) {\n  var offsetSegments = offsetPointLine(pts, offset);\n  return joinLineSegments(offsetSegments, offset);\n}\n\nfunction joinLineSegments(segments, offset) {\n  var joinedPoints = [];\n  var first = segments[0];\n  var last = segments[segments.length - 1];\n\n  if (first && last) {\n    joinedPoints.push(first.offset[0]);\n    forEachPair(segments, (s1, s2) => {\n      joinedPoints = joinedPoints.concat(joinSegments(s1, s2, offset));\n    });\n    joinedPoints.push(last.offset[1]);\n  }\n\n  return joinedPoints;\n}\n\n/**\n *  Join 2 line segments defined by 2 points each with a circular arc\n */\nfunction joinSegments(s1, s2, offset) {\n  // TODO: different join styles\n  return circularArc(s1, s2, offset).filter(function(x) {\n    return x;\n  });\n}\n\n/**\n    Interpolates points between two offset segments in a circular form\n    */\nfunction circularArc(s1, s2, distance) {\n  // if the segments are the same angle,\n  // there should be a single join point\n  if (s1.offsetAngle === s2.offsetAngle) {\n    return [s1.offset[1]];\n  }\n\n  const signedAngle = getSignedAngle(s1.offset, s2.offset);\n  // for inner angles, just find the offset segments intersection\n  if (\n    signedAngle * distance > 0 &&\n    signedAngle * getSignedAngle(s1.offset, [s1.offset[0], s2.offset[1]]) > 0\n  ) {\n    return [\n      intersection(s1.offset[0], s1.offset[1], s2.offset[0], s2.offset[1])\n    ];\n  }\n\n  // draws a circular arc with R = offset distance, C = original meeting point\n  var points = [];\n  var center = s1.original[1];\n  // ensure angles go in the anti-clockwise direction\n  var rightOffset = distance > 0;\n  var startAngle = rightOffset ? s2.offsetAngle : s1.offsetAngle;\n  var endAngle = rightOffset ? s1.offsetAngle : s2.offsetAngle;\n  // and that the end angle is bigger than the start angle\n  if (endAngle < startAngle) {\n    endAngle += Math.PI * 2;\n  }\n  var step = Math.PI / 8;\n  for (var alpha = startAngle; alpha < endAngle; alpha += step) {\n    points.push(translatePoint(center, distance, alpha));\n  }\n  points.push(translatePoint(center, distance, endAngle));\n\n  return rightOffset ? points.reverse() : points;\n}\n\nfunction getSignedAngle(s1, s2) {\n  const a = segmentAsVector(s1);\n  const b = segmentAsVector(s2);\n  return Math.atan2(a.x * b.y - a.y * b.x, a.x * b.x + a.y * b.y);\n}\n\nfunction segmentAsVector(s) {\n  return {\n    x: s[1].x - s[0].x,\n    y: s[1].y - s[0].y\n  };\n}\n// Modify the Creates a Polylineoffset class\nexport const PolylineOffset = L.Polyline.extend({\n  _projectLatlngs: function(latlngs, result, projectedBounds) {\n    var flat = latlngs[0] instanceof L.LatLng,\n      len = latlngs.length,\n      i,\n      ring;\n\n    if (flat) {\n      ring = [];\n      for (i = 0; i < len; i++) {\n        ring[i] = this._map.latLngToLayerPoint(latlngs[i]);\n        projectedBounds.extend(ring[i]);\n      }\n\n      // Offset management hack ---\n      if (this.options.offset) {\n        ring = offsetPoints(ring, this.options.offset);\n      }\n      // Offset management hack END ---\n\n      result.push(\n        ring.map(function(xy) {\n          return L.point(xy.x, xy.y);\n        })\n      );\n    } else {\n      for (i = 0; i < len; i++) {\n        this._projectLatlngs(latlngs[i], result, projectedBounds);\n      }\n    }\n  },\n\n  setOffset: function(offset) {\n    this.options.offset = offset;\n    this.redraw();\n    return this;\n  }\n});\n\nexport default PolylineOffset;\n","import React, { useRef } from 'react';\nimport { useEffect } from 'react';\nimport { antPath } from 'leaflet-ant-path';\nimport '../../../polylineoffset/index';\nimport PolylineOffset from '../../../polylineoffset/index';\nimport { useSelector } from 'react-redux';\nimport { superSelectionAsMap } from '../../../selectors/superHighlights';\nimport { isEmpty } from 'lodash/fp';\n\nexport type AntPathEvent<T = { id: string; [k: string]: any }> = {\n  options: T;\n  groupId: any;\n  latLng: L.LatLng;\n};\n\nexport const AntPath: React.FC<{\n  $l: React.MutableRefObject<L.LayerGroup>;\n  id: string;\n  events: AntPathEvent[];\n  color?: string;\n  offset?: number;\n  twoWay?: boolean;\n  weight?: number;\n  dashArray?: string | number[];\n  delay?: number;\n}> = function ({\n  $l,\n  events,\n  offset,\n  twoWay,\n  color,\n  weight = 5,\n  dashArray = [2, 12],\n  delay = 400,\n}) {\n  const $antpath = useRef<any>();\n\n  useEffect(() => {\n    const antpath = antPath([], {\n      pulseColor: '#FFFFFF',\n      lineCap: 'butt',\n      dashArray,\n      delay,\n      use: (path: any, options: any) => new PolylineOffset(path, options),\n    });\n    $antpath.current = antpath;\n    $l.current.addLayer(antpath);\n\n    return () => {\n      // layer persists across time and space\n      // eslint-disable-next-line\n      $l.current.removeLayer(antpath);\n    };\n    // ignoring options update\n    // eslint-disable-next-line\n  }, []);\n\n  const selected = useSelector(superSelectionAsMap);\n\n  // update path\n  useEffect(() => {\n    $antpath.current.setLatLngs(events.map((e) => e.latLng));\n  }, [events]);\n\n  // update color\n  useEffect(() => {\n    $antpath.current.setStyle({ color });\n  }, [color]);\n\n  // update weight\n  useEffect(() => {\n    $antpath.current.setStyle({ weight: weight - 1 });\n  }, [weight]);\n\n  useEffect(() => {\n    $antpath.current.setStyle({ dashArray });\n  }, [dashArray]);\n\n  useEffect(() => {\n    $antpath.current.setStyle({ delay });\n  }, [delay]);\n\n  // update opacity\n  useEffect(() => {\n    $antpath.current.setStyle({\n      opacity:\n        isEmpty(selected) ||\n        events.some(({ options: { id } }) => selected[id] !== undefined)\n          ? undefined\n          : 0.3,\n    });\n  }, [selected, events]);\n\n  // update offset\n  useEffect(() => {\n    $antpath.current.setStyle({\n      offset:\n        offset !== undefined\n          ? offset * weight + (twoWay ? weight / 2 : 0)\n          : undefined,\n    });\n    $antpath.current.redraw();\n  }, [offset, twoWay, weight]);\n\n  return null;\n};\n","import React, { useCallback, useContext, useEffect, useMemo } from 'react';\nimport * as d3 from 'd3-scale';\nimport L from 'leaflet';\nimport { debounce } from 'lodash/fp';\nimport { useDispatch, useSelector } from 'react-redux';\nimport useHoverHighlight from '../../../hooks/useHoverHighlight';\nimport useLazyRef from '../../../hooks/useLazyRef';\nimport { setSelection } from '../../../reducers/selectionSlice';\nimport { selectSwitchActorColor } from '../../../selectors/switch';\nimport { darkgray } from '../../../v2/components/theme';\nimport { HoverContext } from '../HoverContext';\nimport { DataMarkerOptions } from '../marker/Marker';\nimport { AntPath } from './AntPath';\nimport { PathSegment } from './path-maker';\n\nconst scale = d3.scaleLog().domain([1, 10]).range([2, 50]);\n\nexport const ActorPath: React.FC<{\n  id: string;\n  $l: React.MutableRefObject<L.LayerGroup>;\n  // $hover: React.MutableRefObject<string | null>;\n  chain: PathSegment<DataMarkerOptions>[];\n  events: DataMarkerOptions[];\n  offset: _.Dictionary<number>;\n  total: _.Dictionary<boolean>;\n}> = function ({ id, $l, chain, offset, total, events }) {\n  const $hover = useContext(HoverContext);\n  const dispatch = useDispatch();\n\n  const $group = useLazyRef<L.FeatureGroup<any>>(() => L.featureGroup());\n  useEffect(function () {\n    $l.current.addLayer($group.current);\n    return function () {\n      // layer persists across time and space\n      // eslint-disable-next-line\n      $l.current.removeLayer($group.current);\n    };\n    // safely disabling $layer ref\n    // eslint-disable-next-line\n  }, []);\n\n  const colorFn = useSelector(selectSwitchActorColor);\n\n  const interactive = useMemo(\n    () => events.map(({ id }) => ({ id, kind: 'Event' })),\n    [events]\n  );\n  const handleHover = useHoverHighlight(interactive);\n  const click = useCallback(\n    () => dispatch(setSelection(interactive)),\n    [dispatch, interactive]\n  );\n  // event listeners\n  useEffect(() => {\n    const debounceMouseOut = debounce(100, function () {\n      if ($hover.current.id === id) {\n        $hover.current.id = null;\n        handleHover.onMouseLeave();\n      }\n    });\n\n    const handlers: L.LeafletEventHandlerFnMap = {\n      mouseover: function () {\n        if ($hover.current.id !== id) {\n          handleHover.onMouseEnter();\n          $hover.current.id = id;\n          $hover.current.cancel = debounceMouseOut.cancel;\n        } else if ($hover.current.id === id) {\n          $hover.current.cancel();\n        }\n      },\n      mouseout: debounceMouseOut,\n      click,\n    };\n    $group.current.on(handlers);\n    return () => {\n      // group persists across time and space\n      // eslint-disable-next-line\n      $group.current.off(handlers);\n    };\n  }, [id, $group, $hover, handleHover, click]);\n\n  return (\n    <>\n      {chain.map(({ segment, diff }) => {\n        const key = segment.map((s) => s.options.id).join(':');\n        const grp = segment.map((s) => s.groupId).join(':');\n\n        return (\n          <AntPath\n            key={key}\n            id={key}\n            $l={$group}\n            events={segment}\n            offset={offset[key]}\n            twoWay={total[grp]}\n            dashArray={[2, scale(diff < 1 ? 1 : diff)]}\n            delay={500}\n            color={colorFn ? colorFn(id) : darkgray}\n          />\n        );\n      })}\n    </>\n  );\n};\n\n// inverser les traits sur les déplacements\n// lieu et temps pour le graphe\n// baricentre des voisins\n// créer le graphe de connexité\n// charger en local le graphe de connexité\n// - utiliser les infos du graphe de connexité pour aider l'autocompletion\n// - permettre d'agrandir le graphe en fonction des voisins\n// - lors de la selection d'un fantome (voisin a ajouter) : proposer une popup pour supprimer les acteurs si supérieurs à 5\n","import { AntPathEvent } from './AntPath';\nimport * as d3 from 'd3-array';\nimport { DataMarkerOptions } from '../marker/Marker';\nimport {\n  compact,\n  first,\n  forEach,\n  last,\n  pipe,\n  sortBy,\n  transform,\n} from 'lodash/fp';\ntype FlatAntPath<T> = {\n  event: AntPathEvent<T>;\n  start: string;\n  end: string;\n}[];\n\nexport default function pathMaker(this: any) {\n  let stack: AntPathEvent<DataMarkerOptions>[] = [];\n  let results: FlatAntPath<DataMarkerOptions> = [];\n\n  function add(event: AntPathEvent<DataMarkerOptions>) {\n    const eventFirst = getFirstDate(event);\n    if (!eventFirst) return; // makes sures that there is a date for this event, if not, the event is not added.\n\n    solve(eventFirst);\n\n    const lastEvent = last(stack);\n    if (lastEvent) {\n      // case 2 or 3\n      results.push({\n        event: lastEvent,\n        start: getFirstDate(lastEvent),\n        end: eventFirst,\n      });\n    }\n\n    clean(getLastDate(event));\n    stack.push(event);\n    // console.log('add', _.map(this.stack), _.map(this.results));\n  }\n\n  function solve(threshold?: string) {\n    if (stack.length > 0) {\n      let previous = stack[stack.length - 1];\n      let prevLast = getLastDate(previous);\n\n      if (threshold === undefined || prevLast <= threshold) {\n        let start = getFirstDate(previous);\n        stack[stack.length - 1] = null!; // destroying from stack\n\n        for (let i = stack.length - 2; i >= 0; i--) {\n          if (threshold !== undefined && threshold < prevLast) break; //ignore next possibles\n\n          results.push({ event: previous, start, end: prevLast });\n          start = prevLast;\n          previous = stack[i];\n          prevLast = getLastDate(previous);\n          stack[i] = null!;\n        }\n\n        if (threshold === undefined || prevLast <= threshold) {\n          results.push({ event: previous, start, end: prevLast });\n        }\n\n        stack = compact(stack);\n      }\n    }\n    // console.log('solve', _.map(results));\n  }\n\n  function clean(threshold: string) {\n    stack = stack.filter((s) => threshold < getLastDate(s));\n    // console.log('clean', _.map(stack));\n  }\n\n  return { solve, add, results: () => results };\n}\n\nexport function flatify(events: AntPathEvent<DataMarkerOptions>[]) {\n  // console.groupCollapsed('pathmaker');\n  const { solve, add, results } = pathMaker();\n\n  pipe(sortBy(getFirstDate), forEach(add))(events);\n\n  solve();\n\n  // console.groupEnd();\n  return results();\n}\n\ntype SimpleAntPath<T> = {\n  interval: [AntPathEvent<T>, AntPathEvent<T>];\n  id: string;\n  start: string;\n  end: string;\n}[];\n\nexport function simplify(flatPath: FlatAntPath<DataMarkerOptions>) {\n  return transform(\n    (acc, { event, start, end }) => {\n      const prev = last(acc);\n      if (prev !== undefined && prev.id === event.groupId) {\n        prev.interval[1] = event;\n        prev.end = end;\n      } else {\n        acc.push({ interval: [event, event], id: event.groupId, start, end });\n      }\n    },\n    [] as SimpleAntPath<DataMarkerOptions>,\n    flatPath\n  );\n}\n\nexport type PathSegment<T> = {\n  segment: [AntPathEvent<T>, AntPathEvent<T>];\n  diff: number;\n  // dist: number;\n};\n\nexport function segmentify(\n  simplePath: SimpleAntPath<DataMarkerOptions>\n): PathSegment<DataMarkerOptions>[] {\n  return d3.pairs(\n    simplePath,\n    ({ interval: [, first], end }, { interval: [last], start }) => {\n      const segment: [\n        AntPathEvent<DataMarkerOptions>,\n        AntPathEvent<DataMarkerOptions>\n      ] = [first, last];\n\n      return { segment, diff: +start.slice(0, 4) - +end.slice(0, 4) };\n    }\n  );\n}\n\nexport const getFirstDate = ({ options }: AntPathEvent<DataMarkerOptions>) =>\n  first(options.event.datation)?.value!;\nexport const getLastDate = ({ options }: AntPathEvent<DataMarkerOptions>) =>\n  last(options.event.datation)?.value!;\n","import React, { useMemo, useState, useReducer } from 'react';\nimport L from 'leaflet';\nimport { useEffect } from 'react';\nimport { PayloadAction } from '@reduxjs/toolkit';\nimport useLazyRef from '../../../hooks/useLazyRef';\nimport { ActorPath } from './ActorPath';\nimport { AntPathEvent } from './AntPath';\nimport { flatify, simplify, segmentify, PathSegment } from './path-maker';\nimport {\n  keyBy,\n  map,\n  pickBy,\n  flow,\n  groupBy,\n  mapValues,\n  flatMap,\n  sortBy,\n  filter,\n  pipe,\n  fromPairs,\n  reverse,\n} from 'lodash/fp';\nimport { map as _map } from 'lodash';\nimport { DataMarkerOptions, DataMarkerType } from '../marker/Marker';\nimport { groups } from 'd3';\n\nconst markerReducer = function (\n  state: _.Dictionary<DataMarkerType>,\n  action: PayloadAction<any>\n) {\n  switch (action.type) {\n    case 'set':\n      return action.payload;\n    case 'add':\n      return { ...state, [action.payload.options.id]: action.payload };\n    case 'remove':\n      return pickBy((_value, key) => {\n        // weak equal to mitigate issues between number and string\n        return key !== action.payload.options.id.toString();\n      }, state);\n    default:\n      throw new Error();\n  }\n};\n\nconst SipAnthPaths: React.FC<{\n  $map: React.MutableRefObject<L.Map>;\n  $l: React.MutableRefObject<any>;\n  defaultMarkerSet: React.MutableRefObject<any[]>;\n}> = function ({ $map, $l, defaultMarkerSet }) {\n  const $group = useLazyRef<L.LayerGroup<any>>(() => L.layerGroup());\n\n  useEffect(function () {\n    $l.current.addLayer($group.current);\n    return function () {\n      // layer persists across time and space\n      // eslint-disable-next-line\n      $l.current.removeLayer($group.current);\n    };\n    // safely disabling $layer ref\n    // eslint-disable-next-line\n  }, []);\n\n  const [markers, dispatch] = useReducer(markerReducer, {});\n  const [zoom, setZoom] = useState(() => $map.current.getZoom());\n\n  useEffect(() => {\n    const map = $map.current;\n\n    dispatch({\n      type: 'set',\n      payload: keyBy('options.id', defaultMarkerSet.current),\n    });\n\n    const handleZoom = () => setZoom(map.getZoom());\n\n    const handleMarkerAdd = (e: any) =>\n      dispatch({ type: 'add', payload: e.current });\n\n    const handleMarkerRemove = (e: any) =>\n      dispatch({ type: 'remove', payload: e.current });\n\n    map.on({\n      zoomend: handleZoom,\n      'sip-marker': handleMarkerAdd,\n      'sip-marker-off': handleMarkerRemove,\n    } as any);\n\n    return () => {\n      map.off({\n        zoomend: handleZoom,\n        'sip-marker': handleMarkerAdd,\n        'sip-marker-off': handleMarkerRemove,\n      } as any);\n    };\n    // safely disabling $map and initialMarkerSet\n    // eslint-disable-next-line\n  }, []);\n\n  const { chens, offset, total } = useMemo(() => {\n    const chens: _.Dictionary<{\n      markers: DataMarkerOptions[];\n      chain: PathSegment<DataMarkerOptions>[];\n    }> = flow(\n      map(\n        (marker: DataMarkerType) =>\n          ({\n            // extracting current cluster or marker position and id\n            options: marker.options,\n            ...getMarkerLatLng(marker, zoom),\n          } as AntPathEvent<DataMarkerOptions>)\n      ),\n      groupBy('options.actor.id'),\n      mapValues(\n        // chaining values\n        (markers: AntPathEvent<DataMarkerOptions>[]) => ({\n          markers: markers.map((m) => m.options),\n          chain: flow(flatify, simplify, segmentify)(markers),\n        })\n      )\n    )(markers); // 5. we obtain a chain for each actor\n\n    const flatChens = flow(\n      flatMap('chain'),\n      filter<PathSegment<DataMarkerOptions>>(\n        'segment.1.options.event.datation.0.value'\n      ),\n      sortBy<PathSegment<DataMarkerOptions>>(\n        'segment.1.options.event.datation.0.value'\n      )\n    )(chens);\n\n    const offset = fromPairs(\n      groups(flatChens, ({ segment }) =>\n        segment.map((s) => s.groupId).join(':')\n      ).flatMap(([_group, chain]) =>\n        chain.map(\n          ({ segment }, i) =>\n            [segment.map((s) => s.options.id).join(':'), i] as [string, number]\n        )\n      )\n    );\n\n    const total = pipe(\n      map(({ segment }: PathSegment<DataMarkerOptions>) =>\n        segment.map((s) => s.groupId)\n      ),\n      keyBy((ids: string[]) => ids.join(':')),\n      (values) =>\n        mapValues((ids) => values[reverse(ids).join(':')] !== undefined, values)\n    )(flatChens);\n\n    return { chens, offset, total };\n  }, [zoom, markers]);\n  return (\n    <>\n      {_map(chens, ({ chain, markers }, key) => (\n        <ActorPath\n          key={key}\n          id={'' + key}\n          $l={$group}\n          chain={chain}\n          events={markers}\n          offset={offset}\n          total={total}\n        />\n      ))}\n    </>\n  );\n};\n\nexport default SipAnthPaths;\n\nexport function getMarkerLatLng(marker: any, zoom: number) {\n  let cluster = marker.__parent;\n  if (!cluster || cluster._zoom < zoom) {\n    return { groupId: marker._leaflet_id, latLng: marker.getLatLng() };\n  }\n  while (cluster._zoom === undefined || cluster._zoom > zoom) {\n    cluster = cluster.__parent;\n  }\n  return { groupId: cluster._leaflet_id, latLng: cluster.getLatLng() };\n}\n","import React from 'react';\nimport { useEffect, useRef, useCallback } from 'react';\nimport { LayersControl, Map, TileLayer } from 'react-leaflet';\nimport { useDispatch } from 'react-redux';\nimport './SiprojurisMap.css';\nimport { setBoundsMask } from '../../reducers/maskSlice';\nimport SipMarkerClusterGroup from './cluster/SipMarkerClusterGroup';\nimport L from 'leaflet';\nimport SipAnthPaths from './ant-path/SipAnthPaths';\nimport { HoverContext } from './HoverContext';\n\nexport const SiprojurisMap: React.FC<{ className?: string }> = function ({\n  className,\n}) {\n  const dispatch = useDispatch();\n  const defaultMarkerSet = useRef<any[]>([]);\n\n  const $map = useRef<L.Map>(null as any);\n  const handleRef = useCallback(function (dom: Map) {\n    if (!dom) return;\n    $map.current = dom.leafletElement;\n    $map.current.fitWorld();\n  }, []);\n\n  const $markerLayer = useRef<any>();\n  const handleMarkerLayerRef = useCallback(function (\n    dom: LayersControl.Overlay\n  ) {\n    if (!dom) return;\n    $markerLayer.current = dom;\n  },\n  []);\n\n  const $antPathLayer = useRef<any>();\n  const handleAntPathLayerRef = useCallback(function (\n    dom: LayersControl.Overlay\n  ) {\n    if (!dom) return;\n    $antPathLayer.current = dom;\n  },\n  []);\n\n  useEffect(() => {\n    $map.current.invalidateSize();\n\n    $map.current.on('moveend', function () {\n      const bounds = $map.current.getBounds();\n      const sw = bounds.getSouthWest();\n      const ne = bounds.getNorthEast();\n      dispatch(\n        setBoundsMask([\n          { lat: sw.lat, lng: sw.lng },\n          { lat: ne.lat, lng: ne.lng },\n        ])\n      );\n    });\n\n    $map.current.on('sip-marker', function (e: any) {\n      defaultMarkerSet.current.push(e.current);\n    });\n  }, [dispatch]);\n\n  const $hover = useRef<{ id: string | null; cancel: any | null }>({\n    id: null,\n    cancel: null,\n  });\n\n  return (\n    <div className={className}>\n      <HoverContext.Provider value={$hover}>\n        <Map\n          bounds={[\n            [48.853333, 2.348611],\n            [46.5691, 0.348203],\n          ]}\n          ref={handleRef}\n          maxZoom={15}\n        >\n          <LayersControl position=\"topright\">\n            <LayersControl.BaseLayer name=\"OpenStreetMap\">\n              <TileLayer\n                attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n                url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n              />\n            </LayersControl.BaseLayer>\n            <LayersControl.BaseLayer name=\"Esri.WorldTopoMap\">\n              <TileLayer\n                attribution=\"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community\"\n                url=\"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}\"\n              />\n            </LayersControl.BaseLayer>\n            <LayersControl.BaseLayer name=\"CartoDB.Positron\">\n              <TileLayer\n                attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>'\n                url=\"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png\"\n                subdomains=\"abcd\"\n                maxZoom={19}\n              />\n            </LayersControl.BaseLayer>\n            <LayersControl.BaseLayer checked name=\"CartoDB.Voyager\">\n              <TileLayer\n                attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>'\n                subdomains=\"abcd\"\n                maxZoom={19}\n                url=\"https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png\"\n              />\n            </LayersControl.BaseLayer>\n            <LayersControl.Overlay\n              name=\"Markers\"\n              checked\n              ref={handleMarkerLayerRef}\n            >\n              <SipMarkerClusterGroup $layer={$markerLayer} $map={$map} />\n            </LayersControl.Overlay>\n            <LayersControl.Overlay\n              ref={handleAntPathLayerRef}\n              name=\"AntPaths\"\n              checked\n            >\n              <SipAnthPaths\n                $l={$antPathLayer}\n                $map={$map}\n                defaultMarkerSet={defaultMarkerSet}\n              />\n            </LayersControl.Overlay>\n          </LayersControl>\n        </Map>\n      </HoverContext.Provider>\n    </div>\n  );\n};\n\nexport default SiprojurisMap;\n","import { useRef, useLayoutEffect, useEffect } from 'react';\nimport { select, Selection } from 'd3-selection';\nimport { transition } from 'd3-transition';\nimport loForEach from 'lodash/forEach';\nimport loKebabCase from 'lodash/kebabCase';\n/**\n * Binds datum to reference using useLayoutEffect and returns the reference\n * @param datum Datum to bind\n */\nexport function useDatum<E extends Element, Datum = any>(datum: Datum) {\n  const $dom = useRef<E>(null as any);\n  useLayoutEffect(function () {\n    // ($line.current as any).__data__ = datum; // cheating\n    const d3G = select<E, Datum>($dom.current).datum(datum);\n    return () => {\n      d3G.datum(null); // cleaning because i'm a good boy\n    };\n    // eslint-disable-next-line\n  }, []);\n\n  return $dom;\n}\n\nexport function useD3<T extends Element>(): [\n  React.MutableRefObject<T>,\n  React.MutableRefObject<Selection<T, unknown, null, undefined>>\n] {\n  const $ref = useRef<T>(null as any);\n  const d3Ref = useSelect($ref);\n  return [$ref, d3Ref];\n}\n\nexport function useSelect<T extends Element>(\n  ref: React.MutableRefObject<T>\n): React.MutableRefObject<Selection<T, unknown, null, undefined>> {\n  const d3ref = useRef(ref.current ? select(ref.current) : null!);\n\n  useLayoutEffect(() => {\n    d3ref.current = select(ref.current);\n  }, [ref]);\n\n  return d3ref;\n}\n\ntype Styled = { style?: object | string };\n\ntype Attributes<T = any> = {\n  [K in keyof T]?: number | string;\n};\n\nexport function useTransition<T extends Element>(\n  selection: React.MutableRefObject<d3.Selection<T, any, any, any>>,\n  attrs: Styled & Attributes<T>,\n  t?: d3.Transition<any, any, any, any>\n) {\n  const { style, ...attr } = attrs;\n\n  useAttrTransition(selection, attr as any, t);\n  useStyleTransition(selection, style, t);\n\n  return selection;\n}\nexport function useAttrTransition<T extends Element>(\n  selection: React.MutableRefObject<d3.Selection<T, any, any, any>>,\n  attrs?: Attributes<T>,\n  t?: d3.Transition<any, any, any, any>\n) {\n  useEffect(() => {\n    if (attrs) {\n      let copy = t;\n      if (copy === undefined) {\n        copy = transition().duration(1000);\n      }\n\n      selection.current.transition(copy).call((selection) => {\n        loForEach(attrs, (value, key) => {\n          selection.attr(loKebabCase(key), value as any);\n        });\n      });\n    }\n  }, [selection, attrs, t]);\n\n  return selection;\n}\n\nexport function useStyleTransition<T extends Element>(\n  selection: React.MutableRefObject<d3.Selection<T, any, any, any>>,\n  styles?: Styled['style'],\n  t?: d3.Transition<any, any, any, any>\n) {\n  useEffect(() => {\n    if (styles) {\n      let copy = t;\n      if (copy === undefined) {\n        copy = transition().duration(1000);\n      }\n\n      selection.current.transition(copy).call((selection) => {\n        if (typeof styles === 'string') selection.attr('style', styles);\n        else\n          loForEach(styles, (value, key) => {\n            selection.style(loKebabCase(key), value);\n          });\n        return selection;\n      });\n    }\n  }, [selection, styles, t]);\n\n  return selection;\n}\n","import { createSlice, PayloadAction, createSelector } from '@reduxjs/toolkit';\nimport { RootState } from '../../reducers';\nimport { selectDetailRelations } from './selectRelations';\nimport { Emphase } from './models';\nimport { selectRelationSelection } from './selectionSlice';\nimport { parseEmphase } from './utils/emphase';\n\nexport const highlightSlice = createSlice({\n  name: 'relation/highlight',\n  initialState: null as Emphase | null,\n  reducers: {\n    setRelationHighlight(_, action: PayloadAction<Emphase>) {\n      return action.payload;\n    },\n    clearRelationHighligh() {\n      return null;\n    },\n  },\n});\n\nexport const selectRelationHighlights = (state: RootState) =>\n  state.relationHighlight;\nexport const selectHighlightedGhosts = createSelector(\n  selectDetailRelations,\n  selectRelationHighlights,\n  parseEmphase\n);\n\nexport const selectRelationEmphasis = createSelector(\n  selectRelationSelection,\n  selectRelationHighlights,\n  (rel, high) => (rel ? rel : high)\n);\n\nexport const { setRelationHighlight, clearRelationHighligh } =\n  highlightSlice.actions;\n\nexport default highlightSlice.reducer;\n","import React, { useMemo, useCallback } from 'react';\n\nimport { LocEvents } from '../models';\nimport { useFlatClick } from '../../../hooks/useClick';\nimport useHoverHighlight from '../../../hooks/useHoverHighlight';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { setRelationSelection } from '../selectionSlice';\nimport {\n  setRelationHighlight,\n  clearRelationHighligh,\n  selectRelationEmphasis,\n} from '../highlightSlice';\nimport { flatMap } from 'lodash';\n\nexport const PiePart: React.FC<{\n  a: d3.PieArcDatum<LocEvents>;\n  arc: d3.Arc<any, d3.PieArcDatum<LocEvents>>;\n  parent: string;\n}> = function ({ arc, a, parent }) {\n  const dispatch = useDispatch();\n  const emph = useSelector(selectRelationEmphasis);\n  const [key, value] = a.data;\n\n  const interactive = useMemo(\n    () =>\n      flatMap(\n        Array.from(value.values(), (v) =>\n          v.events.map((e) => ({ id: e, kind: 'Event' }))\n        )\n      ),\n    [value]\n  );\n\n  // const { onClick, onMouseUp } = useClickSelect(interactive);\n  const hover = useHoverHighlight(interactive);\n\n  const handleClick = useCallback(\n    () => {\n      dispatch(setRelationSelection({ actor: parent, loc: key }));\n      // onClick(event);\n    },\n    // [parent, key, dispatch, onClick]\n    [parent, key, dispatch]\n  );\n\n  const handleMouseEnter = useCallback(() => {\n    dispatch(setRelationHighlight({ actor: parent, loc: key }));\n    hover.onMouseEnter();\n  }, [parent, key, hover, dispatch]);\n\n  const handleMouseLeave = useCallback(() => {\n    dispatch(clearRelationHighligh());\n    hover.onMouseLeave();\n  }, [hover, dispatch]);\n\n  const opacity =\n    (emph &&\n      (emph.loc === key ? (emph.actor === parent ? undefined : 0.6) : 0.3)) ||\n    undefined;\n\n  return (\n    <path\n      d={arc(a)!}\n      {...useFlatClick(handleClick)}\n      // onClick={handleClick}\n      // onMouseUp={onMouseUp}\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n      fillOpacity={opacity}\n      // stroke={(emph && darkgray) || undefined}\n    >\n      <title>{value.size}</title>\n    </path>\n  );\n};\n\nexport default PiePart;\n","import React, { useMemo } from 'react';\nimport * as d3 from 'd3';\nimport { useSelector } from 'react-redux';\nimport { useDatum } from '../../../hooks/useD3';\nimport { selectSwitchActorColor } from '../../../selectors/switch';\nimport { ProsoVisActor } from '../../../v2/types/actors';\nimport { LocEvents } from '../models';\nimport { selectRelationActorRing } from '../selectRelations';\nimport PiePart from './PiePart';\nimport { darkgray } from '../../../v2/components/theme';\n\nconst scale = d3.scaleSqrt().range([0, 3]);\n\nexport const RelationNode: React.FC<{\n  datum: ProsoVisActor & d3.SimulationNodeDatum;\n}> = function ({ datum }) {\n  const $g = useDatum<SVGGElement, ProsoVisActor>(datum);\n  const { locsLinks, ghosts } = useSelector(selectRelationActorRing).get(\n    datum.id\n  )!;\n\n  const color = useSelector(selectSwitchActorColor);\n\n  const arcs = useMemo(\n    () =>\n      d3\n        .pie<LocEvents>()\n        .sort(null)\n        .value(([, d]) => d.size)(Array.from(locsLinks)),\n    [locsLinks]\n  );\n\n  const arc = useMemo(\n    () =>\n      d3\n        .arc<d3.PieArcDatum<LocEvents>>()\n        .innerRadius(0)\n        .outerRadius(scale(ghosts.size)),\n    [ghosts.size]\n  );\n\n  return (\n    <g ref={$g} fill={color ? color(datum.id) : darkgray} cursor=\"pointer\">\n      <circle r={scale(ghosts.size)} fill={'white'} />\n      {arcs.map((a) => (\n        <PiePart key={a.data[0]} parent={datum.id} a={a} arc={arc} />\n      ))}\n    </g>\n  );\n};\n\nexport default RelationNode;\n","import { line, curveBundle } from 'd3-shape';\n\nconst path = line().curve(curveBundle.beta(1));\nexport default path;\n","import { createSelector } from 'reselect';\nimport {\n  selectRelationSelection,\n  selectSelectedGhosts,\n} from '../selectionSlice';\nimport { selectRelationHighlights } from '../highlightSlice';\nimport { selectHighlightedGhosts } from '../highlightSlice';\nimport { sort } from 'd3';\n\nexport const selectIntersection = createSelector(\n  selectRelationSelection,\n  selectRelationHighlights,\n  (sel, high) => {\n    if (!sel) return null;\n    return high && sel.actor === high.actor ? null : high;\n  }\n);\n\nexport const selectDisplayedRing = createSelector(\n  selectSelectedGhosts,\n  selectHighlightedGhosts,\n  (sel, high) => (sel.ghosts.size > 0 ? sel : high)\n);\n\nexport const selectDisplayedActorRingLinks = createSelector(\n  selectDisplayedRing,\n  ({ actorRingLinks }) => actorRingLinks\n);\nexport const selectDisplayedRingLinks = createSelector(\n  selectDisplayedRing,\n  ({ ringLinks }) => ringLinks\n);\nexport const selectDisplayedGhosts = createSelector(\n  selectDisplayedRing,\n  ({ ghosts }) => ghosts\n);\n\nexport const selectSortedGhosts = createSelector(\n  selectDisplayedGhosts,\n  (ghosts) =>\n    sort(\n      ghosts.values(),\n      (g) => g.order,\n      (g) => g.weight\n    )\n);\n","import React, { useCallback, useMemo, useState } from 'react';\nimport { PlusIcon } from '@primer/octicons-react';\nimport * as d3 from 'd3';\nimport { identity } from 'lodash';\nimport { concat, groupBy, keyBy, map, mapValues, pipe } from 'lodash/fp';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { createSelector } from 'reselect';\nimport styled from 'styled-components/macro';\nimport { useFlatClick } from '../../../hooks/useClick';\nimport { tryAddDetailActorThunk } from '../../../v2/thunks/actors';\nimport { ProsoVisSignedRelation } from '../../../v2/types/relations';\nimport Modal from '../../modal/Modal';\nimport { selectRelationGhosts } from '../selectRelations';\nimport {\n  selectDisplayedActorRingLinks,\n  selectIntersection,\n  selectSortedGhosts,\n} from './selectors';\nimport { darkgray } from '../../../v2/components/theme';\n\nconst selectGroups = createSelector(\n  selectSortedGhosts,\n  selectDisplayedActorRingLinks,\n  (sorted, links) =>\n    pipe(\n      Array.from as (v: any) => ProsoVisSignedRelation[],\n      concat(sorted),\n      groupBy<ProsoVisSignedRelation>('target'),\n      mapValues(pipe(map('source'), keyBy(identity)))\n    )(links.values())\n  // _(Array.from(links.values()))\n  //   .concat(sorted)\n  //   .groupBy('target')\n  //   .mapValues((links) => _(links).map('source').keyBy().value())\n  //   .value()\n);\n\nexport const SuggestionNodes: React.FC<{\n  $g?: React.MutableRefObject<SVGGElement>;\n  color: string | null | undefined;\n  x: (v: string) => number;\n}> = function ({ $g, color, x }) {\n  const sorted = useSelector(selectSortedGhosts);\n\n  const y = useMemo(() => {\n    const domain = d3.extent(sorted, (s) => s.weight) as [number, number];\n    return d3.scaleLog().domain(domain).range([1, 20]);\n  }, [sorted]);\n\n  const grouped = useSelector(selectGroups);\n\n  return (\n    <g ref={$g} fill={color ?? darkgray}>\n      {sorted.map((datum) => (\n        <SuggestionNode\n          key={datum.target}\n          datum={datum}\n          x={x}\n          y={y}\n          actors={grouped[datum.target]}\n          color={color || darkgray}\n        />\n      ))}\n    </g>\n  );\n};\n\nexport const SuggestionNode: React.FC<{\n  actors: _.Dictionary<string>;\n  datum: ProsoVisSignedRelation;\n  x: (value: string) => number;\n  y: d3.ScaleLogarithmic<number, number>;\n  color: string;\n}> = function ({ actors, datum, x, y, color }) {\n  const ghosts = useSelector(selectRelationGhosts);\n  const dispatch = useDispatch();\n\n  const active = useSelector(selectIntersection);\n\n  const [showModal, setShow] = useState({ show: false, x: 0, y: 0 });\n\n  const { onClick, onMouseUp } = useFlatClick((e) => {\n    dispatch(tryAddDetailActorThunk(datum.target));\n  });\n\n  const handleMouseEnter = useCallback(\n    (e: React.MouseEvent<Element, MouseEvent>) => {\n      const parent: SVGGElement = (e.target as any).parentNode;\n      const { top, height, left } = parent\n        .querySelector('circle')!\n        .getBoundingClientRect();\n      setShow({ show: true, x: left, y: top + height / 2 });\n    },\n    []\n  );\n\n  const handleMouseLeave = useCallback(\n    (e: React.MouseEvent<Element, MouseEvent>) => {\n      setShow({ show: false, x: 0, y: 0 });\n    },\n    []\n  );\n\n  return (\n    <g\n      style={{\n        transform: `rotate(${\n          (x(datum.target) * 180) / Math.PI\n        }deg) translate3d(200px, 0, 0)`,\n      }}\n      opacity={active ? (actors[active.actor] ? 1 : 0.3) : undefined}\n      onMouseUp={onMouseUp}\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n    >\n      <circle r={5} />\n      <rect x={6} y={-2.5} height={5} width={y(datum.weight)}></rect>\n      {showModal.show && (\n        <g onClick={onClick}>\n          <Modal>\n            <SuggestionPopup\n              x={showModal.x}\n              y={showModal.y}\n              color={color}\n              label={ghosts.get(datum.target)?.label}\n            />\n          </Modal>\n        </g>\n      )}\n      <title>{ghosts.get(datum.target)?.label}</title>\n    </g>\n  );\n};\n\nconst AbsoluteDiv = styled.div`\n  z-index: 9999;\n  border-radius: 500px;\n  position: absolute;\n  color: white;\n  background-color: white;\n  cursor: pointer;\n`;\nconst StyledDiv = styled.div`\n  height: 20px;\n  border-radius: 500px;\n  padding-right: 0.5em;\n  padding-left: 4px;\n  padding-top: 2px;\n  line-height: 1;\n  display: flex;\n`;\n\nexport const SuggestionPopup: React.FC<any> = function ({\n  x,\n  y,\n  color,\n  label,\n}) {\n  // const activeActors = useSelector(selectActors);\n  return (\n    <AbsoluteDiv\n      style={{\n        left: x - 5,\n        top: y - 10,\n      }}\n    >\n      <StyledDiv\n        style={{\n          backgroundColor: d3.color(color)?.darker().toString(),\n        }}\n      >\n        <PlusIcon />\n        <span style={{ marginLeft: '2px' }}>{label}</span>\n        {/* {_.map(activeActors, (a) => (\n        <ActorLine actor={a} />\n      ))} */}\n      </StyledDiv>\n    </AbsoluteDiv>\n  );\n};\n\nexport default SuggestionNode;\n","const ROUND_PRECISION = -14;\n\ntype PolarVector = {\n  length: number;\n  theta: number;\n};\n\ntype CartesianVector = {\n  x: number;\n  y: number;\n};\n\nexport function magnitude(vector: CartesianVector): number {\n  return Math.hypot(vector.x, vector.y);\n}\n\nexport function toCartesian(\n  vector: PolarVector,\n  precision: number = ROUND_PRECISION\n): CartesianVector {\n  return {\n    x: round(vector.length * Math.cos(vector.theta), precision),\n    y: round(vector.length * Math.sin(vector.theta), precision),\n  };\n}\n\nexport function toPolar(\n  vector: CartesianVector,\n  precision: number = ROUND_PRECISION\n): PolarVector {\n  let rad = Math.atan2(vector.y, vector.x);\n  if (rad < 0) {\n    rad = rad + 2 * Math.PI;\n  }\n  return {\n    length: magnitude(vector),\n    theta: rad,\n  };\n}\n\nexport function round(number: number, precision: number = 0): number {\n  const multiplier = Math.pow(10, -precision);\n  return Math.round(number * multiplier) / multiplier;\n}\n","import React, { useEffect, useMemo } from 'react';\nimport { select } from 'd3';\nimport { map } from 'lodash';\nimport {\n  chunk,\n  flatMap,\n  groupBy,\n  keyBy,\n  map as fpmap,\n  meanBy,\n  pipe,\n  transform,\n} from 'lodash/fp';\nimport { useSelector } from 'react-redux';\nimport { createSelector } from 'reselect';\nimport { useDatum } from '../../../hooks/useD3';\nimport { selectSwitchActorColor } from '../../../selectors/switch';\nimport { toCartesian } from '../../../utils';\nimport { ProsoVisSignedRelation } from '../../../v2/types/relations';\nimport {\n  selectDisplayedActorRingLinks,\n  selectIntersection,\n  selectSortedGhosts,\n} from './selectors';\nimport { disabled } from '../../../v2/components/theme';\n\nexport const selectClusteredSuggestionActorLinks = createSelector(\n  selectDisplayedActorRingLinks,\n  selectSortedGhosts,\n  function (links, sorted) {\n    const quarter = Math.floor(sorted.length / 4);\n    const targets = map(sorted, 'target');\n\n    const clusters: ProsoVisSignedRelation[][] = pipe(\n      groupBy<ProsoVisSignedRelation>('source'),\n      flatMap((byActor: ProsoVisSignedRelation[]) => {\n        const ordered = keyBy('target', byActor);\n        const clusters = pipe(\n          fpmap((i: string) => ordered[i]),\n          transform(\n            (acc, v) => {\n              if (v) {\n                acc[acc.length - 1].push(v);\n              } else {\n                if (acc[acc.length - 1].length > 0) acc.push([]);\n              }\n            },\n            [[]] as ProsoVisSignedRelation[][]\n          )\n        )(targets);\n\n        if (clusters[clusters.length - 1].length === 0) {\n          clusters.pop();\n        }\n\n        return flatMap(\n          (v) =>\n            v.length <= quarter + Math.ceil(quarter / 4)\n              ? [v]\n              : chunk(quarter, v),\n          clusters\n        );\n      })\n    )(Array.from(links.values()));\n\n    return clusters;\n  }\n);\n\nexport const SuggestionActorLinks: React.FC<{\n  $g?: React.MutableRefObject<SVGGElement>;\n  x: (v: string) => number;\n}> = function ({ $g, x }) {\n  const clusters = useSelector(selectClusteredSuggestionActorLinks);\n\n  return (\n    <g ref={$g} stroke={disabled} strokeWidth={1.5} fill=\"none\">\n      {flatMap((cluster) => {\n        const coordinates = cluster.map((datum) => ({\n          theta: x(datum.target),\n          length: 200,\n        }));\n\n        const toCart = (coordinate: { theta: number; length: number }) => {\n          const { x: x1, y: y1 } = toCartesian(coordinate);\n          return [x1, y1] as [number, number];\n        };\n\n        return cluster.map((re, i) => (\n          <SuggestionActorLink\n            key={re.id}\n            datum={re}\n            cluster={\n              cluster.length > 1\n                ? toCart({ theta: meanBy('theta', coordinates), length: 190 })\n                : undefined\n            }\n            suggestion={toCart(coordinates[i])}\n          />\n        ));\n      }, clusters)}\n      {/* {Array.from(links, ([key, datum]) => (\n        <SuggestionActorLink key={key} datum={datum} x={x} />\n      ))} */}\n    </g>\n  );\n};\n\nexport const SuggestionActorLink: React.FC<{\n  datum: ProsoVisSignedRelation;\n  suggestion: [number, number];\n  cluster?: [number, number];\n}> = function ({ datum, suggestion, cluster }) {\n  // const nodes = useSelector(selectRelationNodes);\n\n  // mutable values, cannot be memoized\n  // const { x, y }: { x: number; y: number } = nodes.get(datum.source)! as any;\n  const points: [number, number][] = useMemo(\n    // () => (cluster ? [[x, y], cluster, suggestion] : [[x, y], suggestion]),\n    // [x, y, cluster, suggestion]\n    () => (cluster ? [cluster, suggestion] : [suggestion]),\n    [cluster, suggestion]\n  );\n\n  // const kvDatum = useMemo(() => [datum, points.slice(1)], [datum, points]);\n  const kvDatum = useMemo(() => [datum, points], [datum, points]);\n\n  const $path = useDatum<SVGPathElement>(kvDatum);\n\n  // if link persists\n  useEffect(() => {\n    if (!$path.current) return;\n    select($path.current).datum(kvDatum);\n  }, [$path, kvDatum]);\n\n  const color = useSelector(selectSwitchActorColor);\n\n  const active = useSelector(selectIntersection);\n\n  return (\n    <path\n      ref={$path}\n      // d={path(points)!}\n      style={{ mixBlendMode: 'multiply' }}\n      stroke={color ? color(datum.source) : undefined}\n      opacity={!active ? 1 : active.actor === datum.source ? 1 : 0.3}\n      // fill=\"none\"\n      // stroke=\"#ccc\"\n    />\n  );\n};\n\nexport default SuggestionActorLink;\n","import React from 'react';\nimport { toCartesian } from '../../../utils';\nimport { useDatum } from '../../../hooks/useD3';\nimport path from './path';\nimport { ProsoVisSignedRelation } from '../../../v2/types/relations';\n\nexport const SuggestionLinks: React.FC<{\n  $g?: React.MutableRefObject<SVGGElement>;\n  x: (value: string) => number;\n}> = function ({ $g, x }) {\n  // const links = useSelector(selectDisplayedRingLinks);\n\n  return (\n    <g ref={$g} stroke=\"#bbb\" fill=\"none\">\n      {Array.from([], ([key, datum]) => (\n        <SuggestionLink key={key} datum={datum} x={x} />\n      ))}\n    </g>\n  );\n};\n\nexport const SuggestionLink: React.FC<{\n  datum: ProsoVisSignedRelation;\n  x: (value: string) => number;\n}> = function ({ datum, x }) {\n  // const { locLinks } = useSelector(selectRelations);\n  // const activeRelation = useSelector(selectRelationSelection);\n\n  // const nodes = useSelector(selectRelationNodes);\n\n  const $line = useDatum<SVGPathElement>(datum);\n\n  const { x: x1, y: y1 } = toCartesian({\n    theta: x(datum.target),\n    length: 200,\n  });\n\n  const { x: x2, y: y2 } = toCartesian({\n    theta: x(datum.source),\n    length: 200,\n  });\n\n  return (\n    <path\n      ref={$line}\n      d={\n        path([\n          [x1, y1],\n          [0, 0],\n          [x2, y2],\n        ])!\n      }\n      style={{ mixBlendMode: 'multiply' }}\n      // fill=\"none\"\n      // stroke=\"#ccc\"\n    />\n  );\n};\n\nexport default SuggestionLink;\n","import React, { useEffect } from 'react';\nimport { SuggestionNodes } from './SuggestionNode';\nimport { scaleBand } from 'd3-scale';\nimport { SuggestionActorLinks } from './SuggestionActorLink';\nimport { SuggestionLinks } from './SuggestionLink';\n\nimport { useSelector } from 'react-redux';\nimport { createSelector } from 'reselect';\nimport { selectRelationEmphasis } from '../highlightSlice';\nimport { selectSwitchActorColor } from '../../../selectors/switch';\nimport { selectSortedGhosts, selectDisplayedActorRingLinks } from './selectors';\nimport { map } from 'lodash/fp';\n\nconst selectActiveActorColor = createSelector(\n  selectSwitchActorColor,\n  selectRelationEmphasis,\n  (color, emph) => {\n    if (!color) return null;\n    if (emph) return color(emph.actor);\n  }\n);\n\nconst xBand = scaleBand<string>().range([0, 2 * Math.PI]);\n\nconst x = (value: string) => xBand(value)! + (xBand.bandwidth() - Math.PI) / 2;\n\nexport const SuggestionRing: React.FC<{\n  $nodes?: React.MutableRefObject<SVGGElement>;\n  $links?: React.MutableRefObject<SVGGElement>;\n  updateLinkPosition: React.MutableRefObject<{\n    nodes: () => void;\n    links: () => void;\n    ringLinks: () => void;\n  }>;\n}> = function ({\n  $links,\n  updateLinkPosition,\n  //   ghosts: { actorRingLinks, ghosts, ringLinks },\n}) {\n  const color = useSelector(selectActiveActorColor);\n\n  const sorted = useSelector(selectSortedGhosts);\n  xBand.domain(map('target', sorted));\n\n  const actorRingLinks = useSelector(selectDisplayedActorRingLinks);\n  useEffect(() => {\n    if (updateLinkPosition.current) updateLinkPosition.current.ringLinks();\n  }, [actorRingLinks, updateLinkPosition]);\n\n  return (\n    <g>\n      <SuggestionLinks x={x} />\n      <SuggestionActorLinks $g={$links} x={x} />\n      <SuggestionNodes /*$g={$nodes}*/ color={color} x={x} />\n    </g>\n  );\n};\n\nexport default SuggestionRing;\n","import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport * as d3 from 'd3';\nimport { debounce, transform } from 'lodash/fp';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useDatum } from '../../hooks/useD3';\nimport { selectLocalisations } from '../../v2/selectors/localisations';\nimport { selectRelationEmphasis } from './highlightSlice';\nimport RelationNode from './node/RelationNode';\nimport { clearRelationSelection } from './selectionSlice';\nimport { selectRelationLinks, selectRelationNodes } from './selectRelations';\nimport path from './suggestion-ring/path';\nimport SuggestionRing from './suggestion-ring/SuggestionRing';\nimport { getSimulation } from './utils/simulation';\nimport { darkgray } from '../../v2/components/theme';\n\nfunction useDimensions() {\n  const [dims, setDims] = useState<DOMRect>();\n  const $svg = useCallback(function (dom: SVGSVGElement | null) {\n    if (!dom) return;\n    const handleResize = debounce(100, function () {\n      setDims(dom.getBoundingClientRect());\n    });\n\n    window.addEventListener('resize', handleResize);\n    handleResize();\n\n    return function () {\n      window.removeEventListener('resize', handleResize);\n    };\n  }, []);\n  return { dims, $svg };\n}\n\nconst simulation = getSimulation((d: any) => d.id);\n\nconst Relation: React.FC<{ className?: string }> = function ({ className }) {\n  const dispatch = useDispatch();\n\n  const $nodeGroup = useRef<SVGGElement>(null as any);\n  const $linkGroup = useRef<SVGGElement>(null as any);\n  // const $ghostRing = useRef<SVGGElement>(null as any);\n  const $ringLinksGroup = useRef<SVGGElement>(null as any);\n\n  const { dims, $svg } = useDimensions();\n\n  const nodes = useSelector(selectRelationNodes);\n  const links = useSelector(selectRelationLinks);\n\n  const updateRef = useRef<{\n    nodes: () => void;\n    links: () => void;\n    ringLinks: () => void;\n  }>(null as any);\n\n  useEffect(function () {\n    simulation.on('tick', ticked);\n\n    const $links = $linkGroup.current.childNodes;\n    const $nodes = $nodeGroup.current.childNodes;\n    const $ringLinks = $ringLinksGroup.current.childNodes;\n\n    let link: any = d3.selectAll($links as any);\n    let node = d3.selectAll<SVGGElement, d3.SimulationNodeDatum>($nodes as any);\n    let ringLink = d3.selectAll($ringLinks as any);\n\n    let nodeMap = new Map();\n\n    updateRef.current = {\n      nodes: function () {\n        node = d3.selectAll<SVGGElement, d3.SimulationNodeDatum>($nodes as any);\n        nodeMap = transform(\n          (m, n: any) => m.set(n.id!, n),\n          new Map(),\n          node.data()\n        );\n        simulation.nodes(node.data());\n        simulation.alpha(1).restart();\n      },\n\n      links: function () {\n        link = d3.selectAll($links as any);\n        (\n          simulation.force('link') as d3.ForceLink<\n            d3.SimulationNodeDatum,\n            d3.SimulationLinkDatum<d3.SimulationNodeDatum>\n          >\n        ).links(link.data());\n        simulation.alpha(1).restart();\n      },\n      ringLinks: function () {\n        ringLink = d3.selectAll($ringLinks as any);\n        ringLink.attr('d', ([d, points]: any) => {\n          if (nodeMap.has(d.source)) {\n            const { x = 0, y = 0 } = nodeMap.get(d.source) as any;\n            return path([[x, y], ...points]);\n          }\n          return '';\n        });\n      },\n    };\n\n    function ticked() {\n      // node.attr('transform', (d: any) => `translate(${d.x}, ${d.y}, 0)`);\n      node.style('transform', (d: any) => `translate3d(${d.x}px, ${d.y}px, 0)`);\n\n      link\n        .attr('x1', (d: any) => d.source.x)\n        .attr('y1', (d: any) => d.source.y)\n        .attr('x2', (d: any) => d.target.x)\n        .attr('y2', (d: any) => d.target.y);\n\n      ringLink.attr('d', (pair?: any) => {\n        if (pair === undefined) return ''; // solves a bug when sometimes the user will move the mouse too fast causing it to unregister before layout refresh, still registering the action but invalidating the datum associated to this items.\n\n        const [d, points] = pair;\n        if (nodeMap.has(d.source)) {\n          const { x = 0, y = 0 } = nodeMap.get(d.source) as any;\n          return path([[x, y], ...points]);\n        }\n        return '';\n      });\n      // .attr('y2', (d: any) => (nodeMap.get(d.source) as any)!.y);\n    }\n\n    return () => {\n      // if the graph is reredered kill the simulation\n      simulation.stop();\n    };\n  }, []);\n\n  useEffect(() => {\n    updateRef.current.nodes();\n  }, [nodes]);\n\n  useEffect(() => {\n    updateRef.current.links();\n  }, [links]);\n\n  const handleAwayClick = useCallback(\n    () => dispatch(clearRelationSelection()),\n    [dispatch]\n  );\n\n  return (\n    <svg\n      className={className}\n      ref={$svg}\n      width=\"100%\"\n      height=\"100%\"\n      viewBox={\n        dims &&\n        `${-dims.width / 2},${-dims.height / 2},${dims.width},${dims.height}`\n      }\n      onMouseUp={handleAwayClick}\n    >\n      <PlaceText offset={dims} />\n      <SuggestionRing\n        /*$nodes={$ghostRing}*/\n        $links={$ringLinksGroup}\n        updateLinkPosition={updateRef}\n      />\n\n      <g ref={$linkGroup} stroke={darkgray} strokeWidth={1.5}>\n        {useMemo(\n          () =>\n            Array.from(links, ([key, datum]) => (\n              <RelationLink key={key} datum={datum} />\n            )),\n          [links]\n        )}\n      </g>\n      <g ref={$nodeGroup} stroke=\"#fff\" strokeWidth={1.5}>\n        {useMemo(\n          () =>\n            Array.from(nodes, ([key, datum]) => (\n              <RelationNode key={key} datum={datum} />\n            )),\n          [nodes]\n        )}\n      </g>\n    </svg>\n  );\n};\n\nexport const PlaceText: React.FC<any> = function ({ offset }) {\n  const emph = useSelector(selectRelationEmphasis);\n  const localisations = useSelector(selectLocalisations) ?? {};\n\n  return (\n    <text\n      x={offset && -offset.width / 2}\n      y={offset && 32 - offset.height / 2}\n      fontSize=\"1em\"\n    >\n      {emph && localisations[emph.loc]?.label}\n    </text>\n  );\n};\n\nexport const RelationLink: React.FC<any> = function ({ datum }) {\n  // on first render\n  const $line = useDatum<SVGLineElement>(datum);\n\n  return <line ref={$line}></line>;\n};\n\nexport default Relation;\n","import * as d3 from 'd3-force';\n\nexport function getSimulation(getId: (d: any) => any) {\n  return (\n    d3\n      .forceSimulation()\n      .force('charge', d3.forceManyBody().strength(-300))\n      .force('link', d3.forceLink().id(getId).distance(100))\n      // .force('center', d3.forceCenter())\n      .force('x', d3.forceX())\n      .force('y', d3.forceY())\n  );\n}\n","import { useCallback, useRef, useState } from 'react';\nimport $ from 'jquery';\nimport 'popper.js';\nimport 'bootstrap';\nimport { Nullable } from '../../v2/types/utils';\nimport * as vis from 'vis-timeline/peer';\n\nfunction refNotNull<T>(f: (dom: T) => any) {\n  return function (dom: Nullable<T>) {\n    if (!dom) return;\n    return f(dom);\n  };\n}\n\nconst options = {\n  max: '2000-01-01', //Maximum date of timeline\n  min: '1700-01-01', // Minimum date of timeline,\n  multiselect: false, // Allow to select multiples items\n  selectable: false,\n  stack: true, // Stack items\n  showTooltips: false,\n  width: '100%',\n  height: '300px',\n  margin: {\n    item: {\n      horizontal: 3, // distance\n      vertical: 1,\n    },\n  },\n  orientation: { item: 'top' },\n  dataAttributes: [\n    // attributes of html balise div\n    'id',\n    'start',\n    'end',\n    'group',\n    'title',\n    'label',\n    'popover',\n  ],\n  verticalScroll: true,\n  horizontalScroll: true,\n};\n\nexport function useReferences() {\n  const [timeline, setTimeline] = useState<{\n    dom: HTMLDivElement;\n    vis: vis.Timeline;\n  }>();\n\n  const $events = useRef<HTMLCollectionOf<HTMLDivElement>>();\n\n  return {\n    $events,\n\n    timeline,\n    // eslint-disable-next-line\n    timelineRef: useCallback(\n      refNotNull(function (dom: HTMLDivElement) {\n        // put timeline logic here\n        // let observer = new MutationObserver(() => {\n        //   dom.querySelectorAll(`[data-popover=\"true\"]`).forEach((v) => {\n        //     console.log(dom);\n\n        //     const $tooltip = document.createElement('div');\n        //     $tooltip.innerHTML = v.getAttribute('date-label') || '';\n        //     createPopper(v, $tooltip, { placement: 'top' });\n        //   });\n        // });\n\n        // observer.observe(dom, { childList: true, subtree: true });\n\n        // TODO change this :(\n        $(dom).popover({\n          selector: '[data-popover=\"true\"]',\n          trigger: 'hover',\n          placement: 'top',\n          content: function () {\n            return this.getAttribute('data-label') || '';\n          },\n        });\n\n        $events.current = dom.getElementsByClassName('timeline-event') as any;\n\n        const visTimeline = new vis.Timeline(dom, [], [], options);\n        visTimeline.addCustomTime(undefined as any, 'a');\n        visTimeline.addCustomTime(undefined as any, 'b');\n        setTimeline({\n          vis: visTimeline,\n          dom,\n        });\n      }),\n      // eslint-disable-next-line\n      []\n    ),\n  };\n}\n","import { flow, groupBy, map, sortBy, get, concat, orderBy } from 'lodash/fp';\nimport { createSelector } from 'reselect';\nimport { maskedEventsAsMap } from '../../../selectors/mask';\nimport { selectionAsMap } from '../../../selectors/selection';\nimport { superHighlightAsMap } from '../../../selectors/superHighlights';\nimport { selectDetailsRichEvents } from '../../selectors/detail/actors';\nimport { ProsoVisDetailRichEvent } from '../../types/events';\nimport { ProsoVisPlace } from '../../types/localisations';\nimport {\n  InformationActorGroup,\n  InformationGroup,\n  InformationPlaceGroup,\n  Interactive,\n} from './types';\n\nexport const unknownLocalisation: ProsoVisPlace = {\n  kind: 'Place',\n  id: '-1',\n  label: 'Inconnue',\n  uri: 'unknown',\n  lat: null,\n  lng: null,\n};\n\nconst selectInformationEvents = createSelector(\n  selectDetailsRichEvents,\n  selectionAsMap,\n  maskedEventsAsMap,\n  superHighlightAsMap,\n  function (events, selected, masked, highlighted) {\n    return flow(\n      map((e: ProsoVisDetailRichEvent) => ({\n        ...e,\n        highlighted: highlighted[e.event.id] !== undefined,\n        selected: selected[e.event.id] !== undefined,\n        masked: masked[e.event.id] === undefined,\n      })),\n      sortBy<Interactive<ProsoVisDetailRichEvent>>('event.datation[0].value')\n    )(events);\n  }\n);\n\nexport const selectInformationGroups = createSelector(\n  selectInformationEvents,\n  function (events) {\n    const actorGroups = flow(\n      groupBy<Interactive<ProsoVisDetailRichEvent>>('actor.id'),\n      map(\n        (events) =>\n          ({\n            kind: 'ActorNote',\n            group: get('0.actor', events),\n            events,\n            highlighted: events.some((v) => v.highlighted),\n            selected: events.some((v) => v.selected),\n            masked: !events.some((v) => !v.masked),\n          } as Interactive<InformationActorGroup>)\n      )\n    )(events);\n    const localisationGroups = flow(\n      groupBy<Interactive<ProsoVisDetailRichEvent>>('place.id'),\n      map(\n        (events) =>\n          ({\n            kind: 'PlaceNote',\n            group: get('0.place', events) ?? unknownLocalisation,\n            events,\n            highlighted: events.some((v) => v.highlighted),\n            selected: events.some((v) => v.selected),\n            masked: !events.some((v) => !v.masked),\n          } as Interactive<InformationPlaceGroup>)\n      )\n    )(events);\n\n    return flow(\n      orderBy<Interactive<InformationGroup>>(\n        ['selected', 'kind', ' events.0.event.datation.0.value'],\n        ['desc']\n      ),\n      sortBy((e: Interactive<InformationGroup>) =>\n        e.group.id === '-1' ? 1 : 0\n      ),\n      groupBy<Interactive<InformationGroup>>((e) =>\n        e.masked === true ? 'yes' : 'no'\n      )\n    )(concat(actorGroups, localisationGroups)) as {\n      yes: Interactive<InformationGroup>[];\n      no: Interactive<InformationGroup>[];\n    };\n  }\n);\n","import { createSlice, PayloadAction, createSelector } from '@reduxjs/toolkit';\nimport { RootState } from '../../reducers';\nimport { selectMaskedEvents } from '../../selectors/mask';\nimport { ProsoVisActor } from '../../v2/types/actors';\nimport { ProsoVisDetailRichEvent, ProsoVisEvent } from '../../v2/types/events';\nimport { map, pipe, uniqBy } from 'lodash/fp';\nimport { unknownLocalisation } from '../../v2/detail/information/useGroups';\nimport { InformationGroup } from '../../v2/detail/information/types';\nimport { getActorLabel } from '../../components/ActorLabel';\n\nconst timelineGroupSlice = createSlice({\n  name: 'timelineGroup',\n  initialState: 'Actor' as InformationGroup['kind'],\n  reducers: {\n    setGroup(_state, action: PayloadAction<InformationGroup['kind']>) {\n      return action.payload;\n    },\n  },\n});\n\nexport const { setGroup } = timelineGroupSlice.actions;\n\nexport default timelineGroupSlice.reducer;\n\nexport const selectTimelineGroup = (state: RootState) => state.timelineGroup;\n\nexport const selectTimelineEventGroups = createSelector(\n  selectTimelineGroup,\n  selectMaskedEvents,\n  (grouping, events) => {\n    switch (grouping) {\n      case 'ActorNote':\n        return pipe(\n          uniqBy<ProsoVisDetailRichEvent>('actor.id'),\n          map('actor'),\n          map(\n            ({ ...d }) =>\n              ({ ...d, label: getActorLabel(d, true) } as ProsoVisActor)\n          )\n        )(events);\n      case 'PlaceNote':\n        return pipe(\n          uniqBy<ProsoVisDetailRichEvent>((e) => e.localisation?.id ?? '-1'),\n          map((e) => e.localisation ?? unknownLocalisation)\n        )(events);\n    }\n  }\n);\n\nfunction groupByActor(e: ProsoVisEvent) {\n  return e.actor;\n}\n\nfunction groupByPlace(e: ProsoVisEvent) {\n  const loc = e.localisation;\n  return loc ? loc : unknownLocalisation.id;\n}\n\nexport const selectTimelineGroupBy = createSelector(\n  selectTimelineGroup,\n  (grouping) => {\n    // console.log(grouping);\n    switch (grouping) {\n      case 'ActorNote':\n        return groupByActor;\n      case 'PlaceNote':\n        return groupByPlace;\n    }\n  }\n);\n","export const ContextOptions = {\n  margin: {\n    top: 10,\n    right: 20,\n    bottom: 20,\n    left: 20,\n    view: {\n      left: 20,\n      right: 18,\n      top: 15,\n      bottom: 15\n    },\n    mask: {\n      left: 20,\n      right: 18,\n      top: 0,\n      bottom: 0\n    }\n  },\n  width: '100%',\n  height: 70\n};\n\nexport default ContextOptions;\n","import React, { useEffect, useRef, useCallback } from 'react';\nimport * as d3 from 'd3';\nimport ContextOptions from './ContextOptions';\nimport { pointer } from 'd3-selection';\n\ntype ViewReference = {\n  dom: SVGGElement;\n  selection: d3.Selection<SVGGElement, unknown, null, undefined>;\n  brush: d3.BrushBehavior<unknown>;\n};\n\nexport const ContextViewBrush: React.FC<{\n  x: d3.ScaleTime<number, number>;\n  width: number;\n  onBrush: (start: Date, end: Date) => void;\n  sync?: [Date, Date];\n}> = function ({ width, x, onBrush, sync }) {\n  // ! assuming that ref is instantaneously populated\n  const view = useRef<ViewReference>(null as any);\n  const handleRef = useCallback(function (dom: SVGGElement | null) {\n    if (!dom) return;\n    const brush = d3.brushX();\n    const selection = d3.select(dom).call(brush);\n    view.current = { dom, selection, brush };\n  }, []);\n\n  // sync width\n  useEffect(\n    function () {\n      const { brush, selection } = view.current;\n\n      brush.extent([\n        [ContextOptions.margin.view.left, ContextOptions.margin.view.top],\n        [\n          width - ContextOptions.margin.view.right,\n          ContextOptions.height - ContextOptions.margin.view.bottom,\n        ],\n      ]);\n      selection.call(brush);\n    },\n    [width]\n  );\n\n  // update brush position\n  useEffect(\n    function () {\n      if (!sync) return;\n      const { brush, selection } = view.current;\n\n      selection.call(brush.move, sync.map(x));\n    },\n    [sync, x]\n  );\n\n  // notify when brush is moved\n  useEffect(\n    function () {\n      const { brush } = view.current;\n\n      brush.on('brush', function (event: any) {\n        if (event.sourceEvent && event.selection) {\n          const [start, end] = event.selection.map(x.invert);\n          onBrush(start, end);\n        }\n      });\n    },\n    [onBrush, x]\n  );\n\n  // Allows the window to be teleported when clicking on the context\n  useEffect(\n    function () {\n      view.current.selection.call(function (g) {\n        g.select('.overlay')\n          .datum({ type: 'selection' })\n          .on('mousedown touchstart', function (event) {\n            const { brush, dom, selection } = view.current;\n\n            const brushSelection = d3.brushSelection(dom) as\n              | [number, number]\n              | null;\n            if (!brushSelection) return;\n\n            const [start, end] = brushSelection;\n            const dx = end - start;\n            const [cx] = pointer(event);\n            const [x0, x1] = [cx - dx / 2, cx + dx / 2];\n            const [X0, X1] = x.range();\n\n            selection.call(\n              brush.move,\n              x1 > X1 ? [X1 - dx, X1] : x0 < X0 ? [X0, X0 + dx] : [x0, x1]\n            );\n          });\n      });\n    },\n    [x]\n  );\n  return <g id=\"context-window\" className=\"brush\" ref={handleRef}></g>;\n};\n\nexport default ContextViewBrush;\n","import React, { useMemo } from 'react';\nimport * as d3 from 'd3';\nimport { useSelector } from 'react-redux';\nimport { selectSwitchColor } from '../../selectors/switch';\nimport { StackedChart } from '../../v2/global/timeline/StackedChart';\nimport ContextOptions from './ContextOptions';\nimport { selectStack } from './Context';\n\nexport const ContextStackedChart: React.FC<{\n  x: d3.ScaleTime<number, number>;\n}> = function ({ x }) {\n  const stack = useSelector(selectStack);\n  const color = useSelector(selectSwitchColor);\n\n  const y = useMemo(\n    function () {\n      return (\n        d3\n          .scalePow()\n          .domain([\n            d3.min(stack, (d) => d3.min(d, (d) => d[0])) as any,\n            d3.max(stack, (d) => d3.max(d, (d) => d[1])) as any,\n          ])\n          // .nice()\n          .range([\n            ContextOptions.height - ContextOptions.margin.bottom,\n            ContextOptions.margin.top,\n          ])\n      );\n    },\n    [stack]\n  );\n\n  return (\n    <StackedChart\n      x={x}\n      y={y}\n      stack={stack}\n      color={color}\n      curve={d3.curveStep}\n    />\n  );\n};\n","import React, { useMemo } from 'react';\nimport * as d3 from 'd3';\nimport { parseISO } from 'date-fns';\nimport { createSelector } from 'reselect';\nimport {\n  selectDefaultGroupBy,\n  selectSwitchIsActor,\n} from '../../selectors/switch';\nimport { Axis } from '../../v2/components/Axis';\nimport BrushX from '../../v2/components/brush/BrushX';\nimport { fillEmpty, flatten, Tyvent } from '../../v2/global/timeline/selectors';\nimport {\n  selectDetailActorIds,\n  selectDetailsRichEvents,\n} from '../../v2/selectors/detail/actors';\nimport { selectCustomFilterDefaultValues } from '../../v2/selectors/mask/customFilter';\nimport ContextOptions from './ContextOptions';\nimport ContextViewBrush from './ContextViewBrush';\nimport { ContextStackedChart } from './ContextStackedChart';\n\n// todo date extract this\nconst options = {\n  max: parseISO('2000-01-01'), //Maximum date of timeline\n  min: parseISO('1700-01-01'), // Minimum date of timeline\n};\n\nexport const selectStack = createSelector(\n  selectDetailsRichEvents,\n  selectDefaultGroupBy,\n  selectSwitchIsActor,\n  selectDetailActorIds,\n  selectCustomFilterDefaultValues,\n  (events, path, switcher, actors, filters) => {\n    const filled = fillEmpty(events, path);\n    const flattened = flatten(filled);\n    return d3\n      .stack<any, Tyvent<_.Dictionary<number>>, string>()\n      .keys(switcher ? actors : filters)\n      .order(d3.stackOrderInsideOut)\n      .value((d, k) => d.value[k] || 0)(flattened);\n  }\n);\n\nexport const Context: React.FC<{\n  mask?: [Date, Date];\n  onMaskUpdate: (start: Date, end: Date) => void;\n  view?: [Date, Date];\n  onViewUpdate: (start: Date, end: Date) => void;\n  width: number;\n}> = function ({ mask, onMaskUpdate, view, onViewUpdate, width }) {\n  const x = useMemo(\n    function () {\n      return d3\n        .scaleTime()\n        .domain([options.min, options.max])\n        .range([\n          ContextOptions.margin.left,\n          width - ContextOptions.margin.right,\n        ])\n        .nice()\n        .clamp(true);\n    },\n    [width]\n  );\n\n  return (\n    <svg\n      id=\"timeline-context\"\n      width=\"100%\"\n      height={ContextOptions.height + 'px'}\n    >\n      <Axis\n        scale={x}\n        position={[\n          '0',\n          ContextOptions.height - ContextOptions.margin.bottom + 'px',\n        ]}\n        axis={d3.axisBottom}\n      />\n      <ContextStackedChart x={x} />\n      <BrushX\n        x={x}\n        sync={mask}\n        onBrush={onMaskUpdate}\n        width={width}\n        height={ContextOptions.height}\n        margin={ContextOptions.margin.mask}\n      />\n      <ContextViewBrush\n        onBrush={onViewUpdate}\n        width={width}\n        sync={view}\n        x={x}\n      />\n    </svg>\n  );\n};\n","import styled from 'styled-components/macro';\nexport const StyledInput = styled.input`\n  opacity: 0;\n  width: 0;\n  height: 0;\n  display: none;\n  visibility: hidden;\n`;\n\nexport default StyledInput;\n","import React from 'react';\nimport styled from 'styled-components/macro';\nimport StyledInput from '../../feature/mask/StyledInput';\nimport { stopEventPropagation } from '../../hooks/useClick';\nimport { disabled } from '../../v2/components/theme';\n\nexport const StyledLabel = styled.label`\n  line-height: 1.2;\n  margin-bottom: 0;\n  margin-right: 1em;\n  display: flex;\n  align-items: center;\n`;\n\nexport const StyledSlider = styled.div`\n  cursor: pointer;\n  padding: 0.125em;\n  height: 1em;\n  width: 2em;\n  transition: 0.4s;\n  border-radius: 0.5em;\n  background-color: ${disabled};\n`;\n\nexport const StyledKnob = styled.div<{ slide: boolean }>`\n  height: 0.75em;\n  width: 0.75em;\n  background-color: white;\n  transition: 0.4s;\n  border-radius: 0.5em;\n  ${(props) => (props.slide ? 'transform: translate3d(1em, 0, 0)' : '')};\n`;\n\nexport const StyledText = styled.div<{ sliderColor: string }>`\n  margin-left: 0.125em;\n  color: ${(props) => props.sliderColor};\n  transition: 0.4s;\n`;\n\nconst CheckBoxSwitch: React.FC<{\n  checked: boolean;\n  handleCheck: React.ChangeEventHandler;\n  color: string;\n}> = function ({ checked, handleCheck, children, color }) {\n  return (\n    <StyledLabel className=\"pointer\" onMouseUp={stopEventPropagation}>\n      <StyledInput type=\"checkbox\" checked={checked} onChange={handleCheck} />\n      <StyledSlider style={{ backgroundColor: checked ? color : undefined }}>\n        <StyledKnob slide={checked} />\n      </StyledSlider>\n      <StyledText sliderColor={checked ? '' : disabled}>{children}</StyledText>\n    </StyledLabel>\n  );\n};\n\nexport default CheckBoxSwitch;\n","import React, { useState, useCallback, useEffect } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { setGroup } from '../timelineGroupSlice';\nimport { stopEventPropagation } from '../../../hooks/useClick';\nimport StyledInput from '../../mask/StyledInput';\nimport {\n  StyledLabel,\n  StyledKnob,\n  StyledText,\n  StyledSlider,\n} from '../../../components/ui/CheckBoxSwitch';\nimport classnames from 'classnames';\nimport styled from 'styled-components/macro';\nimport { darkgray, lightgray } from '../../../v2/components/theme';\n\nexport const PaddedStyledText = styled(StyledText)`\n  padding-left: 0.125em;\n  padding-right: 0.125em;\n  font-size: 0.75em;\n  font-weight: 700;\n`;\n\nexport const AdaptedSlider = styled(StyledSlider)`\n  background-color: ${darkgray};\n`;\n\nexport const ActorPlaceSwitch: React.FC<{ className?: string }> = function ({\n  className,\n}) {\n  const dispatch = useDispatch();\n\n  const [checked, setChecked] = useState(false);\n\n  const handleGroupSwitch = useCallback(() => {\n    setChecked((s) => !s);\n  }, []);\n\n  useEffect(\n    function () {\n      if (checked) {\n        dispatch(setGroup('PlaceNote'));\n      } else {\n        dispatch(setGroup('ActorNote'));\n      }\n    },\n    [dispatch, checked]\n  );\n\n  return (\n    <StyledLabel\n      className={classnames('pointer', className)}\n      onMouseUp={stopEventPropagation}\n    >\n      <StyledInput\n        type=\"checkbox\"\n        checked={checked}\n        onChange={handleGroupSwitch}\n      />\n      <PaddedStyledText sliderColor={checked ? lightgray : ''}>\n        Personnes\n      </PaddedStyledText>\n      <AdaptedSlider>\n        <StyledKnob slide={checked} />\n      </AdaptedSlider>\n      <PaddedStyledText sliderColor={checked ? '' : lightgray}>\n        Lieux\n      </PaddedStyledText>\n    </StyledLabel>\n  );\n};\n\nexport default ActorPlaceSwitch;\n","import { InformationGroup } from '../v2/detail/information/types';\nimport { ProsoVisEvent } from '../v2/types/events';\n\nexport function getEventLabel(\n  event: ProsoVisEvent,\n  noteKind: InformationGroup['kind'],\n  grouped: boolean = false\n): string {\n  if (event.computed) {\n    const { actorNote, actorNoteAndGrouped, placeNote, placeNoteAndGrouped } =\n      event.computed;\n\n    if (noteKind === 'ActorNote') {\n      // fallback to actorNote or event.label\n      return (grouped && actorNoteAndGrouped) || actorNote || event.label;\n    } else if (noteKind === 'PlaceNote') {\n      // fallback to placeNote or event.label\n      return (grouped && placeNoteAndGrouped) || placeNote || event.label;\n    }\n  }\n\n  // fallback to default labellisation\n  return event.label;\n}\n\nexport function getKindString(kind: string) {\n  switch (kind) {\n    case 'Birth':\n      return 'Naissances';\n\n    case 'Death':\n      return 'Décès';\n\n    case 'Education':\n      return 'Enseignements';\n\n    case 'ObtainQualification':\n      return 'Obtention de qualités';\n\n    case 'PassageExamen':\n      return 'Evaluations';\n\n    case 'Retirement':\n      return 'Départs en retraite';\n\n    case 'SuspensionActivity':\n      return \"Suspensions d'activités\";\n\n    default:\n      return kind;\n  }\n}\n","import React, { useEffect, useRef, useState, useMemo } from 'react';\nimport './ProsoVisTimeline.css';\n\nimport classnames from 'classnames';\nimport {\n  chunk,\n  filter,\n  forEach,\n  identity,\n  isEmpty,\n  join,\n  kebabCase,\n  map,\n  noop,\n  pipe,\n  sortBy,\n  split,\n  throttle,\n  transform,\n} from 'lodash/fp';\nimport { Nullable } from '../../v2/types/utils';\nimport { unescape } from 'he';\nimport { useMouse } from './useMouse';\nimport { useReferences } from './useReferences';\nimport { useSelector, useDispatch } from 'react-redux';\nimport {\n  addSelection,\n  setSelection,\n  clearSelection,\n} from '../../reducers/selectionSlice';\nimport { selectMaskedEvents } from '../../selectors/mask';\nimport { selectRichEventColor } from '../../selectors/switch';\nimport { createSelector } from '@reduxjs/toolkit';\nimport {\n  selectTimelineGroupBy,\n  selectTimelineGroup,\n  selectTimelineEventGroups,\n} from './timelineGroupSlice';\nimport { Context } from './Context';\nimport {\n  superSelectionAsMap,\n  selectSuperHighlight,\n} from '../../selectors/superHighlights';\nimport {\n  clearSuperHighlights,\n  setSuperHighlights,\n} from '../../reducers/superHighlightSlice';\nimport ActorPlaceSwitch from './header/ActorPlaceSwitch';\nimport styled from 'styled-components/macro';\nimport { getEventLabel } from '../../data/getEventLabel';\nimport { useUpdateMask } from './useUpdateMask';\nimport { ProsoVisDate } from '../../v2/types/events';\nimport { ProsoVisActor } from '../../v2/types/actors';\nimport { ProsoVisLocalisation } from '../../v2/types/localisations';\n\ntype VisEventProps = {\n  event: MouseEvent | PointerEvent;\n  item: Nullable<string>;\n  group: Nullable<string>;\n  what: Nullable<string>;\n  pageX: number;\n  pageY: number;\n  x: number;\n  y: number;\n  time: Date;\n  snappedTime: Date;\n};\n\ntype VisEventGroup = VisEventProps & {\n  what: 'group-label';\n  group: string;\n};\ntype VisEventItem = VisEventProps & {\n  what: 'item';\n  item: string;\n  group: string;\n};\ntype VisEventBackground = VisEventProps & {\n  what: 'background';\n  item: null;\n  group: string;\n};\ntype VisTimeMarker = {\n  id: string;\n  time: Date;\n  event: MouseEvent | PointerEvent;\n};\n\ntype VisEvent = VisEventGroup | VisEventItem | VisEventBackground;\n\nfunction resolveDatation([start, end]: ProsoVisDate[]): {\n  start: string;\n  end: Nullable<string>;\n  type: string;\n} {\n  return {\n    start: start.value,\n    end: end ? end.value : null,\n    type: end ? 'range' : 'box',\n  };\n}\n\nfunction newLineLongString(str: string, maxLenght = 30): string {\n  if (str.length < maxLenght) {\n    return str.padEnd(maxLenght, '\\u00a0');\n  }\n  const parts = split(' ', str);\n  const half = Math.floor((parts.length + 1) / 2);\n\n  return pipe(\n    chunk(half),\n    map((i) => join(' ', i).padEnd(maxLenght, '\\u00a0')),\n    join('<br/>')\n  )(parts);\n}\n\nconst OPACITY_CLASS = 'o-50';\n\ntype TimelineEvent = {\n  id: string;\n  title: string;\n  start: string;\n  end: Nullable<string>;\n  type: string;\n  popover: 'true';\n  className: string;\n  style: string;\n  group: string | 0;\n  kind: string;\n};\n\nconst selectTimelineEvents = createSelector(\n  selectMaskedEvents,\n  selectTimelineGroupBy,\n  selectRichEventColor,\n  (events, groupBy, eventColor) => {\n    return transform(\n      function (acc, richEvent) {\n        const { event: e } = richEvent;\n        if (e.datation && e.datation.length > 0) {\n          const { id, kind, datation } = e;\n          acc.push({\n            id,\n            title: unescape(getEventLabel(e, 'ActorNote')),\n            // label: \"\",\n            popover: 'true',\n            ...resolveDatation(datation),\n            className: classnames(kebabCase(kind), 'timeline-event'),\n            style: `border:0 solid white;\n            border-left: 1px solid white;\n            border-right: 1px solid white;\n            background-color: ${eventColor.main(richEvent)};`,\n            group: groupBy(e),\n            kind,\n          });\n        }\n      },\n      [] as TimelineEvent[],\n      events\n    );\n  }\n);\n\nconst ProsoVisTimeline: React.FC<{ className?: string }> = function ({\n  className,\n}) {\n  const dispatch = useDispatch();\n\n  const groups = useSelector(selectTimelineEventGroups);\n\n  const [width, setWidth] = useState<number>();\n\n  const timelineEvents = useSelector(selectTimelineEvents);\n\n  const { $events, timeline, timelineRef } = useReferences();\n\n  /*\n   * CONTEXT\n   */\n  const updateMask = useUpdateMask();\n  const [maskSync, setMaskSync] = useState<[Date, Date]>();\n  const handleUpdateMask = useMemo(\n    function () {\n      if (!timeline) return noop;\n      return throttle(16, (start: Date, end: Date) => {\n        timeline.vis.setCustomTime(start, 'a');\n        timeline.vis.setCustomTime(end, 'b');\n        updateMask(start, end);\n      });\n    },\n    [timeline, updateMask]\n  );\n\n  const [viewSync, setViewSync] = useState<[Date, Date]>();\n  const handleUpdateView = useMemo(() => {\n    if (!timeline) return noop;\n\n    return throttle(16, (start: Date, end: Date) => {\n      timeline.vis.setWindow(start, end, {\n        animation: false,\n      });\n    });\n  }, [timeline]);\n\n  useEffect(() => {\n    if (!timeline) return;\n\n    // view sync with context\n    const viewSyncThrottle = throttle(16, function (start: Date, end: Date) {\n      setViewSync([start, end]);\n    });\n\n    // mask sync with context\n    const maskSyncThrottle = throttle(16, function (e: VisTimeMarker) {\n      const interval = sortBy(identity, [\n        e.time,\n        e.id === 'a'\n          ? timeline.vis.getCustomTime('b')\n          : timeline.vis.getCustomTime('a'),\n      ]) as [Date, Date];\n      setMaskSync(interval);\n      const [start, end] = interval;\n      updateMask(start, end);\n    });\n\n    timeline.vis.on('rangechange', (e: any) => {\n      if (e.byUser) {\n        viewSyncThrottle(e.start, e.end);\n      }\n    });\n\n    timeline.vis.on('timechange', (e: VisTimeMarker) => {\n      maskSyncThrottle(e);\n    });\n  }, [timeline, updateMask]);\n\n  // Syncs the context window view and the timeline view\n\n  const actions = useRef<{\n    click: (e: VisEvent) => void;\n    changed: (e: VisEvent) => void;\n    mouseOver: (e: VisEvent) => void;\n    mouseOut: (e: VisEvent) => void;\n    // __click: (e: VisEvent) => void;\n    // __drag: (e: VisEvent) => void;\n  }>(undefined as any);\n  if (actions.current === undefined) {\n    actions.current = {\n      click: (_e: VisEvent) => {},\n      changed: (_e: VisEvent) => {},\n      mouseOver: (_e: VisEvent) => {},\n      mouseOut: (_e: VisEvent) => {},\n      // __click: (_e: VisEvent) => {},\n      // __drag: (_e: VisEvent) => {},\n    };\n  }\n\n  /*\n   * Binds actions and mouse interactions to the timeline\n   */\n  {\n    // mouse actions\n    const mouse = useMouse();\n\n    useEffect(() => {\n      if (!timeline) return;\n\n      timeline.vis.on('changed', (e: any) => actions.current.changed(e));\n      // timeline.vis.on('click', (e: any) => actions.current.__click(e));\n      // timeline.vis.on('dragover', (e: any) => actions.current.__drag(e));\n\n      timeline.vis.on('mouseDown', (e: any) => {\n        if (!mouse.current.click) {\n          mouse.current.click = true;\n          mouse.current.x = e.pageX;\n          mouse.current.y = e.pageY;\n        }\n      });\n\n      timeline.vis.on('mouseMove', (e: any) => {\n        if (\n          mouse.current.click &&\n          mouse.current.draggingTreshold(mouse.current, e.event as any)\n        ) {\n          mouse.current.dragging = true;\n          mouse.current.click = false;\n        }\n      });\n\n      timeline.vis.on('mouseUp', (e: any) => {\n        if (mouse.current.click) actions.current.click(e);\n        mouse.current.dragging = false;\n        mouse.current.click = false;\n      });\n\n      timeline.vis.on('mouseOver', (e: any) => actions.current.mouseOver(e));\n\n      return () => timeline.vis.destroy();\n      // safely ignoring dispatch and mouse as they are references\n      // eslint-disable-next-line\n    }, [timeline]);\n  }\n\n  /*\n   * Selection\n   */\n  // updates visual cues on timeline during navigation\n  const selection = useSelector(superSelectionAsMap);\n\n  useEffect(() => {\n    const change = function () {\n      if (timeline) {\n        const boundingRect = timeline.dom.getBoundingClientRect();\n        if (width !== boundingRect.width) {\n          setWidth(boundingRect.width);\n        }\n      }\n      if ($events.current) {\n        forEach(($event) => {\n          const isDimmed = $event.classList.contains(OPACITY_CLASS);\n\n          if (isEmpty(selection)) {\n            if (isDimmed) {\n              // console.debug('timeline:opacity:undefined');\n              $event.classList.remove(OPACITY_CLASS);\n            }\n          } else {\n            const inSelection = selection[$event.dataset.id!] !== undefined;\n            if (isDimmed && inSelection) {\n              // console.debug('timeline:opacity:remove');\n              $event.classList.remove(OPACITY_CLASS);\n            } else if (!isDimmed && !inSelection) {\n              // console.debug('timeline:opacity:add');\n              $event.classList.add(OPACITY_CLASS);\n            }\n          }\n        }, $events.current);\n      }\n    };\n    change();\n\n    actions.current.changed = change;\n  }, [$events, selection, timeline, width]);\n\n  // binds click to selection actions\n\n  useEffect(() => {\n    actions.current.click = (e: VisEvent) => {\n      switch (e.what) {\n        case 'group-label':\n          // console.debug('selection:group', e.group);\n          const groupEvents = pipe(\n            filter<TimelineEvent>({ group: e.group }),\n            map(({ id }) => ({ id, kind: 'Event' })),\n            sortBy<{ id: string; kind: 'Event' }>('id')\n          )(timelineEvents);\n          // const groupEvents = _(timelineEvents)\n          //   .filter({ group: e.group })\n          //   .map(({ id }) => ({ id, kind: 'Event' }))\n          //   .sortBy('id')\n          //   .value();\n          if (e.event.ctrlKey || e.event.metaKey) {\n            dispatch(addSelection(groupEvents));\n          } else {\n            dispatch(setSelection(groupEvents));\n          }\n          break;\n        case 'item':\n          if (e.event.ctrlKey || e.event.metaKey) {\n            if (selection[e.item]) {\n              // console.debug('selection:item:unselect', e.item);\n              const filtered = filter((i) => i.id !== e.item, selection);\n              if (filtered) {\n                dispatch(setSelection(filtered));\n              }\n            } else {\n              // console.debug('selection:item', e.item);\n              // is not selected\n              dispatch(addSelection({ id: e.item, kind: 'Event' }));\n            }\n          } else {\n            dispatch(setSelection({ id: e.item, kind: 'Event' }));\n          }\n          break;\n        default:\n          if (!e.event.ctrlKey && !e.event.metaKey) {\n            // console.debug('selection:reset');\n            dispatch(clearSelection());\n          }\n      }\n    };\n  }, [dispatch, selection, timelineEvents]);\n\n  /*\n   * Highlights\n   Events and Groups are highlighted\n   */\n  const highlights = useSelector(selectSuperHighlight);\n  const groupingKind = useSelector(selectTimelineGroup);\n\n  useEffect(() => {\n    actions.current.mouseOver = (e: VisEvent) => {\n      if (e.what === 'group-label') {\n        pipe(\n          filter<TimelineEvent>({ group: e.group }),\n          map(({ id }) => ({ id, kind: 'Event' })),\n          sortBy<{ id: string; kind: 'Event' }>('id'),\n          setSuperHighlights,\n          dispatch\n        )(timelineEvents);\n\n        // dispatch(setSuperHighlights(groupEvents));\n      } else if (e.what === 'item') {\n        dispatch(setSuperHighlights({ id: e.item, kind: 'Event' }));\n      } else if (highlights) {\n        dispatch(clearSuperHighlights());\n      }\n    };\n\n    actions.current.mouseOut = () => {\n      if (highlights) dispatch(clearSuperHighlights());\n    };\n  }, [highlights, dispatch, groupingKind, timelineEvents]);\n\n  /*\n   * Data change\n   */\n  const [firstEvent, setFirstEvent] = useState<boolean | number>(false);\n\n  useEffect(() => {\n    if (!timeline) return;\n\n    timeline.vis.setItems(timelineEvents as any[]);\n    if (firstEvent === false) {\n      setFirstEvent(true);\n    }\n    // visTimeline.current!.redraw();\n  }, [firstEvent, timeline, timelineEvents]);\n\n  useEffect(() => {\n    if (firstEvent !== true) return;\n    if (!timeline || !width) return;\n    if (timelineEvents.length === 0) return;\n    timeline.vis.fit({ animation: false });\n    const interval = timeline.vis.getWindow();\n\n    setViewSync([interval.start, interval.end]);\n\n    setFirstEvent(width);\n  }, [firstEvent, timeline, width, timelineEvents]);\n\n  useEffect(() => {\n    if (!timeline) return;\n\n    // Set Groups\n    timeline.vis.setGroups(\n      map(\n        ({ id, label }) => ({\n          id,\n          content: newLineLongString(label),\n        }),\n        groups as (ProsoVisActor | ProsoVisLocalisation)[]\n      )\n    );\n    // visTimeline.current!.redraw();\n  }, [groups, timeline]);\n\n  return (\n    <div className={className}>\n      <div id=\"timeline\" ref={timelineRef}>\n        <VisHeader />\n      </div>\n      {width && (\n        <Context\n          mask={maskSync}\n          onMaskUpdate={handleUpdateMask}\n          view={viewSync}\n          onViewUpdate={handleUpdateView}\n          width={width}\n        />\n      )}\n    </div>\n  );\n};\n\nconst VisHeader = styled(ActorPlaceSwitch)`\n  position: absolute;\n  bottom: 20px;\n  z-index: 2;\n  line-height: 1.2;\n  background-color: white;\n`;\n\nexport default ProsoVisTimeline;\n","import { throttle } from 'lodash';\nimport { useMemo } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { setIntervalMask } from '../../reducers/maskSlice';\n\nexport function useUpdateMask() {\n  const dispatch = useDispatch();\n  const updateMask = useMemo(\n    function () {\n      return throttle((start: Date, end: Date) => {\n        dispatch(\n          setIntervalMask({\n            start: start.toISOString(),\n            end: end.toISOString(),\n          })\n        );\n      }, 100);\n    },\n    [dispatch]\n  );\n  return updateMask;\n}\n","import React from 'react';\nimport styled from 'styled-components/macro';\nimport SiprojurisMap from '../../feature/map/SiprojurisMap';\nimport Relation from '../../feature/relation/Relation';\nimport ProsoVisTimeline from '../../feature/timeline/ProsoVisTimeline';\nimport { lightgray } from '../components/theme';\n\nconst Main = styled.div`\n  display: grid;\n  position: relative;\n  width: 100%;\n  height: 100%;\n  grid-template-areas:\n    'rel  map'\n    'timeline timeline';\n  grid-template-columns: 1fr 1fr;\n  grid-template-rows: 1fr auto;\n`;\n\nconst StyledMap = styled(SiprojurisMap)`\n  grid-area: map;\n  border-left: 1px solid ${lightgray};\n`;\n\nconst StyledRelation = styled(Relation)`\n  grid-area: rel;\n  border-top: 1px solid ${lightgray};\n`;\n\nconst StyledTimeline = styled(ProsoVisTimeline)`\n  grid-area: timeline;\n`;\n\nexport function DetailView() {\n  return (\n    <Main>\n      <StyledRelation />\n      <StyledMap />\n      <StyledTimeline />\n    </Main>\n  );\n}\n","import { PersonIcon } from '@primer/octicons-react';\nimport styled from 'styled-components/macro';\n\nexport const ColorablePersonIcon = styled(PersonIcon)<{\n  iconColor?: string;\n}>(({ iconColor }) => (iconColor ? `color: ${iconColor};` : ''));\n","import { moongray } from '../../../v2/components/theme';\n\nexport type HighlightableProp = {\n  highlighted: boolean;\n};\n\nexport const highlightable = ({ highlighted }: HighlightableProp) =>\n  highlighted && `background-color: ${moongray}; border-radius: 2px;`;\n\nexport type SelectableProp = {\n  selected: boolean;\n};\n\nexport const selectable = ({ selected }: SelectableProp) =>\n  'cursor: pointer;' + (selected ? 'font-weight: 700;' : '');\n\nexport type MaskableProp = {\n  masked: boolean;\n};\n\nexport const maskable = ({ masked }: MaskableProp) => masked && 'opacity: 50%;';\n","import { ChevronDownIcon, ChevronUpIcon } from '@primer/octicons-react';\nimport React, { useState } from 'react';\nimport { useFlatClick } from '../../../hooks/useClick';\nimport { StyledFlex } from '../Flex/styled-components';\nimport { IconSpacerPointer } from '../IconSpacer';\n\nexport const Note: React.FC<{\n  as?: keyof JSX.IntrinsicElements | React.ComponentType<any>;\n  title: JSX.Element | string;\n  underline?: boolean;\n  defaultToggleState?: boolean;\n}> = function ({ title, as = 'div', defaultToggleState = false, children }) {\n  const Base = as;\n  const [show, setShow] = useState(defaultToggleState);\n  const handleToggle = useFlatClick(() => {\n    setShow((s) => !s);\n  });\n\n  return (\n    <Base>\n      <NoteTitle>\n        {title}\n        <IconSpacerPointer {...handleToggle} spaceLeft>\n          {show ? (\n            <ChevronUpIcon aria-label=\"Déplier\" />\n          ) : (\n            <ChevronDownIcon aria-label=\"Replier\" />\n          )}\n        </IconSpacerPointer>\n      </NoteTitle>\n      {show && <NoteContent>{children}</NoteContent>}\n    </Base>\n  );\n};\n\nconst NoteTitle = StyledFlex;\n\nexport const NoteContent: React.FC = function ({ children }) {\n  return <>{children}</>;\n};\n","import React from 'react';\nimport { Icon } from '@primer/octicons-react';\n\nconst AlertFillIcon: Icon = function ({\n  className = 'octicon',\n  'aria-label': ariaLabel,\n  verticalAlign = 'text-bottom',\n}) {\n  return (\n    <svg\n      viewBox=\"0 0 16 16\"\n      width=\"16\"\n      height=\"16\"\n      fill=\"currentColor\"\n      style={{\n        display: 'inline-block',\n        userSelect: 'none',\n        verticalAlign: verticalAlign,\n      }}\n      aria-label={ariaLabel}\n      className={className}\n    >\n      <path\n        fillRule=\"evenodd\"\n        d=\"M 6.457 1.047 c 0.659 -1.234 2.427 -1.234 3.086 0 l 6.082 11.378 A 1.75 1.75 0 0 1 14.082 15 H 1.918 a 1.75 1.75 0 0 1 -1.543 -2.575 L 6.457 1.047 z M 9 11 a 1 1 0 0 0 -2 0 a 1 1 0 0 0 2 0 z m -0.25 -5.25 a 0.75 0.75 0 0 0 -1.5 0 v 2.5 a 0.75 0.75 0 0 0 1.5 0 v -2.5 z\"\n      />\n    </svg>\n  );\n};\n\nexport default AlertFillIcon;\n","import React from 'react';\nimport { Icon } from '@primer/octicons-react';\n\nconst InfoFillIcon: Icon = function ({\n  className = 'octicon',\n  'aria-label': ariaLabel,\n  verticalAlign = 'text-bottom',\n}) {\n  return (\n    <svg\n      viewBox=\"0 0 16 16\"\n      width=\"16\"\n      height=\"16\"\n      fill=\"currentColor\"\n      style={{\n        display: 'inline-block',\n        userSelect: 'none',\n        verticalAlign: verticalAlign,\n      }}\n      aria-label={ariaLabel}\n      className={className}\n    >\n      <path\n        fillRule=\"evenodd\"\n        d=\"M 8 0 a 8 8 0 1 0 0 16 a 8 8 0 0 0 0 -16 z M 6.5 7.75 A 0.75 0.75 0 0 1 7.25 7 h 1 a 0.75 0.75 0 0 1 0.75 0.75 v 2.75 h 0.25 a 0.75 0.75 0 0 1 0 1.5 h -2 a 0.75 0.75 0 0 1 0 -1.5 h 0.25 v -2 h -0.25 a 0.75 0.75 0 0 1 -0.75 -0.75 z M 8 6 a 1 1 0 0 1 0 -2 a 1 1 0 0 1 0 2 z\"\n      />\n    </svg>\n  );\n};\n\nexport default InfoFillIcon;\n","import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport {\n  ChevronLeftIcon,\n  ChevronRightIcon,\n  GrabberIcon,\n  XIcon,\n} from '@primer/octicons-react';\nimport { capitalize, pipe } from 'lodash/fp';\nimport { animated, useSpring } from 'react-spring';\nimport { useDrag } from 'react-use-gesture';\nimport styled from 'styled-components/macro';\nimport Modal from '../../feature/modal/Modal';\nimport { stopEventPropagation, useFlatClick } from '../../hooks/useClick';\nimport { ProsoVisError } from '../../v2/types/errors';\nimport { IconSpacer, IconSpacerPointer } from '../ui/IconSpacer';\nimport { useDimsPopper } from '../ui/Popper';\nimport { darkgray } from '../../v2/components/theme';\nimport { sort } from 'd3';\n\nconst errorLevelTranslation: { [k in ProsoVisError['level']]: string } = {\n  Error: 'erreur',\n  Warning: 'alerte',\n  Info: 'note',\n};\n\nfunction getErrorLevel(error: ProsoVisError) {\n  return errorLevelTranslation[error.level];\n}\n\nconst createErrorTitleString = pipe(getErrorLevel, capitalize);\n\nconst ErrorTitle = styled.div`\n  align-self: center;\n  padding-left: 1em;\n`;\n\nconst TabButton = styled(IconSpacer)`\n  background-color: #fafbfc;\n  border: 1px solid rgba(27, 31, 35, 0.12);\n  box-shadow: 0px 1px 0px rgba(27, 31, 35, 0.04),\n    inset 0px 2px 0px rgba(255, 255, 255, 0.25);\n  padding: 0.25em;\n`;\n\nconst GroupableTabButton = styled(TabButton)<{\n  position?: 'left' | 'right' | 'between';\n  disabled?: boolean;\n}>`\n  ${({ position }) => {\n    switch (position) {\n      case 'left':\n        return `\n          border-top-left-radius: 4px; \n          border-bottom-left-radius: 4px;\n          border-right-width: 0;`;\n      case 'right':\n        return `\n          border-top-right-radius: 4px;\n          border-bottom-right-radius: 4px;`;\n      case 'between':\n        return 'border-right-width: 0;';\n      default:\n        return '';\n    }\n  }}\n`;\n\nconst TitleBase = styled.div`\n  display: grid;\n  grid-template-columns: auto auto auto auto 1fr auto;\n  padding-top: 0.25em;\n  padding-left: 0.25em;\n`;\n\nconst TitleCloseIcon = styled(IconSpacerPointer)`\n  align-self: start;\n`;\n\nconst CountDisplay = styled.div`\n  padding: 0.25em;\n  border-top: 1px solid rgba(27, 31, 35, 0.12);\n  border-bottom: 1px solid rgba(27, 31, 35, 0.12);\n  border-left: 1px solid rgba(27, 31, 35, 0.12);\n  box-shadow: 0px 1px 0px rgba(27, 31, 35, 0.04),\n    inset 0px 2px 0px rgba(255, 255, 255, 0.25);\n`;\n\nconst ContentBase = styled.div`\n  padding: 0.25em;\n`;\n\nconst ContentTitle = styled.p`\n  text-align: center;\n`;\n\nconst DetailsMenuContent: React.FC<{ error: ProsoVisError }> = function ({\n  error,\n}) {\n  return (\n    <ContentBase>\n      <ContentTitle>{error.message}</ContentTitle>\n    </ContentBase>\n  );\n};\n\nfunction translateInterpolator(x: number, y: number) {\n  return `translate3d(${x}px, ${y}px, 0)`;\n}\n\nconst Overlay = styled.div<{ show?: boolean }>`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 9998;\n  pointer-events: ${({ show }) => (show ? 'auto' : 'none')};\n`;\nconst DetailsMenu = styled.div<{ active?: boolean }>`\n  z-index: 9998;\n  top: 0;\n  position: absolute;\n  width: 20em;\n  min-height: 200px;\n  background-color: white;\n  box-shadow: 1px 1px 5px ${({ active }) => (active ? '2px' : '0')} ${darkgray};\n  border-radius: 3px;\n  pointer-events: auto;\n  transition: box-shadow 300ms ease;\n`;\n\nconst AnimatedDetailsMenu = animated(DetailsMenu);\n\nconst DraggableIcon = styled(IconSpacer)`\n  cursor: grab;\n  padding-left: 0.25em;\n  padding-right: 0.25em;\n`;\n\nexport const EventErrorContextMenu: React.FC<{\n  errors: ProsoVisError[];\n  highlight: boolean;\n  $parentRef: React.MutableRefObject<HTMLElement>;\n  close: () => void;\n}> = function ({ highlight, errors, $parentRef, close }) {\n  const [active, setActive] = useState(false);\n\n  const [{ xy }, set] = useSpring(\n    () =>\n      ({\n        xy: [0, 0],\n      } as { xy: [number, number] })\n  );\n\n  const bindDraggable = useDrag(({ down, offset }) => {\n    setActive(down);\n    set({ xy: offset });\n  });\n\n  const $contentRef = useRef<HTMLDivElement>(null as any);\n  const [dims, show, hide] = useDimsPopper(\n    $parentRef,\n    $contentRef,\n    'north-east'\n  );\n\n  useEffect(() => {\n    show();\n\n    return () => {\n      hide();\n    };\n    // eslint-disable-next-line\n  }, []);\n\n  const sortedErrors = useMemo(\n    () =>\n      sort(errors, ({ level }) => {\n        if (level === 'Error') return 0;\n        if (level === 'Warning') return 1;\n        return 2;\n      }),\n    [errors]\n  );\n\n  const [[currentErrorIndex, currentError], setCurrentError] = useState<\n    [number, ProsoVisError]\n  >([0, sortedErrors[0]]);\n\n  const next = useCallback(() => {\n    if (currentErrorIndex + 1 < sortedErrors.length) {\n      setCurrentError([\n        currentErrorIndex + 1,\n        sortedErrors[currentErrorIndex + 1],\n      ]);\n    }\n  }, [sortedErrors, currentErrorIndex]);\n\n  const prev = useCallback(() => {\n    if (currentErrorIndex > 0) {\n      setCurrentError([\n        currentErrorIndex - 1,\n        sortedErrors[currentErrorIndex - 1],\n      ]);\n    }\n  }, [sortedErrors, currentErrorIndex]);\n\n  return (\n    <Modal>\n      <Overlay show={active}>\n        <AnimatedDetailsMenu\n          active={highlight}\n          ref={$contentRef}\n          onClick={stopEventPropagation}\n          onMouseUp={stopEventPropagation}\n          onContextMenu={stopEventPropagation}\n          style={{\n            ...dims,\n            transform: xy.interpolate(translateInterpolator as any),\n          }}\n        >\n          <TitleBase>\n            <DraggableIcon {...bindDraggable()}>\n              <GrabberIcon />\n            </DraggableIcon>\n            <GroupableTabButton\n              as=\"button\"\n              position=\"left\"\n              onClick={prev}\n              disabled={currentErrorIndex === 0}\n            >\n              <ChevronLeftIcon />\n            </GroupableTabButton>\n            <CountDisplay>\n              {currentErrorIndex + 1}/{sortedErrors.length}\n            </CountDisplay>\n            <GroupableTabButton\n              as=\"button\"\n              position=\"right\"\n              onClick={next}\n              disabled={currentErrorIndex + 1 === sortedErrors.length}\n            >\n              <ChevronRightIcon />\n            </GroupableTabButton>\n            <ErrorTitle>{createErrorTitleString(currentError)}</ErrorTitle>\n            <TitleCloseIcon spaceRight {...useFlatClick(close)}>\n              <XIcon aria-label=\"Fermer le menu contextuel d'erreur\" />\n            </TitleCloseIcon>\n          </TitleBase>\n          <DetailsMenuContent error={currentError} />\n        </AnimatedDetailsMenu>\n      </Overlay>\n    </Modal>\n  );\n};\n","import { IconProps, XCircleFillIcon } from '@primer/octicons-react';\nimport { compact, groupBy } from 'lodash/fp';\nimport React, { useMemo, useRef, useState } from 'react';\nimport styled, { StyledComponent } from 'styled-components/macro';\nimport { stopEventPropagation } from '../../hooks/useClick';\nimport { blue, lightgray, orange, red } from '../../v2/components/theme';\nimport { ProsoVisError } from '../../v2/types/errors';\nimport AlertFillIcon from '../ui/icon/AlertFillIcon';\nimport InfoFillIcon from '../ui/icon/InfoFillIcon';\nimport { IconSpacerPointer } from '../ui/IconSpacer';\nimport { usePopper, useRefPopper } from '../ui/Popper';\nimport { EventErrorContextMenu } from './EventErrorContextMenu';\n\nconst SipErrorIcon = styled(XCircleFillIcon)`\n  color: ${red};\n`;\nconst SipWarningIcon = styled(AlertFillIcon)`\n  color: ${orange};\n`;\nconst SipInfoIcon = styled(InfoFillIcon)`\n  color: ${blue};\n`;\n\nconst SipGrayedErrorIcon = styled(XCircleFillIcon)`\n  color: ${lightgray};\n`;\nconst SipGrayedWarningIcon = styled(AlertFillIcon)`\n  color: ${lightgray};\n`;\nconst SipGrayedInfoIcon = styled(InfoFillIcon)`\n  color: ${lightgray};\n`;\n\nfunction plural(value: number, singular: string, plural: string) {\n  if (value === 0) return '';\n\n  if (value === 1) return singular;\n  else return `${value} ${plural}`;\n}\n\nfunction getErrorLabel(errors: {\n  [k in ProsoVisError['level']]?: ProsoVisError[];\n}) {\n  return compact([\n    plural(errors.Error?.length || 0, '1 erreur', 'erreurs'),\n    plural(errors.Warning?.length || 0, '1 alerte', 'alertes'),\n    plural(errors.Info?.length || 0, '1 note', 'notes'),\n  ]).join(', ');\n}\n\ntype ColoredErrorInfoType = [\n  StyledComponent<React.FC<IconProps>, any, {}, never>,\n  string,\n  string\n];\n\ntype GrayedErrorInfoType = [\n  StyledComponent<React.FC<IconProps>, any, {}, never>,\n  string\n];\n\nfunction getErrorInfo(\n  errors: ProsoVisError[],\n  gray?: true\n): ColoredErrorInfoType;\nfunction getErrorInfo(\n  errors: ProsoVisError[],\n  gray: false\n): GrayedErrorInfoType;\nfunction getErrorInfo(\n  errors: ProsoVisError[],\n  gray: boolean = true\n): ColoredErrorInfoType | GrayedErrorInfoType {\n  const groupedErrors: { [k in ProsoVisError['level']]?: ProsoVisError[] } =\n    groupBy((e) => e.level, errors);\n  const label = getErrorLabel(groupedErrors);\n\n  if (!gray) {\n    if (groupedErrors.Error) return [SipGrayedErrorIcon, label];\n    if (groupedErrors.Warning) return [SipGrayedWarningIcon, label];\n    if (groupedErrors.Info) return [SipGrayedInfoIcon, label];\n  } else {\n    if (groupedErrors.Error) return [SipErrorIcon, red, label];\n    if (groupedErrors.Warning) return [SipWarningIcon, orange, label];\n    if (groupedErrors.Info) return [SipInfoIcon, blue, label];\n  }\n\n  throw new Error('Unreachable code');\n}\n\nconst PilledIconSpacer = styled(IconSpacerPointer)`\n  position: relative;\n  &:before {\n    content: attr(data-count);\n    border-radius: 999px;\n    line-height: 1;\n    font-size: 10px;\n    height: 11px;\n    min-width: 11px;\n    position: absolute;\n    display: inline-block;\n    top: -20%;\n    right: -20%;\n    color: white;\n    text-align: center;\n    padding: 0 2px;\n  }\n`;\n\nconst ColoredPilledIconSpacer = styled(PilledIconSpacer)<{ color: string }>`\n  &:before {\n    background-color: ${({ color }) => color};\n  }\n`;\n\nexport const SimpleEventErrors: React.FC<{ errors: ProsoVisError[] }> =\n  function ({ errors }) {\n    const [Icon, label] = getErrorInfo(errors, false);\n\n    const [hint, $ref, showHint, hideHint] =\n      useRefPopper<HTMLDivElement>(label);\n\n    return (\n      <ColoredPilledIconSpacer\n        spaceLeft\n        ref={$ref}\n        onMouseEnter={showHint}\n        onFocus={showHint}\n        onMouseLeave={hideHint}\n        onBlur={hideHint}\n        color={lightgray}\n        data-count={errors.length}\n      >\n        <Icon aria-label={label} />\n        {hint}\n      </ColoredPilledIconSpacer>\n    );\n  };\n\nexport const EventErrors: React.FC<{\n  errors: ProsoVisError[];\n  highlight: boolean;\n}> = function ({ errors, highlight }) {\n  const $ref = useRef<HTMLDivElement>(null as any);\n\n  const [showContextMenu, setContextMenuState] = useState(false);\n\n  const [Icon, color, label] = useMemo(() => getErrorInfo(errors), [errors]);\n  const [hint, showHint, hideHint] = usePopper($ref, label);\n\n  return (\n    <>\n      <ColoredPilledIconSpacer\n        spaceLeft\n        color={color}\n        data-count={errors.length}\n        ref={$ref}\n        onMouseEnter={showHint}\n        onFocus={showHint}\n        onMouseLeave={hideHint}\n        onBlur={hideHint}\n        onContextMenu={handleContextMenu}\n        onMouseUp={stopEventPropagation}\n      >\n        <Icon aria-label={label} />\n        {showContextMenu && (\n          <EventErrorContextMenu\n            highlight={highlight}\n            $parentRef={$ref}\n            close={closeContextMenu}\n            errors={errors}\n          />\n        )}\n        {hint}\n      </ColoredPilledIconSpacer>\n    </>\n  );\n  function closeContextMenu() {\n    setContextMenuState(false);\n    hideHint();\n  }\n\n  function handleContextMenu(e: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    e.stopPropagation();\n    e.preventDefault();\n    setContextMenuState((state) => !state);\n  }\n};\n","import React, { useMemo } from 'react';\nimport { useSelector } from 'react-redux';\nimport styled from 'styled-components/macro';\nimport getEventIcon from '../../data/getEventIcon';\nimport { getEventLabel } from '../../data/getEventLabel';\nimport {\n  highlightable,\n  HighlightableProp,\n  maskable,\n  MaskableProp,\n  selectable,\n  SelectableProp,\n} from '../../feature/info/fold/styled-components';\nimport { useClickSelect } from '../../hooks/useClick';\nimport useHoverHighlight from '../../hooks/useHoverHighlight';\nimport { selectSwitchKindColor } from '../../selectors/switch';\nimport { ProsoVisDates } from '../../v2/components/ProsoVisDateComponent';\nimport {\n  InformationGroup,\n  Interactive,\n} from '../../v2/detail/information/types';\nimport { ProsoVisDetailRichEvent, ProsoVisEvent } from '../../v2/types/events';\nimport { IconSpacer } from '../ui/IconSpacer';\nimport { EventErrors } from './EventErrors';\n\nexport const Base = styled.div<\n  { grouped?: boolean } & SelectableProp & MaskableProp & HighlightableProp\n>`\n  display: grid;\n  grid-template-columns: auto 2fr auto auto;\n  padding-top: 2px;\n  padding-bottom: 2px;\n  padding-left: 0.25em;\n  padding-right: 0.25em;\n  justify-content: space-between;\n  align-items: center;\n  margin-right: ${({ grouped }) => (grouped ? '18px;' : '20px;')};\n  ${selectable}\n  ${maskable}\n  ${highlightable};\n`;\n\nconst EventLineIcon: React.FC<{ kind: ProsoVisEvent['kind'] }> = function ({\n  kind,\n}) {\n  const color = useSelector(selectSwitchKindColor);\n\n  const Icon = getEventIcon(kind);\n\n  return (\n    <IconSpacer spaceRight>\n      <Icon iconColor={color ? color(kind) : undefined} />\n    </IconSpacer>\n  );\n};\n\nexport const EventLine: React.FC<{\n  event: Interactive<ProsoVisDetailRichEvent>;\n  origin: InformationGroup['kind'];\n  grouped?: boolean;\n}> = function ({ event, origin, grouped = false }) {\n  const dispatchable = { id: event.event.id, kind: 'Event' };\n  const handleHighlightHover = useHoverHighlight(dispatchable);\n  const handleSelectClick = useClickSelect(dispatchable);\n\n  const showIcon = grouped ? (\n    <span />\n  ) : (\n    <EventLineIcon kind={event.event.kind} />\n  );\n\n  const showErrors = useMemo(\n    function () {\n      return (\n        event.errors !== undefined &&\n        event.errors.length > 0 && (\n          <EventErrors\n            highlight={event.highlighted === true}\n            errors={event.errors}\n          />\n        )\n      );\n    },\n    [event.errors, event.highlighted]\n  );\n\n  return (\n    <Base\n      {...handleHighlightHover}\n      {...handleSelectClick}\n      selected={event.selected === true}\n      highlighted={event.highlighted === true}\n      masked={event.masked === true}\n      grouped={grouped}\n    >\n      {showIcon}\n      <div>{getEventLabel(event.event, origin, grouped)}</div>\n      <ProsoVisDates dates={event.event.datation} />\n      {showErrors}\n    </Base>\n  );\n};\n","import styled from 'styled-components/macro';\nimport { lightgray } from '../../v2/components/theme';\nimport { scrollbar } from '../scrollbar';\n\nexport const LeftSpacer = styled.div<{ borderColor?: string }>`\n  border-color: ${({ borderColor = lightgray }) => borderColor};\n  box-sizing: border-box;\n  margin-left: 11px; /* 4px icon-spacing + 7px icon centering */\n  padding-left: 3px;\n  border-left-style: solid;\n  border-width: 2px;\n`;\n\nexport const LeftBottomSpacer = styled(LeftSpacer)`\n  border-bottom-style: solid;\n  padding-bottom: 2px;\n  margin-bottom: 0.25em;\n  overflow-y: auto;\n  min-height: 2em;\n\n  ${scrollbar}\n`;\n","import { compact, isNil } from 'lodash/fp';\nimport React, { useMemo } from 'react';\nimport { useSelector } from 'react-redux';\nimport styled from 'styled-components/macro';\nimport { getKindString } from '../../data/getEventLabel';\nimport getEventIcon from '../../data/getEventIcon';\nimport {\n  highlightable,\n  HighlightableProp,\n  maskable,\n  MaskableProp,\n  SelectableProp,\n} from '../../feature/info/fold/styled-components';\nimport useHoverHighlight from '../../hooks/useHoverHighlight';\nimport { selectSwitchKindColor } from '../../selectors/switch';\nimport { IconSpacer } from '../ui/IconSpacer';\nimport { Note } from '../ui/Note';\nimport { EventLine } from './EventLine';\nimport { LeftSpacer } from './LeftSpacer';\nimport { SimpleEventErrors } from './EventErrors';\nimport { ProsoVisDetailRichEvent } from '../../v2/types/events';\nimport {\n  EventGroup as EventGroupType,\n  InformationGroup,\n  Interactive,\n} from '../../v2/detail/information/types';\nimport { ProsoVisDates } from '../../v2/components/ProsoVisDateComponent';\n\nexport const LeftBottomSpacer = styled(LeftSpacer)`\n  border-bottom-style: solid;\n  padding-bottom: 2px;\n  margin-bottom: 2px;\n  margin-right: 2px;\n`;\n\nexport const EventGroup: React.FC<\n  EventGroupType<Interactive<ProsoVisDetailRichEvent>[]> & {\n    origin: InformationGroup['kind'];\n  }\n> = function ({ kind, events, start, end, origin }) {\n  const interactive = useMemo(\n    () => events.map(({ event: { id } }) => ({ id, kind: 'Event' })),\n    [events]\n  );\n  const handleHighLightHover = useHoverHighlight(interactive);\n\n  const color = useSelector(selectSwitchKindColor);\n\n  const Icon = getEventIcon(kind);\n\n  /* Computed */\n  const isHighlighted = useMemo(\n    () => events.some((e) => e.highlighted),\n    [events]\n  );\n  const isMasked = useMemo(() => events.every((e) => e.masked), [events]);\n  const isSelected = useMemo(() => events.some((e) => e.selected), [events]);\n\n  const eventErrors = useMemo(\n    () => compact(events.flatMap((e) => e.errors)),\n    [events]\n  );\n\n  const showErrors = useMemo(\n    function () {\n      return (\n        !isNil(eventErrors) &&\n        eventErrors.length > 0 && <SimpleEventErrors errors={eventErrors} />\n      );\n    },\n    [eventErrors]\n  );\n\n  return (\n    <Note\n      title={\n        <InteractableEnlarge\n          masked={isMasked}\n          selected={isSelected}\n          highlighted={isHighlighted}\n          {...handleHighLightHover}\n        >\n          <IconSpacer spaceRight>\n            <Icon iconColor={color ? color(kind) : undefined} />\n          </IconSpacer>\n          <div>\n            {events.length} {getKindString(kind)}\n          </div>\n          <ProsoVisDates dates={compact([start, end])} />\n          {showErrors}\n        </InteractableEnlarge>\n      }\n    >\n      <LeftBottomSpacer borderColor={color ? color(kind) : undefined}>\n        {events.map((e) => (\n          <EventLine key={e.event.id} event={e} origin={origin} grouped />\n        ))}\n      </LeftBottomSpacer>\n    </Note>\n  );\n};\n\nconst InteractableEnlarge = styled.div<\n  HighlightableProp & MaskableProp & SelectableProp\n>`\n  flex: 1;\n  display: grid;\n  grid-template-columns: auto 1fr auto auto;\n  align-items: center;\n  padding-top: 1px;\n  padding-bottom: 1px;\n  padding-left: 0.25em;\n  padding-right: 0.25em;\n  ${highlightable}\n  ${maskable}\n  ${({ selected }: SelectableProp) => selected && 'font-weight: 700;'}\n`;\n","import styled from 'styled-components/macro';\nimport { EnlargeFlex } from '../../../components/ui/Flex/styled-components';\nimport {\n  highlightable,\n  selectable,\n  HighlightableProp,\n  SelectableProp,\n} from './styled-components';\n\nexport const InteractiveEnlarge = styled(EnlargeFlex)<\n  HighlightableProp & SelectableProp\n>`\n  padding-top: 2px;\n  padding-bottom: 2px;\n  ${highlightable}\n  ${selectable}\n`;\n","import { greatest, least } from 'd3';\nimport { first, isArray, last, reduce } from 'lodash/fp';\nimport { useMemo } from 'react';\nimport {\n  EventGroup as EventGroupType,\n  Interactive,\n} from '../../../v2/detail/information/types';\nimport { ProsoVisDetailRichEvent } from '../../../v2/types/events';\n\nexport const useGroupEvents = function (\n  events: Interactive<ProsoVisDetailRichEvent>[]\n) {\n  return useMemo(\n    () =>\n      reduce(\n        (acc, e) => {\n          const { event } = e;\n          let lastEvent = last(acc);\n\n          if (lastEvent === undefined || lastEvent.kind !== event.kind) {\n            acc.push({\n              id: event.id,\n              kind: event.kind,\n              events: e,\n              start: first(event.datation),\n              end: last(event.datation),\n              masked: e.masked,\n              selected: e.selected,\n              highlighted: e.highlighted,\n            });\n            return acc;\n          }\n          if (isArray(lastEvent.events)) {\n            lastEvent.events.push(e);\n          } else {\n            lastEvent.events = [lastEvent.events, e];\n          }\n\n          lastEvent.start = least(\n            [lastEvent.start, first(event.datation)],\n            (d) => d?.value\n          );\n          lastEvent.end = greatest(\n            [lastEvent.end, last(event.datation)],\n            (d) => d?.value\n          );\n\n          return acc;\n        },\n        [] as EventGroupType<\n          | Interactive<ProsoVisDetailRichEvent>[]\n          | Interactive<ProsoVisDetailRichEvent>\n        >[],\n        events\n      ),\n    [events]\n  );\n};\n","import { XIcon } from '@primer/octicons-react';\nimport React, { useCallback, useMemo } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport ActorLabel from '../../../components/ActorLabel';\nimport { ColorablePersonIcon } from '../../../components/ColorablePersonIcon';\nimport { EventGroup } from '../../../components/event/EventGroup';\nimport { EventLine } from '../../../components/event/EventLine';\nimport { LeftBottomSpacer } from '../../../components/event/LeftSpacer';\nimport {\n  IconSpacer,\n  IconSpacerPointer,\n} from '../../../components/ui/IconSpacer';\nimport { Note } from '../../../components/ui/Note';\nimport { useClickSelect, useFlatClick } from '../../../hooks/useClick';\nimport useHoverHighlight from '../../../hooks/useHoverHighlight';\nimport { selectSwitchActorColor } from '../../../selectors/switch';\nimport { removeDetailActor } from '../../../v2/reducers/detail/actorSlice';\nimport { ProsoVisDetailRichEvent } from '../../../v2/types/events';\nimport {\n  EventGroup as EventGroupType,\n  InformationActorGroup,\n  Interactive,\n} from '../../../v2/detail/information/types';\nimport { InteractiveEnlarge } from './InteractiveEnlarge';\nimport { useGroupEvents } from './useGroupEvents';\n\nexport const ActorNote: React.FC<Required<Interactive<InformationActorGroup>>> =\n  function ({ kind, events, group, selected, highlighted }) {\n    const dispatch = useDispatch();\n    const interactive = useMemo(\n      () => events.map((e) => ({ id: e.event.id, kind: 'Event' })),\n      [events]\n    );\n    const handleSelectClick = useClickSelect(interactive);\n\n    const deleteClick = useCallback(() => {\n      dispatch(removeDetailActor(group.id));\n    }, [dispatch, group.id]);\n\n    const handleDeleteClick = useFlatClick(deleteClick);\n    const handleHighlightHover = useHoverHighlight(interactive);\n\n    const groupedEvents = useGroupEvents(events);\n\n    const color = useSelector(selectSwitchActorColor);\n\n    const title = (\n      <InteractiveEnlarge\n        {...handleSelectClick}\n        {...handleHighlightHover}\n        highlighted={highlighted}\n        selected={selected}\n      >\n        <IconSpacerPointer\n          as=\"span\"\n          {...handleDeleteClick}\n          spaceLeft\n          spaceRight\n        >\n          <XIcon className=\"red\" aria-label=\"Supprimer\" />\n        </IconSpacerPointer>\n        <IconSpacer as=\"span\" spaceRight>\n          <ColorablePersonIcon\n            iconColor={color ? color(group.id) : undefined}\n            aria-label=\"individu\"\n          />\n        </IconSpacer>\n        <ActorLabel as=\"span\" id={group} />\n      </InteractiveEnlarge>\n    );\n\n    const content = (\n      <LeftBottomSpacer borderColor={color ? color(group.id) : undefined}>\n        {groupedEvents.map((e) =>\n          Array.isArray(e.events) ? (\n            <EventGroup\n              key={e.id}\n              {...(e as EventGroupType<Interactive<ProsoVisDetailRichEvent>[]>)}\n              origin={kind}\n            />\n          ) : (\n            <EventLine key={e.id} event={e.events} origin={kind} />\n          )\n        )}\n      </LeftBottomSpacer>\n    );\n\n    return <Note as={React.Fragment} title={title} children={content} />;\n  };\n","import { LocationIcon, XIcon } from '@primer/octicons-react';\nimport React from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport styled from 'styled-components/macro';\nimport ActorLabel from '../../../components/ActorLabel';\nimport { StyledFlex } from '../../../components/ui/Flex/styled-components';\nimport {\n  IconSpacerPointer,\n  IconSpacer,\n} from '../../../components/ui/IconSpacer';\nimport { useFlatClick } from '../../../hooks/useClick';\nimport { selectSwitchActorColor } from '../../../selectors/switch';\nimport { ColorablePersonIcon } from '../../../components/ColorablePersonIcon';\nimport {\n  HighlightableProp,\n  SelectableProp,\n  highlightable,\n  selectable,\n} from './styled-components';\nimport { removeDetailActor } from '../../../v2/reducers/detail/actorSlice';\nimport {\n  InformationActorGroup,\n  InformationPlaceGroup,\n  Interactive,\n} from '../../../v2/detail/information/types';\n\nconst InteractiveEnlarge = styled(StyledFlex)<\n  HighlightableProp & SelectableProp\n>`\n  padding-top: 1px;\n  padding-bottom: 1px;\n  ${highlightable}\n  ${selectable}\n`;\n\nconst Masked = styled.span`\n  opacity: 50%;\n`;\nexport const DisabledActorNote: React.FC<Interactive<InformationActorGroup>> =\n  function ({ group, selected, highlighted }) {\n    const dispatch = useDispatch();\n\n    const handleDeleteClick = useFlatClick(() => {\n      dispatch(removeDetailActor(group.id));\n    });\n    const color = useSelector(selectSwitchActorColor);\n\n    return (\n      <InteractiveEnlarge highlighted={highlighted} selected={selected}>\n        <IconSpacerPointer as=\"span\" {...handleDeleteClick} spaceRight>\n          <XIcon className=\"red\" aria-label=\"Supprimer\" />\n        </IconSpacerPointer>\n        <IconSpacer as=\"span\" spaceRight>\n          <ColorablePersonIcon\n            iconColor={color ? color(group.id) : undefined}\n            aria-label=\"individu\"\n          />\n        </IconSpacer>\n        <Masked>\n          <ActorLabel as=\"span\" id={group} short />\n        </Masked>\n      </InteractiveEnlarge>\n    );\n  };\n\nexport const DisabledPlaceNote: React.FC<Interactive<InformationPlaceGroup>> =\n  function ({ group, selected, highlighted }) {\n    return (\n      <InteractiveEnlarge highlighted={highlighted} selected={selected}>\n        <IconSpacer as=\"span\" spaceRight>\n          <LocationIcon aria-label=\"lieu\" />\n        </IconSpacer>\n        <Masked>{group.label}</Masked>\n      </InteractiveEnlarge>\n    );\n  };\n","import { LocationIcon } from '@primer/octicons-react';\nimport { isArray } from 'lodash/fp';\nimport React, { useMemo } from 'react';\nimport { EventGroup } from '../../../components/event/EventGroup';\nimport { EventLine } from '../../../components/event/EventLine';\nimport { LeftBottomSpacer } from '../../../components/event/LeftSpacer';\nimport { IconSpacer } from '../../../components/ui/IconSpacer';\nimport { Note } from '../../../components/ui/Note';\nimport { useClickSelect } from '../../../hooks/useClick';\nimport useHoverHighlight from '../../../hooks/useHoverHighlight';\nimport {\n  EventGroup as EventGroupType,\n  InformationPlaceGroup,\n  Interactive,\n} from '../../../v2/detail/information/types';\nimport { ProsoVisDetailRichEvent } from '../../../v2/types/events';\nimport { InteractiveEnlarge } from './InteractiveEnlarge';\nimport { useGroupEvents } from './useGroupEvents';\n\nexport const PlaceNote: React.FC<Interactive<InformationPlaceGroup>> =\n  function ({ kind, events, group, selected, highlighted }) {\n    const interactive = useMemo(\n      () => events.map((e) => ({ id: e.event.id, kind: 'Event' })),\n      [events]\n    );\n    const handleSelectClick = useClickSelect(interactive);\n\n    const handleHighlightHover = useHoverHighlight(interactive);\n\n    const groupedEvents = useGroupEvents(events);\n\n    const title = (\n      <InteractiveEnlarge\n        {...handleSelectClick}\n        {...handleHighlightHover}\n        highlighted={highlighted}\n        selected={selected}\n      >\n        <IconSpacer as=\"span\" spaceRight spaceLeft>\n          <LocationIcon aria-label=\"lieu\" />\n        </IconSpacer>\n        <span>{group.label}</span>\n      </InteractiveEnlarge>\n    );\n\n    const content = (\n      <LeftBottomSpacer>\n        {groupedEvents.map((e) =>\n          isArray(e.events) ? (\n            <EventGroup\n              key={e.id}\n              {...(e as EventGroupType<Interactive<ProsoVisDetailRichEvent>[]>)}\n              origin={kind}\n            />\n          ) : (\n            <EventLine key={e.id} event={e.events} origin={kind} />\n          )\n        )}\n      </LeftBottomSpacer>\n    );\n\n    return <Note as={React.Fragment} title={title} children={content} />;\n  };\n","import { flow, get, join, map, size } from 'lodash/fp';\nimport React from 'react';\nimport { useSelector } from 'react-redux';\nimport styled from 'styled-components/macro';\nimport { scrollbar } from '../../../components/scrollbar';\nimport { StyledFlex } from '../../../components/ui/Flex/styled-components';\nimport { ActorNote } from '../../../feature/info/fold/ActorNote';\nimport {\n  DisabledActorNote,\n  DisabledPlaceNote,\n} from '../../../feature/info/fold/DisabledNote';\nimport { PlaceNote } from '../../../feature/info/fold/PlaceNote';\nimport { ProsoVisDate } from '../../types/events';\nimport { selectInformationGroups } from './useGroups';\n\nexport function parseDates(dates: ProsoVisDate[]) {\n  return flow(map(get('value')), join(' - '))(dates);\n}\n\nexport const Information: React.FC<{ className?: string }> = function ({\n  className,\n}) {\n  const events = useSelector(selectInformationGroups);\n\n  return (\n    <Base className={className}>\n      {map(\n        (g) =>\n          g.kind === 'ActorNote' ? (\n            <ActorNote key={'a__' + g.group.id} {...g} />\n          ) : (\n            <PlaceNote key={'p__' + g.group.id} {...g} />\n          ),\n        events.no\n      )}\n      {size(events.yes) > 0 && <hr />}\n      {/* TODO  style */}\n      {map(\n        (g) =>\n          g.kind === 'ActorNote' ? (\n            <DisabledActorNote key={'a__' + g.group.id} {...g} />\n          ) : (\n            <DisabledPlaceNote key={'p__' + g.group.id} {...g} />\n          ),\n        events.yes\n      )}\n    </Base>\n  );\n};\n\nexport const Base = styled(StyledFlex)`\n  flex-direction: column;\n  padding: 0.125em;\n  height: 100%;\n  overflow-y: auto;\n  ${scrollbar}\n`;\n\nexport default Information;\n","import styled from 'styled-components/macro';\n\nexport const ScaledDownImg = styled.img`\n  object-fit: scale-down;\n  width: auto;\n  height: auto;\n`;\n","import React from 'react';\nimport { StyledFlex } from './ui/Flex/styled-components';\nimport styled from 'styled-components/macro';\nimport { ScaledDownImg } from './ScaledDownImg';\n\nconst FixedHeightFlex = styled(StyledFlex)`\n  justify-content: space-between;\n  width: 100%;\n\n  & > * {\n    width: 4em;\n  }\n`;\n\nexport const Organisms: React.FC = function () {\n  return (\n    <FixedHeightFlex>\n      <ScaledDownImg src=\"./img/um.png\" alt=\"Logo Université de Montpellier\" />\n      <ScaledDownImg src=\"./img/cnrs.png\" alt=\"Logo CNRS\" />\n      <ScaledDownImg src=\"./img/lirmm.png\" alt=\"Logo LIRMM\" />\n      <ScaledDownImg src=\"./img/um3.png\" alt=\"Logo Université Paul Valery\" />\n      <ScaledDownImg\n        src=\"./img/anr.jpg\"\n        alt=\"Logo Agence Nationale de la Recherche\"\n      />\n    </FixedHeightFlex>\n  );\n};\n","import React from 'react';\nimport { QuestionIcon } from '@primer/octicons-react';\n\nexport const QuestionButton = React.forwardRef<HTMLDivElement>(function (\n  _props,\n  ref\n) {\n  return (\n    <div ref={ref}>\n      <QuestionIcon size={24} />\n    </div>\n  );\n});\n","import React, { useCallback, useRef, useState } from 'react';\nimport { XIcon } from '@primer/octicons-react';\nimport styled from 'styled-components/macro';\nimport { Organisms } from '../../components/Organisms';\nimport { ScaledDownImg } from '../../components/ScaledDownImg';\nimport { StyledFlex } from '../../components/ui/Flex/styled-components';\nimport { IconSpacerPointer } from '../../components/ui/IconSpacer';\nimport { useDimsPopper } from '../../components/ui/Popper';\nimport { useFlatClick } from '../../hooks/useClick';\nimport Modal from '../modal/Modal';\nimport { QuestionButton } from './QuestionButton';\nimport { darkgray } from '../../v2/components/theme';\n\nconst AbsoluteDiv = styled.div`\n  top: 0;\n  z-index: 9999;\n  width: 30em;\n  padding: 0.25em;\n  position: absolute;\n  background-color: white;\n  box-shadow: 1px 1px 5px 0 ${darkgray};\n  border-radius: 3px;\n  pointer-events: auto;\n`;\n\nconst Head = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\nconst TitleCloseIcon = styled(IconSpacerPointer)`\n  align-self: start;\n`;\n\nconst SquishedParagraph = styled.p`\n  line-height: 1.2;\n`;\nconst PaddedStyledFlex = styled(StyledFlex)`\n  padding-top: 1em;\n`;\n\nexport const HelpInfoBubble: React.FC<{ className?: string }> = function ({\n  className,\n}) {\n  const $ref = useRef<HTMLDivElement>(null as any);\n  const $content = useRef<HTMLDivElement>(null as any);\n  const [dims, show, hide] = useDimsPopper($ref, $content, 'north-west');\n\n  const [toggle, setToggle] = useState(true);\n\n  const toggler = useCallback(() => {\n    if (toggle) {\n      show();\n      setToggle(false);\n    } else {\n      hide();\n      setToggle(true);\n    }\n  }, [toggle, show, hide]);\n\n  const flatClick = useFlatClick(toggler);\n\n  return (\n    <div className={className}>\n      <IconSpacerPointer ref={$ref} {...flatClick} style={{ color: darkgray }}>\n        <QuestionButton />\n      </IconSpacerPointer>\n\n      <Modal>\n        <AbsoluteDiv ref={$content} style={dims}>\n          <Head>\n            <h3>A propos du projet</h3>\n            <TitleCloseIcon spaceRight {...flatClick}>\n              <XIcon aria-label=\"Fermer le menu contextuel d'erreur\" />\n            </TitleCloseIcon>\n          </Head>\n          <Organisms />\n          <PaddedStyledFlex>\n            <a\n              href=\"https://anr.fr/Projet-ANR-17-CE38-0013\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              <ScaledDownImg\n                src=\"./img/anr-long.png\"\n                alt=\"Logo Agence Nationale de la Recherche\"\n              />\n            </a>\n\n            <SquishedParagraph>\n              This research has been funded by a national French grant (\n              <a\n                href=\"https://anr.fr/Projet-ANR-17-CE38-0013\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n              >\n                ANR Daphne 17-CE28-0013-01\n              </a>\n              ).\n            </SquishedParagraph>\n          </PaddedStyledFlex>\n          <SquishedParagraph>\n            Sources :{' '}\n            <a\n              href=\"http://siprojuris.symogih.org/\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              SIPROJURIS\n            </a>\n            . Point d'entrée :{' '}\n            <a\n              href=\"http://symogih.org/\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              symogih.org\n            </a>\n            .\n          </SquishedParagraph>\n        </AbsoluteDiv>\n      </Modal>\n    </div>\n  );\n};\n","import styled from 'styled-components/macro';\n\nexport const SmallFont = styled.span`\n  font-size: 14px;\n`;\n","import { ThunkAction } from '@reduxjs/toolkit';\nimport { get, pipe, sortBy, transform } from 'lodash/fp';\nimport { Action } from 'redux';\nimport { RootState } from '../../reducers';\nimport {\n  addCustomFilter,\n  getFilterType,\n  resolveCustomFilterTypes,\n} from '../reducers/mask/customFilterSlice';\nimport { selectRichEvents } from '../selectors/events';\nimport { RichEvent } from '../types/events';\n\nexport const addCustomFilterThunk = function (\n  payload:\n    | {\n        selected: boolean;\n        filter: string;\n      }\n    | string\n): ThunkAction<void, RootState, unknown, Action<string>> {\n  const filter = typeof payload === 'string' ? payload : payload.filter;\n  const selected = typeof payload !== 'string' && payload.selected;\n\n  return (dispatch, getState) => {\n    const state = getState();\n\n    const events = selectRichEvents(state);\n    const values = pipe(\n      transform<\n        RichEvent,\n        _.Dictionary<{ value: string; kind: string; count: number }>\n      >((acc, v) => {\n        const value = get(filter, v);\n        const key = resolveCustomFilterTypes(value);\n        (\n          acc[key] ??\n          (acc[key] = { value: key, kind: getFilterType(value), count: 0 })\n        ).count++;\n      }, {}),\n      sortBy<{ value: string; kind: string; count: number }>('value')\n    )(events!);\n\n    dispatch(addCustomFilter({ selected, filter, values }));\n  };\n};\n","import React, { useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport CheckBoxSwitch from '../../../components/ui/CheckBoxSwitch';\nimport { SmallFont } from '../../../feature/mask/styled-components';\nimport { darkgray } from '../../components/theme';\nimport {\n  CustomFilterField,\n  toggleCustomFilter,\n} from '../../reducers/mask/customFilterSlice';\n\nexport const CustomFilterElement: React.FC<{\n  kind: string;\n  state: CustomFilterField;\n  parent: string;\n  hideNumber?: boolean;\n  color?: d3.ScaleOrdinal<string, string, never>;\n}> = function ({\n  kind,\n  state: { value, count },\n  parent,\n  hideNumber = false,\n  color,\n}) {\n  const dispatch = useDispatch();\n\n  const handleCheck = useCallback(() => {\n    dispatch(toggleCustomFilter([parent, kind]));\n  }, [dispatch, parent, kind]);\n\n  return (\n    <CheckBoxSwitch\n      key={kind}\n      checked={value !== null}\n      handleCheck={handleCheck}\n      color={color ? color(kind) : darkgray}\n    >\n      <SmallFont>\n        {kind} {!hideNumber && `(${count})`}\n      </SmallFont>\n    </CheckBoxSwitch>\n  );\n};\n","import React, { FormEvent, useCallback, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { stopEventPropagation } from '../../../hooks/useClick';\nimport { addCustomFilterThunk } from '../../thunks/customFilterThunk';\n\nexport const CustomFiltersInput: React.FC = function () {\n  const dispatch = useDispatch();\n\n  const [input, setInput] = useState('');\n\n  const handleInput = useCallback((e: FormEvent<HTMLInputElement>) => {\n    setInput(e.currentTarget.value);\n  }, []);\n\n  const handleSubmit = useCallback(\n    (e: FormEvent<HTMLFormElement>) => {\n      e.preventDefault();\n      if (input) dispatch(addCustomFilterThunk(input));\n      setInput('');\n    },\n    [input, dispatch]\n  );\n\n  return (\n    <form onSubmit={handleSubmit} onMouseUpCapture={stopEventPropagation}>\n      <input\n        type=\"text\"\n        name=\"add-filter\"\n        id=\"add-filter\"\n        placeholder=\"add filter\"\n        aria-label=\"add filter\"\n        value={input}\n        onInput={handleInput}\n      />\n      <button type=\"submit\" disabled={input.trim() === ''}>\n        ✔\n      </button>\n    </form>\n  );\n};\n","import React, { useCallback } from 'react';\nimport { XIcon } from '@primer/octicons-react';\nimport { map } from 'lodash';\nimport { useDispatch } from 'react-redux';\nimport styled from 'styled-components';\nimport { scrollbar } from '../../../components/scrollbar';\nimport { StyledFlex } from '../../../components/ui/Flex/styled-components';\nimport { IconSpacerPointer } from '../../../components/ui/IconSpacer';\nimport { useFlatClick } from '../../../hooks/useClick';\nimport { lightgray, moongray } from '../../components/theme';\nimport {\n  CustomFilterType,\n  removeCustomFilter,\n  setDefaultCustomFilter,\n} from '../../reducers/mask/customFilterSlice';\nimport { CustomFilterElement } from './CustomFilterElement';\n\nconst CustomFilterContent = styled(StyledFlex)`\n  flex-wrap: wrap;\n  flex: 1;\n  max-height: 10em;\n  overflow-y: auto;\n  margin-left: 1em;\n  border-top: 2px solid ${lightgray};\n  border-bottom: 2px solid ${lightgray};\n  border-top-right-radius: 6px;\n  border-bottom-right-radius: 6px;\n  padding-top: 0.125em;\n  ${scrollbar}\n`;\n\nconst StyledCode = styled.code`\n  background-color: ${moongray};\n  border-radius: 4px;\n  padding-left: 0.125em;\n  padding-right: 0.125em;\n`;\n\nexport const SingleFilterView: React.FC<CustomFilterType> = function ({\n  name,\n  values,\n  kinds,\n}) {\n  const dispatch = useDispatch();\n  const deleteFilter = useCallback(() => {\n    dispatch(removeCustomFilter(name));\n  }, [dispatch, name]);\n  const handleDeleteClick = useFlatClick(deleteFilter);\n\n  const setAsDefault = useCallback(() => {\n    dispatch(setDefaultCustomFilter(name));\n  }, [dispatch, name]);\n  const handleSetDefault = useFlatClick(setAsDefault);\n\n  return (\n    <div className=\"pr2 mt3\">\n      <StyledFlex>\n        {name !== 'event.kind' && (\n          <IconSpacerPointer\n            as=\"span\"\n            {...handleDeleteClick}\n            spaceLeft\n            spaceRight\n          >\n            <XIcon className=\"red\" aria-label=\"Supprimer\" />\n          </IconSpacerPointer>\n        )}\n        <pre className=\"ma0\">\n          <StyledCode>{name}</StyledCode>:{' '}\n          <StyledCode>{kinds.join(' | ')}</StyledCode>\n        </pre>{' '}\n        <button {...handleSetDefault}>✔ select</button>\n      </StyledFlex>\n      <CustomFilterContent>\n        {map(values, (state, kind) => (\n          <CustomFilterElement\n            key={kind}\n            kind={kind}\n            state={state}\n            parent={name}\n          />\n        ))}\n      </CustomFilterContent>\n    </div>\n  );\n};\n","import React, { useCallback, useRef, useState } from 'react';\nimport { ChevronDownIcon, FilterIcon } from '@primer/octicons-react';\nimport { useSelector } from 'react-redux';\nimport styled from 'styled-components';\nimport { scrollbar } from '../../../components/scrollbar';\nimport { useDimsPopper } from '../../../components/ui/Popper';\nimport Modal from '../../../feature/modal/Modal';\nimport { useFlatClick } from '../../../hooks/useClick';\nimport { darkgray } from '../../components/theme';\nimport {\n  selectRestCustomFilters,\n  selectUsedCustomFilters,\n} from '../../selectors/mask/customFilter';\nimport { CustomFiltersInput } from './CustomFiltersInput';\nimport { SingleFilterView } from './SingleFilterView';\nimport { map } from 'lodash/fp';\n\nexport const Container = styled.span`\n  align-self: end;\n`;\n\nexport const MoreFiltersButton = styled.button`\n  line-height: 0;\n  border: 1px solid ${darkgray};\n  border-radius: 4px;\n  position: relative;\n  padding: 2px;\n`;\n\nexport const OffsetBottomLeft = styled(ChevronDownIcon)`\n  position: absolute;\n  left: 0;\n  bottom: 0;\n`;\n\nexport const AbsoluteDiv = styled.div`\n  top: 0;\n  z-index: 9999;\n  width: 50%;\n  max-height: 50%;\n  padding: 0.25em;\n  position: absolute;\n  background-color: white;\n  box-shadow: 1px 1px 5px 0 ${darkgray};\n  border-radius: 3px;\n  pointer-events: auto;\n  overflow-y: auto;\n  ${scrollbar}\n`;\n\nexport const DropDownCustomFilters: React.FC = function () {\n  const $ref = useRef<HTMLButtonElement>(null as any);\n  const $content = useRef<HTMLDivElement>(null as any);\n  const [dims, show, hide] = useDimsPopper($ref, $content, 'south-west-right');\n\n  const [toggle, setToggle] = useState(true);\n\n  const toggler = useCallback(() => {\n    if (toggle) {\n      show();\n      setToggle(false);\n    } else {\n      hide();\n      setToggle(true);\n    }\n  }, [toggle, show, hide]);\n\n  const flatClick = useFlatClick(toggler);\n\n  const filters = useSelector(selectRestCustomFilters);\n  const usedFilters = useSelector(selectUsedCustomFilters);\n\n  return (\n    <Container>\n      <MoreFiltersButton ref={$ref} {...flatClick}>\n        <FilterIcon size={16} />\n        {usedFilters && <OffsetBottomLeft size={10} />}\n      </MoreFiltersButton>\n      <Modal>\n        <AbsoluteDiv ref={$content} style={dims}>\n          <CustomFiltersInput />\n          <div>\n            {map(\n              (values) => (\n                <SingleFilterView key={values.name} {...values} />\n              ),\n              filters\n            )}\n          </div>\n        </AbsoluteDiv>\n      </Modal>\n    </Container>\n  );\n};\n","import { map } from 'lodash';\nimport React, { useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport styled from 'styled-components/macro';\nimport { scrollbar } from '../../../components/scrollbar';\nimport { StyledFlex } from '../../../components/ui/Flex/styled-components';\nimport { SmallFont } from '../../../feature/mask/styled-components';\nimport { selectSwitchMainColor } from '../../../selectors/switch';\nimport Loading from '../../components/Loading';\nimport { moongray } from '../../components/theme';\nimport { selectEvents } from '../../selectors/events';\nimport { selectDefaultCustomFilter } from '../../selectors/mask/customFilter';\nimport { addCustomFilterThunk } from '../../thunks/customFilterThunk';\nimport { CustomFilterElement } from './CustomFilterElement';\nimport { DropDownCustomFilters } from './DropDownCustomFilters';\n\nconst StyledCode = styled.code`\n  background-color: ${moongray};\n  border-radius: 4px;\n  padding-left: 0.125em;\n  padding-right: 0.125em;\n  margin-right: 0.25em;\n`;\n\nconst Gridy = styled.div`\n  display: grid;\n  grid-template-columns: 1fr auto;\n`;\n\nconst ScrollableFlex = styled(StyledFlex)`\n  overflow-y: hidden;\n  overflow-x: auto;\n  ${scrollbar}\n`;\n\nexport const CustomFilters: React.FC = function () {\n  const dispatch = useDispatch();\n  const events = useSelector(selectEvents);\n\n  useEffect(() => {\n    if (events) {\n      dispatch(addCustomFilterThunk({ selected: true, filter: 'event.kind' }));\n    }\n  }, [events, dispatch]);\n\n  const selected = useSelector(selectDefaultCustomFilter);\n  const color = useSelector(selectSwitchMainColor);\n\n  return (\n    <Loading finished={selected} size={1}>\n      <Gridy>\n        <ScrollableFlex>\n          <SmallFont as={'div'} style={{ alignSelf: 'center' }}>\n            <StyledCode>\n              <i>{selected?.name}</i>\n            </StyledCode>\n          </SmallFont>\n          {\n            selected &&\n              map(selected.values, (state, kind) => (\n                <CustomFilterElement\n                  key={kind}\n                  kind={kind}\n                  state={state}\n                  parent={selected.name}\n                  color={color}\n                  hideNumber\n                />\n              ))\n            // map(\n            //   (kind) => <Kind key={kind.value} kind={kind.value!} />,\n            //   selected?.values\n            // )\n          }\n        </ScrollableFlex>\n        <DropDownCustomFilters />\n      </Gridy>\n    </Loading>\n  );\n};\n","import React, { useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport ActorLabel from '../../components/ActorLabel';\nimport CheckBoxSwitch from '../../components/ui/CheckBoxSwitch';\nimport { toggleActorMask } from '../../reducers/maskSlice';\nimport { actorMaskState, selectActorMask } from '../../selectors/mask';\nimport { selectSwitchActorColor } from '../../selectors/switch';\nimport { darkgray } from '../../v2/components/theme';\nimport { ProsoVisActor } from '../../v2/types/actors';\nimport { SmallFont } from './styled-components';\n\nconst Actor: React.FC<{\n  actor: ProsoVisActor;\n}> = function ({ actor }) {\n  const { id } = actor;\n\n  const dispatch = useDispatch();\n\n  const color = useSelector(selectSwitchActorColor);\n  const actorMask = useSelector(selectActorMask);\n\n  const handleCheck = useCallback(() => {\n    dispatch(toggleActorMask(id));\n  }, [dispatch, id]);\n\n  return (\n    <CheckBoxSwitch\n      color={color ? color(id) : darkgray}\n      checked={actorMaskState(actor, actorMask)}\n      handleCheck={handleCheck}\n    >\n      <ActorLabel as={SmallFont} id={actor} short />\n    </CheckBoxSwitch>\n  );\n};\n\nexport default Actor;\n","import React from 'react';\nimport { useSelector } from 'react-redux';\nimport Actor from './Actor';\nimport { selectDetailActors } from '../../v2/selectors/detail/actors';\nimport styled from 'styled-components/macro';\nimport { StyledFlex } from '../../components/ui/Flex/styled-components';\nimport { map } from 'lodash/fp';\n\nconst WrapFlex = styled(StyledFlex)`\n  flex-wrap: wrap;\n`;\n\nconst ActorList: React.FC = function () {\n  const actors = useSelector(selectDetailActors);\n\n  return (\n    <WrapFlex>\n      {map(\n        (actor) => (\n          <Actor key={actor.id} actor={actor} />\n        ),\n        actors\n      )}\n    </WrapFlex>\n  );\n};\n\nexport default ActorList;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nconst switchSlice = createSlice({\n  name: 'switch',\n  initialState: 'Kind' as 'Actor' | 'Kind',\n  reducers: {\n    toggleSwitch(state) {\n      return state === 'Actor' ? 'Kind' : 'Actor';\n    },\n    switchToActor() {\n      return 'Actor';\n    },\n    switchToKind() {\n      return 'Kind';\n    },\n    switchTo(_state, { payload }: PayloadAction<'Actor' | 'Kind'>) {\n      return payload;\n    },\n  },\n});\n\nexport default switchSlice.reducer;\n\nexport const { toggleSwitch, switchTo, switchToActor, switchToKind } =\n  switchSlice.actions;\n","import React, { useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport styled from 'styled-components/macro';\nimport { stopEventPropagation } from '../../hooks/useClick';\nimport { RootState } from '../../reducers';\nimport { toggleSwitch } from '../../reducers/switchSlice';\nimport { darkgray } from '../../v2/components/theme';\nimport StyledInput from './StyledInput';\n\nconst StyledLabel = styled.label`\n  position: relative;\n  display: inline-block;\n  width: 1em;\n  height: 100%;\n  margin-bottom: 0;\n`;\n\nconst StyledSlider = styled.div`\n  cursor: pointer;\n  height: 100%;\n  width: 100%;\n  padding: 12.5%;\n  background-color: ${darkgray};\n  transition: 0.4s;\n  border-radius: 999em;\n`;\n\nconst StyledKnob = styled.div<{ slide: boolean }>`\n  height: 50%;\n  background-color: white;\n  transition: 0.4s;\n  border-radius: 999em;\n  transform: translate3d(0, ${(props) => (props.slide ? '0%' : '100%')}, 0);\n`;\n\nconst switchIsActor = (state: RootState) => state.switch === 'Actor';\n\nconst ColorSwitch: React.FC = function () {\n  const dispatch = useDispatch();\n\n  const switchState = useSelector(switchIsActor);\n\n  const handleCheck = useCallback(() => {\n    dispatch(toggleSwitch());\n  }, [dispatch]);\n\n  return (\n    <StyledLabel className=\"pointer\" onMouseUp={stopEventPropagation}>\n      <StyledInput\n        type=\"checkbox\"\n        name=\"switch\"\n        id=\"toggle-switch\"\n        checked={switchState}\n        onChange={handleCheck}\n      />\n      <StyledSlider>\n        <StyledKnob slide={switchState} />\n      </StyledSlider>\n    </StyledLabel>\n  );\n};\n\nexport default ColorSwitch;\n","import React from 'react';\nimport styled from 'styled-components/macro';\nimport { CustomFilters } from '../../v2/shared/filters/CustomFilters';\nimport ActorList from './ActorList';\nimport ColorSwitch from './ColorSwitch';\n\nconst StyledSection = styled.section`\n  display: grid;\n  grid-template:\n    'switches actors' auto\n    'switches kinds' auto / auto 1fr;\n  grid-row-gap: 0.125em;\n  padding-top: 0.125em;\n  padding-right: 0.125em;\n  padding-bottom: 0.125em;\n  padding-left: 0.25em;\n`;\n\nconst SwitchArea = styled.div`\n  grid-area: switches;\n  /* padding-top: 0.25em; */\n  /* padding-bottom: 0.25em; */\n`;\n\nconst ActorsArea = styled.div`\n  grid-area: actors;\n  min-height: 1.25em;\n  padding-left: 0.5em;\n  padding-right: 0.5em;\n`;\n\nconst KindsArea = styled.div`\n  grid-area: kinds;\n  min-height: 1.25em;\n  padding-left: 0.5em;\n  padding-right: 0.5em;\n`;\n\nconst Mask: React.FC<{ className?: string }> = function ({ className }) {\n  return (\n    <StyledSection className={className}>\n      <SwitchArea>\n        <ColorSwitch />\n      </SwitchArea>\n      <ActorsArea>\n        <ActorList />\n      </ActorsArea>\n      <KindsArea>\n        <CustomFilters />\n      </KindsArea>\n    </StyledSection>\n  );\n};\n\nexport default Mask;\n","import React from 'react';\nimport styled from 'styled-components/macro';\nimport { HelpInfoBubble } from '../../feature/help/InfoButton';\nimport Mask from '../../feature/mask/Mask';\nimport { lightgray } from '../components/theme';\n\nconst StyledHeader = styled.div`\n  display: grid;\n  justify-content: center;\n  grid-template-columns: 1fr auto;\n  border-bottom: 1px solid ${lightgray};\n`;\n\nconst StyledInfoBubble = styled(HelpInfoBubble)`\n  padding: 2px;\n`;\n\nexport const Header: React.FC = function () {\n  return (\n    <StyledHeader>\n      <Mask />\n      <StyledInfoBubble />\n    </StyledHeader>\n  );\n};\n","import React, { useMemo, useCallback, useRef } from 'react';\nimport './App.css';\nimport styled from 'styled-components/macro';\n// import Information from '../feature/info/Information';\nimport { useDispatch } from 'react-redux';\nimport { useMouse } from '../feature/timeline/useMouse';\nimport { clearSelection } from '../reducers/selectionSlice';\nimport { ActorModal } from '../feature/modal/ActorModal';\nimport Autocomplete from '../feature/search/Autocomplete';\nimport GlobalView from '../v2/views/GlobalView';\nimport Side1Main3 from '../v2/components/ui/Side1Main3';\nimport GridAutoRest from '../v2/components/ui/GridAutoRest';\nimport Flip from '../v2/components/ui/Flip';\nimport { lightgray } from '../v2/components/theme';\nimport { DetailView } from '../v2/views/DetailView';\nimport { resetGlobalSelection } from '../v2/reducers/global/selectionSlice';\nimport { resetActorSummary } from '../v2/reducers/global/actorSummarySlice';\nimport Information from '../v2/detail/information/Information';\nimport { Header } from '../v2/shared/Header';\n\nconst BorderedGridAutoRest = styled(GridAutoRest)`\n  border-right: 1px solid ${lightgray};\n`;\n\nfunction App() {\n  const $ref = useRef<HTMLDivElement>(null as any);\n\n  const dispatch = useDispatch();\n  const onClick = useCallback(\n    (e) => {\n      dispatch(clearSelection());\n      dispatch(resetGlobalSelection());\n      dispatch(resetActorSummary());\n    },\n    [dispatch]\n  );\n  const mouse = useMouse();\n\n  const bind = useMemo<{\n    [key in\n      | 'onMouseDown'\n      | 'onMouseMove'\n      | 'onMouseUp']: React.MouseEventHandler;\n  }>(\n    () => ({\n      onMouseDown: (e) => {\n        if (!mouse.current.click) {\n          mouse.current.click = true;\n          mouse.current.x = e.pageX;\n          mouse.current.y = e.pageY;\n        }\n      },\n      onMouseMove: (e) => {\n        if (\n          mouse.current.click &&\n          mouse.current.draggingTreshold(mouse.current, e)\n        ) {\n          mouse.current.dragging = true;\n          mouse.current.click = false;\n        }\n      },\n      onMouseUp: (e) => {\n        if (mouse.current.click) onClick(e);\n        mouse.current.dragging = false;\n        mouse.current.click = false;\n      },\n    }),\n    // safely ignore onClick and mouse, onclick never changes and mouse is a reference\n    // eslint-disable-next-line\n    []\n  );\n  return (\n    <div ref={$ref} {...bind}>\n      <Side1Main3>\n        <BorderedGridAutoRest>\n          <Autocomplete />\n          <Information />\n        </BorderedGridAutoRest>\n        <GridAutoRest>\n          <Header />\n          <Flip>\n            <GlobalView />\n            <DetailView />\n          </Flip>\n        </GridAutoRest>\n      </Side1Main3>\n      <ActorModal />\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { isArray } from 'lodash/fp';\n\ntype HightlightEvent = { id: string; kind: string; type?: string };\n\nexport const highlightSlice = createSlice({\n  name: 'highlight',\n  initialState: null as HightlightEvent[] | null,\n  reducers: {\n    setHighlights(\n      _state,\n      action: PayloadAction<HightlightEvent | HightlightEvent[]>\n    ) {\n      return isArray(action.payload) ? action.payload : [action.payload];\n    },\n    clearHighlights() {\n      return null;\n    },\n  },\n});\n\nexport const { setHighlights, clearHighlights } = highlightSlice.actions;\n\nexport default highlightSlice.reducer;\n","import { createSlice } from '@reduxjs/toolkit';\n\nexport const colorSlice = createSlice({\n  name: 'color',\n  initialState: {\n    kindDomain: [\n      'PassageExamen',\n      'Birth',\n      'Education',\n      'Retirement',\n      'SuspensionActivity',\n      'Death',\n      'ObtainQualification',\n    ],\n    kindRange: [\n      '#a6cee3',\n      '#1f78b4',\n      '#b2df8a',\n      '#33a02c',\n      '#fb9a99',\n      '#6d071a',\n      '#fdbf6f',\n    ],\n    actorRange: [\n      '#66c2a5',\n      '#fc8d62',\n      '#8da0cb',\n      '#e78ac3',\n      '#e5c494',\n      '#a6d854',\n      '#ffd92f',\n      '#b3b3b3',\n    ], //\n  },\n  reducers: {},\n});\n\nexport default colorSlice.reducer;\n","import { combineReducers } from '@reduxjs/toolkit';\nimport highlights from './highlightSlice';\nimport selection from './selectionSlice';\nimport mask from './maskSlice';\nimport color from './colorSlice';\nimport timelineGroup from '../feature/timeline/timelineGroupSlice';\nimport SwitchReducer from './switchSlice';\nimport superHighlight from './superHighlightSlice';\nimport relationSelection from '../feature/relation/selectionSlice';\nimport relationHighlight from '../feature/relation/highlightSlice';\nimport actorData from '../v2/reducers/actorsDataSlice';\nimport localisationData from '../v2/reducers/localisationsDataSlice';\nimport eventData from '../v2/reducers/eventsDataSlice';\nimport graphData from '../v2/reducers/graphDataSlice';\nimport relationsData from '../v2/reducers/relationsDataSlice';\nimport customFilter from '../v2/reducers/mask/customFilterSlice';\nimport maskGlobalTime from '../v2/reducers/mask/globalTimeSlice';\nimport maskGlobalMapBounds from '../v2/reducers/mask/globalMapBoundsSlice';\nimport globalHighlight from '../v2/reducers/global/highlightSlice';\nimport globalSelection from '../v2/reducers/global/selectionSlice';\nimport actorSummary from '../v2/reducers/global/actorSummarySlice';\nimport detailActors from '../v2/reducers/detail/actorSlice';\nimport maxActors from '../v2/reducers/detail/maxActorsSlice';\n\nconst rootReducer = combineReducers({\n  maxActors,\n  color,\n  highlights,\n  selection,\n  mask,\n  timelineGroup,\n  switch: SwitchReducer,\n  superHighlight,\n  relationSelection,\n  relationHighlight,\n  actorData,\n  localisationData,\n  eventData,\n  graphData,\n  relationsData,\n  maskGlobalTime,\n  maskGlobalMapBounds,\n  globalHighlight,\n  globalSelection,\n  actorSummary,\n  detailActors,\n  customFilter,\n});\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport 'tachyons/css/tachyons.min.css';\nimport App from './app/App';\nimport * as serviceWorker from './serviceWorker';\nimport { Provider } from 'react-redux';\n\nimport { configureStore, getDefaultMiddleware } from '@reduxjs/toolkit';\nimport rootReducer from './reducers/';\n// import { getEvents } from './data';\n// import { Actor } from './data/models';\n// import { flatMap } from 'lodash/fp';\n\n// const events = flatMap(getEvents, (defaultActors as any) as Actor[]);\n\nconst store = configureStore({\n  reducer: rootReducer,\n  // preloadedState: {\n  //   events,\n  // },\n  middleware: getDefaultMiddleware({\n    immutableCheck: false,\n    serializableCheck: false,\n  }),\n});\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}